<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Marinaphoto ‚Äî Brief</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,400&family=Inter:wght@400;500;600;700&display=swap');
:root{--cream:#F5F1E8;--gold:#C8A882;--gold-l:#E8D5BC;--dark:#2C2C2C;--white:#FEFEFE;}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Inter',sans-serif;background:var(--cream);color:var(--dark);min-height:100vh;}
.page{min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:32px 20px 60px;}

/* TOP BAR */
.topbar{width:100%;max-width:860px;display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:12px;}
.brand{font-family:'Playfair Display',serif;font-size:20px;font-weight:700;color:var(--dark);}
.brand em{font-style:normal;color:var(--gold);font-family:'Inter',sans-serif;font-size:12px;font-weight:400;margin-left:8px;}
.langs{display:flex;gap:2px;background:var(--white);border-radius:20px;padding:3px;box-shadow:0 2px 12px rgba(44,44,44,.08);}
.langs button{border:none;background:transparent;color:var(--dark);opacity:.4;font-size:12px;font-weight:700;padding:7px 11px;border-radius:16px;cursor:pointer;transition:all .2s;font-family:'Inter',sans-serif;}
.langs button.on{background:var(--gold);color:var(--white);opacity:1;}

/* PROGRESS */
.prog-wrap{width:100%;max-width:860px;background:var(--white);border-radius:16px;padding:16px 22px;margin-bottom:22px;box-shadow:0 2px 16px rgba(44,44,44,.06);}
.prog-bar{height:5px;background:var(--cream);border-radius:10px;overflow:hidden;margin-bottom:10px;}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--gold),var(--gold-l));border-radius:10px;transition:width .5s ease;}
.prog-meta{display:flex;justify-content:space-between;font-size:12px;font-weight:500;opacity:.6;}
.prog-meta .t{color:var(--gold);font-weight:700;opacity:1;}

/* CARD */
.card{width:100%;max-width:860px;background:var(--white);border-radius:24px;padding:clamp(28px,5vw,52px);box-shadow:0 8px 40px rgba(44,44,44,.10);animation:up .4s ease;}
@keyframes up{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

/* TYPOGRAPHY */
.kicker{font-size:11px;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;color:var(--gold);margin-bottom:14px;}
h1{font-family:'Playfair Display',serif;font-size:clamp(24px,4vw,38px);font-weight:700;line-height:1.2;margin-bottom:12px;}
.sub{font-size:17px;opacity:.7;line-height:1.65;margin-bottom:26px;}
.opening-quote{font-family:'Playfair Display',serif;font-style:italic;font-size:clamp(20px,3vw,30px);color:var(--gold);line-height:1.45;text-align:center;margin:20px 0 32px;}

/* INPUTS */
input[type=text],input[type=email]{width:100%;padding:15px 20px;border:2px solid transparent;background:var(--cream);border-radius:14px;font-size:16px;font-family:'Inter',sans-serif;color:var(--dark);outline:none;margin-top:8px;transition:all .25s;}
input:focus{border-color:var(--gold);background:var(--white);box-shadow:0 0 0 4px rgba(200,168,130,.12);}
input::placeholder{opacity:.4;}

/* OPTIONS */
.opts{display:flex;flex-direction:column;gap:10px;margin:20px 0;}
.opt{padding:18px 22px;background:var(--cream);border:2px solid transparent;border-radius:18px;cursor:pointer;transition:all .25s;position:relative;user-select:none;}
.opt:hover{background:var(--white);border-color:var(--gold-l);transform:translateY(-2px);box-shadow:0 4px 20px rgba(44,44,44,.07);}
.opt.sel{background:var(--white);border-color:var(--gold);box-shadow:0 0 0 3px rgba(200,168,130,.15);}
.opt.sel::after{content:'‚úì';position:absolute;top:50%;right:20px;transform:translateY(-50%);width:26px;height:26px;background:var(--gold);color:var(--white);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;line-height:26px;text-align:center;}
.opt-t{font-size:16px;font-weight:700;margin-bottom:3px;padding-right:36px;}
.opt-d{font-size:13px;opacity:.6;line-height:1.4;padding-right:36px;}

/* VIBE SLIDERS ‚Äî images illustratives seulement */
.vibe-block{background:var(--cream);border-radius:20px;padding:22px;margin-bottom:18px;}
.vibe-label-row{display:flex;justify-content:space-between;font-size:13px;font-weight:600;margin-bottom:4px;opacity:.75;}
.vibe-cat{font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;opacity:.45;margin-bottom:10px;}
input[type=range]{width:100%;height:6px;-webkit-appearance:none;appearance:none;background:linear-gradient(90deg,var(--gold) var(--p,50%),rgba(200,168,130,.2) var(--p,50%));border-radius:10px;outline:none;cursor:pointer;margin:10px 0 16px;}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:22px;height:22px;background:var(--white);border:3px solid var(--gold);border-radius:50%;box-shadow:0 2px 8px rgba(200,168,130,.4);}
input[type=range]::-moz-range-thumb{width:22px;height:22px;background:var(--white);border:3px solid var(--gold);border-radius:50%;}
/* Deux images illustrant les deux extr√™mes ‚Äî LECTURE SEULE */
.vibe-illus{display:grid;grid-template-columns:1fr 1fr;gap:8px;pointer-events:none;}
.vibe-img{border-radius:12px;overflow:hidden;aspect-ratio:3/2;position:relative;}
.vibe-img img{width:100%;height:100%;object-fit:cover;display:block;}
.vibe-img-lbl{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(transparent,rgba(44,44,44,.65));color:#fff;font-size:11px;font-weight:600;padding:12px 10px 7px;letter-spacing:.5px;}

/* BUTTONS */
.btns{display:flex;gap:12px;margin-top:28px;flex-wrap:wrap;}
.bp{padding:14px 32px;background:var(--gold);color:var(--white);border:2px solid var(--gold);border-radius:50px;font-size:15px;font-weight:700;font-family:'Inter',sans-serif;cursor:pointer;transition:all .25s;}
.bp:hover{background:#b89060;border-color:#b89060;transform:translateY(-2px);box-shadow:0 8px 20px rgba(200,168,130,.3);}
.bs{padding:14px 24px;background:transparent;color:var(--gold);border:2px solid var(--gold);border-radius:50px;font-size:15px;font-weight:700;font-family:'Inter',sans-serif;cursor:pointer;transition:all .25s;}
.bs:hover{background:var(--gold);color:var(--white);transform:translateY(-2px);}

/* LOADING */
.loading{text-align:center;padding:80px 20px;}
.spinner{width:50px;height:50px;border:4px solid var(--cream);border-top-color:var(--gold);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 22px;}
@keyframes spin{to{transform:rotate(360deg)}}
.loading h2{font-family:'Playfair Display',serif;margin-bottom:10px;}
.loading p{opacity:.6;font-size:16px;}

/* RAPPORT */
.rpt-hero{text-align:center;padding:56px 24px 40px;margin:-52px -52px 40px;background:linear-gradient(160deg,rgba(200,168,130,.07) 0%,transparent 60%);border-radius:24px 24px 0 0;border-bottom:1px solid rgba(200,168,130,.15);}
.rpt-hero h1{font-family:'Playfair Display',serif;font-size:clamp(38px,7vw,72px);font-weight:900;line-height:1.1;margin-bottom:16px;background:linear-gradient(135deg,var(--dark) 30%,var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.rpt-hero .client{font-size:18px;color:var(--gold);font-weight:600;margin-bottom:6px;}
.rpt-hero .rdate{font-size:13px;opacity:.45;}
.rpt-body{border-left:3px solid var(--gold);padding:4px 0 4px 32px;margin:0 0 44px;}
.rpt-body p{font-size:18px;line-height:1.9;color:var(--dark);margin-bottom:22px;}
.rpt-body p:last-child{margin-bottom:0;}

/* CTA FINALE */
.rpt-cta{background:linear-gradient(135deg,var(--gold) 0%,#b8916a 100%);border-radius:24px;padding:48px;text-align:center;}
.rpt-cta h2{font-family:'Playfair Display',serif;font-size:26px;color:#fff;margin-bottom:10px;}
.closing-q{font-family:'Playfair Display',serif;font-style:italic;font-size:20px;color:#fff;opacity:.95;margin:18px 0 24px;line-height:1.5;}
.rpt-cta p{color:#fff;opacity:.92;font-size:16px;line-height:1.65;margin-bottom:30px;}
.cta-btns{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;}
.rpt-cta .bp{background:#fff;color:var(--gold);border-color:#fff;}
.rpt-cta .bp:hover{background:var(--cream);}
.rpt-cta .bs{background:transparent;color:#fff;border-color:rgba(255,255,255,.7);}
.rpt-cta .bs:hover{background:rgba(255,255,255,.15);}

@media(max-width:640px){
  .card{padding:22px 18px;}
  .rpt-hero{margin:-22px -18px 30px;padding:38px 18px 26px;}
  .rpt-body{padding-left:18px;}
  .rpt-cta{padding:30px 20px;}
  .btns,.cta-btns{flex-direction:column;}
  .bp,.bs{width:100%;text-align:center;}
}
</style>
</head>
<body>
<div class="page">
  <div class="topbar">
    <div class="brand">MARINAPHOTO <em>Photography Brief</em></div>
    <div class="langs">
      <button id="l-fr" class="on" onclick="setLang('fr')">FR</button>
      <button id="l-en" onclick="setLang('en')">EN</button>
      <button id="l-es" onclick="setLang('es')">ES</button>
      <button id="l-ca" onclick="setLang('ca')">CA</button>
    </div>
  </div>
  <div class="prog-wrap">
    <div class="prog-bar"><div class="prog-fill" id="pbar"></div></div>
    <div class="prog-meta"><span id="pstep"></span><span class="t" id="ptime"></span></div>
  </div>
  <div class="card" id="card"></div>
</div>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// D√©tection automatique de la langue du navigateur
const detectLang=()=>{
  try{
    const nav=navigator.language||navigator.userLanguage;
    if(!nav) return 'en';
    const code=nav.toLowerCase().slice(0,2);
    if(code==='fr') return 'fr';
    if(code==='es') return 'es';
    if(code==='ca') return 'ca';
    return 'en';
  }catch(e){
    return 'en'; // Fallback si erreur
  }
};

let L = detectLang(), step = 0;
const TOTAL = 11;
const S = {
  name:'', project:'', type:null,
  priorities:[], usage:null, channels:[],
  location:null, timing:null,
  calm:50, present:50, rich:50,
  email:'', briefText:''
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TRANSLATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const TX = {
fr:{
  steps:['Intro','Pr√©nom','Projet','Type','Priorit√©s','Usage','Canaux','Lieu','Timing','Ambiance','Contact'],
  times:['3 min','2 min','2 min','2 min','1 min','1 min','1 min','1 min','30 sec','30 sec','20 sec'],
  back:'Retour', maxTwo:'Maximum 2 choix', mustPick:'Veuillez choisir une option', emailErr:'Email invalide',
  intro:{kicker:'Commen√ßons',quote:'Je sais ce qu\'une image repr√©sente pour vous‚Ä¶',title:'3 minutes pour comprendre votre projet.',sub:'Quelques questions simples. Je transforme vos r√©ponses en un brief personnalis√© qui nous guide.',btn:'Commencer'},
  name:{kicker:'√Ä propos de vous',title:'Votre pr√©nom',ph:'Ex : Sophie',btn:'Continuer'},
  project:{kicker:'Le projet',title:'Comment s\'appelle votre projet ?',sub:'Un nom, m√™me provisoire.',ph:'Ex : H√¥tel Can Ros / Bodega Garraf',btn:'Continuer'},
  type:{kicker:'Nature du projet',title:'Votre projet, c\'est avant tout‚Ä¶',opts:[
    {id:'place',t:'üè† Un lieu √† faire ressentir',d:'H√¥tel, restaurant, architecture. La lumi√®re, l\'espace, l\'atmosph√®re.'},
    {id:'story',t:'üìñ Une histoire √† raconter',d:'Artisan, marque, projet. Les gens, les gestes, le contexte.'},
    {id:'moment',t:'‚è≥ Un moment √† garder',d:'Famille, couple, √©v√©nement. L\'instant, l\'√©motion, la vie.'}
  ],btn:'Continuer'},
  priorities:{kicker:'L\'effet recherch√©',title:'Ce que vous voulez transmettre',sub:'1 ou 2 priorit√©s',opts:[
    {id:'auth',t:'Authenticit√©',d:'Vrai, pr√©sent, pas artificiel'},
    {id:'brand',t:'Coh√©rence',d:'Align√© avec votre identit√© visuelle'},
    {id:'singular',t:'Singularit√©',d:'Un regard reconnaissable, pas du d√©j√†-vu'},
    {id:'trust',t:'Cr√©dibilit√©',d:'Professionnel, humain, qui inspire confiance'}
  ],btn:'Continuer'},
  usage:{kicker:'Usage',title:'Ces images vont servir √†‚Ä¶',opts:[
    {id:'launch',t:'üìÜ Un lancement / √©v√©nement',d:'Ouverture, campagne pr√©cise, √©v√©nement avec deadline'},
    {id:'base',t:'üîÅ Constituer une biblioth√®que',d:'Images r√©utilisables pour votre communication courante'},
    {id:'series',t:'üå± Une s√©rie r√©guli√®re',d:'Contenu continu (r√©seaux, blog, √©volution dans le temps)'}
  ],btn:'Continuer'},
  channels:{kicker:'Diffusion',title:'O√π ces images vivront-elles ?',sub:'Max 2',opts:[
    {id:'web',t:'Site web'},{id:'social',t:'R√©seaux sociaux'},{id:'press',t:'Presse / √©ditorial'},{id:'print',t:'Print / affichage'}
  ],btn:'Continuer'},
  location:{kicker:'Logistique',title:'O√π se d√©roule la s√©ance ?',opts:[
    {id:'sitges',t:'üìç Sitges et environs',d:'Garraf, Vilanova, Cubelles‚Ä¶'},
    {id:'bcn',t:'üìç Barcelone',d:'Ville ou p√©riph√©rie'},
    {id:'cat',t:'üìç Ailleurs en Catalogne',d:'Costa Brava, Tarragone, int√©rieur‚Ä¶'},
    {id:'other',t:'üìç En dehors de Catalogne',d:'√Ä d√©finir ensemble'}
  ],btn:'Continuer'},
  timing:{kicker:'Planning',title:'Quand avez-vous besoin des images ?',opts:[
    {id:'fixed',t:'üìÖ Date fix√©e',d:'J\'ai une deadline pr√©cise'},
    {id:'approx',t:'üìÜ P√©riode approximative',d:'Dans les prochaines semaines ou mois'},
    {id:'flex',t:'üåä Pas d\'urgence',d:'On cale √ßa ensemble'}
  ],btn:'Continuer'},
  vibe:{kicker:'Direction artistique',title:'Comment je dois photographier',
    sub:'Ajustez les trois curseurs. Les photos illustrent chaque extr√™me ‚Äî elles ne sont pas cliquables.',
    sliders:[
      {id:'calm',cat:'√ânergie',lo:'Calme & contemplatif',hi:'Vivant & dynamique',
        imgs:[{src:'https://images.unsplash.com/photo-1518709268805-4e9042af9f23?w=600',lbl:'Calme'},
              {src:'https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=600',lbl:'Vivant'}]},
      {id:'present',cat:'Proximit√©',lo:'Distance & contexte',hi:'Intime & d√©tails',
        imgs:[{src:'https://images.unsplash.com/photo-1505373877841-8d25f7d46678?w=600',lbl:'Vue large'},
              {src:'https://images.unsplash.com/photo-1495195134817-aeb325a55b65?w=600',lbl:'Proximit√©'}]},
      {id:'rich',cat:'Esth√©tique',lo:'√âpur√© & minimaliste',hi:'Textur√© & riche',
        imgs:[{src:'https://images.unsplash.com/photo-1484101403633-562f891dc89a?w=600',lbl:'√âpur√©'},
              {src:'https://images.unsplash.com/photo-1513151233558-d860c5398176?w=600',lbl:'Textur√©'}]}
    ],btn:'Voir le brief'},
  contact:{kicker:'Derni√®re √©tape',title:'Votre adresse email',sub:'Pour recevoir ce brief et commencer √† √©changer.',ph:'vous@email.com',btn:'G√©n√©rer le brief'},
  report:{loading:'R√©daction de votre brief‚Ä¶',loadSub:'L\'IA analyse vos r√©ponses et compose votre brief personnalis√©.',
    ctaTitle:'La suite',ctaQuote:'‚Ä¶Et maintenant vous savez ce qu\'une image repr√©sente pour moi.',
    ctaText:'Discutons de votre projet. Je vous pr√©pare une proposition personnalis√©e ‚Äî approche, planning et budget.',
    btnEmail:'Envoyer le brief √† Marina',btnRdv:'Prendre rendez-vous',btnPdf:'T√©l√©charger en PDF',btnRestart:'Nouveau brief'},
  emailSubj:'Brief photo',emailHi:'Bonjour Marina,',emailIntro:'Voici mon brief compl√©t√© via le questionnaire en ligne.',emailSign:'Cordialement,',
  restartConfirm:'Recommencer le questionnaire ?',
  pdfFilename:'marinaphoto-brief'
},
en:{
  steps:['Intro','Name','Project','Type','Priorities','Use','Channels','Location','Timing','Vibe','Contact'],
  times:['3 min','2 min','2 min','2 min','1 min','1 min','1 min','1 min','30 sec','30 sec','20 sec'],
  back:'Back', maxTwo:'Maximum 2 choices', mustPick:'Please choose an option', emailErr:'Invalid email',
  intro:{kicker:'Let\'s start',quote:'I know what an image means to you‚Ä¶',title:'3 minutes to understand your project.',sub:'A few simple questions. I turn your answers into a personalised brief that guides our work.',btn:'Start'},
  name:{kicker:'About you',title:'Your first name',ph:'e.g. Sophie',btn:'Continue'},
  project:{kicker:'The project',title:'What is your project called?',sub:'A name, even a working one.',ph:'e.g. Hotel Can Ros / Garraf Winery',btn:'Continue'},
  type:{kicker:'Project type',title:'Your project is mainly‚Ä¶',opts:[
    {id:'place',t:'üè† A place to make felt',d:'Hotel, restaurant, architecture. Light, space, atmosphere.'},
    {id:'story',t:'üìñ A story to tell',d:'Artisan, brand, project. People, gestures, context.'},
    {id:'moment',t:'‚è≥ A moment to keep',d:'Family, couple, event. The instant, emotion, life.'}
  ],btn:'Continue'},
  priorities:{kicker:'The desired effect',title:'What you want to convey',sub:'1 or 2 priorities',opts:[
    {id:'auth',t:'Authenticity',d:'Real, present, not artificial'},
    {id:'brand',t:'Coherence',d:'Aligned with your visual identity'},
    {id:'singular',t:'Singularity',d:'A recognisable eye, nothing generic'},
    {id:'trust',t:'Credibility',d:'Professional, human, trust-inspiring'}
  ],btn:'Continue'},
  usage:{kicker:'Use',title:'These images will serve‚Ä¶',opts:[
    {id:'launch',t:'üìÜ A launch / event',d:'Opening, specific campaign, event with deadline'},
    {id:'base',t:'üîÅ Building a library',d:'Reusable images for your ongoing communication'},
    {id:'series',t:'üå± An ongoing series',d:'Continuous content (social, blog, evolution over time)'}
  ],btn:'Continue'},
  channels:{kicker:'Distribution',title:'Where will these images live?',sub:'Max 2',opts:[
    {id:'web',t:'Website'},{id:'social',t:'Social media'},{id:'press',t:'Press / editorial'},{id:'print',t:'Print / display'}
  ],btn:'Continue'},
  location:{kicker:'Logistics',title:'Where will the shoot take place?',opts:[
    {id:'sitges',t:'üìç Sitges area',d:'Garraf, Vilanova, Cubelles‚Ä¶'},
    {id:'bcn',t:'üìç Barcelona',d:'City or surroundings'},
    {id:'cat',t:'üìç Elsewhere in Catalonia',d:'Costa Brava, Tarragona, inland‚Ä¶'},
    {id:'other',t:'üìç Outside Catalonia',d:'To define together'}
  ],btn:'Continue'},
  timing:{kicker:'Schedule',title:'When do you need the images?',opts:[
    {id:'fixed',t:'üìÖ Fixed date',d:'I have a precise deadline'},
    {id:'approx',t:'üìÜ Approximate timeframe',d:'Within the next weeks or months'},
    {id:'flex',t:'üåä No urgency',d:'We figure it out together'}
  ],btn:'Continue'},
  vibe:{kicker:'Artistic direction',title:'How should I photograph',
    sub:'Adjust the three sliders. Photos illustrate each extreme ‚Äî they are not clickable.',
    sliders:[
      {id:'calm',cat:'Energy',lo:'Calm & contemplative',hi:'Lively & dynamic',
        imgs:[{src:'https://images.unsplash.com/photo-1518709268805-4e9042af9f23?w=600',lbl:'Still'},
              {src:'https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=600',lbl:'Lively'}]},
      {id:'present',cat:'Proximity',lo:'Distance & context',hi:'Intimate & details',
        imgs:[{src:'https://images.unsplash.com/photo-1505373877841-8d25f7d46678?w=600',lbl:'Wide'},
              {src:'https://images.unsplash.com/photo-1495195134817-aeb325a55b65?w=600',lbl:'Close'}]},
      {id:'rich',cat:'Aesthetic',lo:'Minimal & clean',hi:'Textured & rich',
        imgs:[{src:'https://images.unsplash.com/photo-1484101403633-562f891dc89a?w=600',lbl:'Minimal'},
              {src:'https://images.unsplash.com/photo-1513151233558-d860c5398176?w=600',lbl:'Textured'}]}
    ],btn:'See brief'},
  contact:{kicker:'Last step',title:'Your email address',sub:'To send you this brief and start the conversation.',ph:'you@email.com',btn:'Generate brief'},
  report:{loading:'Writing your brief‚Ä¶',loadSub:'AI is analysing your answers and composing your personalised brief.',
    ctaTitle:'Next step',ctaQuote:'‚Ä¶And now you know what an image means to me.',
    ctaText:'Let\'s talk about your project. I\'ll prepare a personalised proposal ‚Äî approach, timeline and budget.',
    btnEmail:'Send brief to Marina',btnRdv:'Book a call',btnPdf:'Download PDF',btnRestart:'New brief'},
  emailSubj:'Photo brief',emailHi:'Hello Marina,',emailIntro:'Here is my completed brief from the online questionnaire.',emailSign:'Best regards,',
  restartConfirm:'Restart the questionnaire?',
  pdfFilename:'marinaphoto-brief'
},
es:{
  steps:['Intro','Nombre','Proyecto','Tipo','Prioridades','Uso','Canales','Lugar','Timing','Vibra','Contacto'],
  times:['3 min','2 min','2 min','2 min','1 min','1 min','1 min','1 min','30 seg','30 seg','20 seg'],
  back:'Atr√°s', maxTwo:'M√°ximo 2 opciones', mustPick:'Por favor elija una opci√≥n', emailErr:'Email inv√°lido',
  intro:{kicker:'Empecemos',quote:'S√© lo que una imagen significa para ti‚Ä¶',title:'3 minutos para entender tu proyecto.',sub:'Algunas preguntas simples. Transformo tus respuestas en un brief personalizado que gu√≠a nuestra colaboraci√≥n.',btn:'Empezar'},
  name:{kicker:'Sobre ti',title:'Tu nombre',ph:'ej. Sof√≠a',btn:'Continuar'},
  project:{kicker:'El proyecto',title:'¬øC√≥mo se llama tu proyecto?',sub:'Un nombre, aunque sea provisional.',ph:'ej. Hotel Can Ros / Bodega Garraf',btn:'Continuar'},
  type:{kicker:'Naturaleza del proyecto',title:'Tu proyecto es sobre todo‚Ä¶',opts:[
    {id:'place',t:'üè† Un lugar para sentir',d:'Hotel, restaurante, arquitectura. Luz, espacio, atm√≥sfera.'},
    {id:'story',t:'üìñ Una historia que contar',d:'Artesano, marca, proyecto. Personas, gestos, contexto.'},
    {id:'moment',t:'‚è≥ Un momento para guardar',d:'Familia, pareja, evento. El instante, la emoci√≥n, la vida.'}
  ],btn:'Continuar'},
  priorities:{kicker:'El efecto deseado',title:'Lo que quieres transmitir',sub:'1 o 2 prioridades',opts:[
    {id:'auth',t:'Autenticidad',d:'Real, presente, no artificial'},
    {id:'brand',t:'Coherencia',d:'Alineado con tu identidad visual'},
    {id:'singular',t:'Singularidad',d:'Una mirada reconocible, nada gen√©rico'},
    {id:'trust',t:'Credibilidad',d:'Profesional, humano, que inspira confianza'}
  ],btn:'Continuar'},
  usage:{kicker:'Uso',title:'Estas im√°genes servir√°n para‚Ä¶',opts:[
    {id:'launch',t:'üìÜ Un lanzamiento / evento',d:'Apertura, campa√±a espec√≠fica, evento con fecha l√≠mite'},
    {id:'base',t:'üîÅ Construir una biblioteca',d:'Im√°genes reutilizables para tu comunicaci√≥n habitual'},
    {id:'series',t:'üå± Una serie continua',d:'Contenido continuo (redes, blog, evoluci√≥n en el tiempo)'}
  ],btn:'Continuar'},
  channels:{kicker:'Difusi√≥n',title:'¬øD√≥nde vivir√°n estas im√°genes?',sub:'M√°x 2',opts:[
    {id:'web',t:'Web'},{id:'social',t:'Redes sociales'},{id:'press',t:'Prensa / editorial'},{id:'print',t:'Impresi√≥n / display'}
  ],btn:'Continuar'},
  location:{kicker:'Log√≠stica',title:'¬øD√≥nde se realizar√° la sesi√≥n?',opts:[
    {id:'sitges',t:'üìç Sitges y alrededores',d:'Garraf, Vilanova, Cubelles‚Ä¶'},
    {id:'bcn',t:'üìç Barcelona',d:'Ciudad o alrededores'},
    {id:'cat',t:'üìç Otra parte de Catalu√±a',d:'Costa Brava, Tarragona, interior‚Ä¶'},
    {id:'other',t:'üìç Fuera de Catalu√±a',d:'A definir juntos'}
  ],btn:'Continuar'},
  timing:{kicker:'Planificaci√≥n',title:'¬øCu√°ndo necesitas las im√°genes?',opts:[
    {id:'fixed',t:'üìÖ Fecha fija',d:'Tengo una fecha l√≠mite precisa'},
    {id:'approx',t:'üìÜ Per√≠odo aproximado',d:'En las pr√≥ximas semanas o meses'},
    {id:'flex',t:'üåä Sin urgencia',d:'Lo decidimos juntos'}
  ],btn:'Continuar'},
  vibe:{kicker:'Direcci√≥n art√≠stica',title:'C√≥mo debo fotografiar',
    sub:'Ajusta los tres controles. Las fotos ilustran cada extremo ‚Äî no son clicables.',
    sliders:[
      {id:'calm',cat:'Energ√≠a',lo:'Calmo & contemplativo',hi:'Vivo & din√°mico',
        imgs:[{src:'https://images.unsplash.com/photo-1518709268805-4e9042af9f23?w=600',lbl:'Sereno'},
              {src:'https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=600',lbl:'Vivo'}]},
      {id:'present',cat:'Proximidad',lo:'Distancia & contexto',hi:'√çntimo & detalles',
        imgs:[{src:'https://images.unsplash.com/photo-1505373877841-8d25f7d46678?w=600',lbl:'Amplio'},
              {src:'https://images.unsplash.com/photo-1495195134817-aeb325a55b65?w=600',lbl:'Cercano'}]},
      {id:'rich',cat:'Est√©tica',lo:'Limpio & minimalista',hi:'Texturado & rico',
        imgs:[{src:'https://images.unsplash.com/photo-1484101403633-562f891dc89a?w=600',lbl:'Limpio'},
              {src:'https://images.unsplash.com/photo-1513151233558-d860c5398176?w=600',lbl:'Texturado'}]}
    ],btn:'Ver brief'},
  contact:{kicker:'√öltimo paso',title:'Tu direcci√≥n de email',sub:'Para enviarte este brief y empezar a hablar.',ph:'tu@email.com',btn:'Generar brief'},
  report:{loading:'Redactando tu brief‚Ä¶',loadSub:'La IA analiza tus respuestas y compone tu brief personalizado.',
    ctaTitle:'El pr√≥ximo paso',ctaQuote:'‚Ä¶Y ahora sabes lo que una imagen significa para m√≠.',
    ctaText:'Hablemos de tu proyecto. Te preparo una propuesta personalizada ‚Äî enfoque, planificaci√≥n y presupuesto.',
    btnEmail:'Enviar brief a Marina',btnRdv:'Reservar una llamada',btnPdf:'Descargar PDF',btnRestart:'Nuevo brief'},
  emailSubj:'Brief fotogr√°fico',emailHi:'Hola Marina,',emailIntro:'Aqu√≠ est√° mi brief completado a trav√©s del cuestionario en l√≠nea.',emailSign:'Saludos,',
  restartConfirm:'¬øReiniciar el cuestionario?',
  pdfFilename:'marinaphoto-brief'
},
ca:{
  steps:['Intro','Nom','Projecte','Tipus','Prioritats','√ös','Canals','Lloc','Timing','Vibra','Contacte'],
  times:['3 min','2 min','2 min','2 min','1 min','1 min','1 min','1 min','30 seg','30 seg','20 seg'],
  back:'Enrere', maxTwo:'M√†xim 2 opcions', mustPick:'Si us plau, tria una opci√≥', emailErr:'Email inv√†lid',
  intro:{kicker:'Comencem',quote:'S√© el que una imatge significa per a tu‚Ä¶',title:'3 minuts per entendre el teu projecte.',sub:'Unes quantes preguntes simples. Transformo les teves respostes en un brief personalitzat que guia la nostra col¬∑laboraci√≥.',btn:'Comen√ßar'},
  name:{kicker:'Sobre tu',title:'El teu nom',ph:'ex. N√∫ria',btn:'Continuar'},
  project:{kicker:'El projecte',title:'Com s\'anomena el teu projecte?',sub:'Un nom, encara que sigui provisional.',ph:'ex. Hotel Can Ros / Celler Garraf',btn:'Continuar'},
  type:{kicker:'Naturalesa del projecte',title:'El teu projecte √©s sobretot‚Ä¶',opts:[
    {id:'place',t:'üè† Un lloc per sentir',d:'Hotel, restaurant, arquitectura. Llum, espai, atmosfera.'},
    {id:'story',t:'üìñ Una hist√≤ria per explicar',d:'Artes√†, marca, projecte. Persones, gestos, context.'},
    {id:'moment',t:'‚è≥ Un moment per guardar',d:'Fam√≠lia, parella, esdeveniment. L\'instant, l\'emoci√≥, la vida.'}
  ],btn:'Continuar'},
  priorities:{kicker:'L\'efecte desitjat',title:'El que vols transmetre',sub:'1 o 2 prioritats',opts:[
    {id:'auth',t:'Autenticitat',d:'Real, present, no artificial'},
    {id:'brand',t:'Coher√®ncia',d:'Alineat amb la teva identitat visual'},
    {id:'singular',t:'Singularitat',d:'Una mirada reconeixible, res gen√®ric'},
    {id:'trust',t:'Credibilitat',d:'Professional, hum√†, que inspira confian√ßa'}
  ],btn:'Continuar'},
  usage:{kicker:'√ös',title:'Aquestes imatges serviran per a‚Ä¶',opts:[
    {id:'launch',t:'üìÜ Un llan√ßament / esdeveniment',d:'Obertura, campanya espec√≠fica, esdeveniment amb data l√≠mit'},
    {id:'base',t:'üîÅ Construir una biblioteca',d:'Imatges reutilitzables per a la teva comunicaci√≥ habitual'},
    {id:'series',t:'üå± Una s√®rie cont√≠nua',d:'Contingut continu (xarxes, blog, evoluci√≥ en el temps)'}
  ],btn:'Continuar'},
  channels:{kicker:'Difusi√≥',title:'On viuran aquestes imatges?',sub:'M√†x 2',opts:[
    {id:'web',t:'Web'},{id:'social',t:'Xarxes socials'},{id:'press',t:'Premsa / editorial'},{id:'print',t:'Impressi√≥ / cartelleria'}
  ],btn:'Continuar'},
  location:{kicker:'Log√≠stica',title:'On es far√† la sessi√≥?',opts:[
    {id:'sitges',t:'üìç Sitges i rodalia',d:'Garraf, Vilanova, Cubelles‚Ä¶'},
    {id:'bcn',t:'üìç Barcelona',d:'Ciutat o voltants'},
    {id:'cat',t:'üìç Altra part de Catalunya',d:'Costa Brava, Tarragona, interior‚Ä¶'},
    {id:'other',t:'üìç Fora de Catalunya',d:'A definir junts'}
  ],btn:'Continuar'},
  timing:{kicker:'Planificaci√≥',title:'Quan necessites les imatges?',opts:[
    {id:'fixed',t:'üìÖ Data fixada',d:'Tinc una data l√≠mit precisa'},
    {id:'approx',t:'üìÜ Per√≠ode aproximat',d:'En les properes setmanes o mesos'},
    {id:'flex',t:'üåä Sense urg√®ncia',d:'Ho decidim junts'}
  ],btn:'Continuar'},
  vibe:{kicker:'Direcci√≥ art√≠stica',title:'Com he de fotografiar',
    sub:'Ajusta els tres controls. Les fotos il¬∑lustren cada extrem ‚Äî no es poden clicar.',
    sliders:[
      {id:'calm',cat:'Energia',lo:'Calmat & contemplatiu',hi:'Viu & din√†mic',
        imgs:[{src:'https://images.unsplash.com/photo-1518709268805-4e9042af9f23?w=600',lbl:'Ser√®'},
              {src:'https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=600',lbl:'Viu'}]},
      {id:'present',cat:'Proximitat',lo:'Dist√†ncia & context',hi:'√çntim & detalls',
        imgs:[{src:'https://images.unsplash.com/photo-1505373877841-8d25f7d46678?w=600',lbl:'Ampli'},
              {src:'https://images.unsplash.com/photo-1495195134817-aeb325a55b65?w=600',lbl:'Proper'}]},
      {id:'rich',cat:'Est√®tica',lo:'Net & minimalista',hi:'Texturat & ric',
        imgs:[{src:'https://images.unsplash.com/photo-1484101403633-562f891dc89a?w=600',lbl:'Net'},
              {src:'https://images.unsplash.com/photo-1513151233558-d860c5398176?w=600',lbl:'Texturat'}]}
    ],btn:'Veure brief'},
  contact:{kicker:'Darrer pas',title:'El teu email',sub:'Per enviar-te aquest brief i comen√ßar a parlar.',ph:'tu@email.cat',btn:'Generar brief'},
  report:{loading:'Redactant el teu brief‚Ä¶',loadSub:'La IA analitza les teves respostes i compon el teu brief personalitzat.',
    ctaTitle:'El proper pas',ctaQuote:'‚Ä¶I ara saps el que una imatge significa per a mi.',
    ctaText:'Parlem del teu projecte. Et preparo una proposta personalitzada ‚Äî enfocament, planificaci√≥ i pressupost.',
    btnEmail:'Enviar brief a Marina',btnRdv:'Reservar una trucada',btnPdf:'Descarregar PDF',btnRestart:'Nou brief'},
  emailSubj:'Brief fotogr√†fic',emailHi:'Hola Marina,',emailIntro:'Aqu√≠ tens el meu brief completat a trav√©s del q√ºestionari en l√≠nia.',emailSign:'Cordialment,',
  restartConfirm:'Reiniciar el q√ºestionari?',
  pdfFilename:'marinaphoto-brief'
}
};

const t = k => { let r=TX[L]; for(const p of k.split('.')) r=r[p]; return r; };

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROGRESS + NAV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function upProg(){
  document.getElementById('pbar').style.width=((step+1)/TOTAL*100)+'%';
  document.getElementById('pstep').textContent=(step+1)+'/'+TOTAL+' ¬∑ '+t('steps')[step];
  document.getElementById('ptime').textContent='~'+t('times')[step];
}
function setLang(l){
  L=l;
  ['fr','en','es','ca'].forEach(x=>document.getElementById('l-'+x).classList.remove('on'));
  document.getElementById('l-'+l).classList.add('on');
  go();
}
function fwd(){if(step<TOTAL-1){step++;go();}}
function bck(){if(step>0){step--;go();}}
function go(){
  upProg();
  const c=document.getElementById('card');
  c.style.cssText='opacity:0;transform:translateY(10px);transition:none;';
  setTimeout(()=>{
    draw();
    c.style.cssText='opacity:1;transform:translateY(0);transition:all .35s ease;';
    window.scrollTo({top:0,behavior:'smooth'});
  },60);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DRAW STEPS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function draw(){
  const c=document.getElementById('card');
  const fns=[drawIntro,drawName,drawProject,drawType,drawPriorities,
              drawUsage,drawChannels,drawLocation,drawTiming,drawVibe,drawContact];
  if(fns[step]) c.innerHTML=fns[step]();
  bindOpts();
  initSliders();
}

const BK = ()=>`<button class="bs" onclick="bck()">‚Üê ${t('back')}</button>`;

function drawIntro(){
  return `<div class="kicker">${t('intro.kicker')}</div>
  <div class="opening-quote">"${t('intro.quote')}"</div>
  <h1>${t('intro.title')}</h1>
  <p class="sub">${t('intro.sub')}</p>
  <div class="btns"><button class="bp" onclick="fwd()">${t('intro.btn')}</button></div>`;
}
function drawName(){
  return `<div class="kicker">${t('name.kicker')}</div>
  <h1>${t('name.title')}</h1>
  <input type="text" id="f-name" value="${esc(S.name)}" placeholder="${t('name.ph')}">
  <div class="btns"><button class="bp" onclick="svName()">${t('name.btn')}</button>${BK()}</div>`;
}
function drawProject(){
  return `<div class="kicker">${t('project.kicker')}</div>
  <h1>${t('project.title')}</h1><p class="sub">${t('project.sub')}</p>
  <input type="text" id="f-proj" value="${esc(S.project)}" placeholder="${t('project.ph')}">
  <div class="btns"><button class="bp" onclick="svProject()">${t('project.btn')}</button>${BK()}</div>`;
}
function drawOpts(key, field, multi, stateRef){
  const opts=t(key+'.opts');
  return `<div class="kicker">${t(key+'.kicker')}</div>
  <h1>${t(key+'.title')}</h1>
  ${t(key+'.sub') ? `<p class="sub">${t(key+'.sub')}</p>` : ''}
  <div class="opts">${opts.map(o=>`
    <div class="opt${(multi?stateRef.includes(o.id):stateRef===o.id)?' sel':''}" data-id="${o.id}" data-field="${field}" data-multi="${multi}">
      <div class="opt-t">${o.t}</div>${o.d?`<div class="opt-d">${o.d}</div>`:''}
    </div>`).join('')}
  </div>
  <div class="btns">
    <button class="bp" onclick="${multi?`valMulti('${field}',2)`:`valSingle('${field}')`}">${t(key+'.btn')}</button>
    ${BK()}
  </div>`;
}
function drawType(){return drawOpts('type','type',false,S.type);}
function drawPriorities(){return drawOpts('priorities','priorities',true,S.priorities);}
function drawUsage(){return drawOpts('usage','usage',false,S.usage);}
function drawChannels(){return drawOpts('channels','channels',true,S.channels);}
function drawLocation(){return drawOpts('location','location',false,S.location);}
function drawTiming(){return drawOpts('timing','timing',false,S.timing);}

function drawVibe(){
  const sls=t('vibe.sliders');
  return `<div class="kicker">${t('vibe.kicker')}</div>
  <h1>${t('vibe.title')}</h1>
  <p class="sub">${t('vibe.sub')}</p>
  ${sls.map(sl=>`
  <div class="vibe-block">
    <div class="vibe-cat">${sl.cat}</div>
    <div class="vibe-label-row"><span>${sl.lo}</span><span>${sl.hi}</span></div>
    <input type="range" min="0" max="100" value="${S[sl.id]}" data-key="${sl.id}"
      style="--p:${S[sl.id]}%"
      oninput="S['${sl.id}']=+this.value;this.style.setProperty('--p',this.value+'%')">
    <div class="vibe-illus">
      ${sl.imgs.map(img=>`
      <div class="vibe-img">
        <img src="${img.src}" alt="${img.lbl}" loading="lazy">
        <div class="vibe-img-lbl">${img.lbl}</div>
      </div>`).join('')}
    </div>
  </div>`).join('')}
  <div class="btns"><button class="bp" onclick="fwd()">${t('vibe.btn')}</button>${BK()}</div>`;
}

function drawContact(){
  return `<div class="kicker">${t('contact.kicker')}</div>
  <h1>${t('contact.title')}</h1>
  <p class="sub">${t('contact.sub')}</p>
  <input type="email" id="f-email" value="${esc(S.email)}" placeholder="${t('contact.ph')}">
  <div class="btns"><button class="bp" onclick="svEmail()">${t('contact.btn')}</button>${BK()}</div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EVENT BINDING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function bindOpts(){
  document.querySelectorAll('.opt[data-field]').forEach(el=>{
    el.addEventListener('click',()=>{
      const id=el.dataset.id, field=el.dataset.field, multi=el.dataset.multi==='true';
      if(multi){
        if(el.classList.contains('sel')){
          S[field]=S[field].filter(x=>x!==id);
          el.classList.remove('sel');
        } else {
          if(S[field].length>=2){alert(t('maxTwo'));return;}
          S[field].push(id);
          el.classList.add('sel');
        }
      } else {
        document.querySelectorAll(`.opt[data-field="${field}"]`).forEach(x=>x.classList.remove('sel'));
        S[field]=id;
        el.classList.add('sel');
      }
    });
  });
}
function initSliders(){
  document.querySelectorAll('input[type=range]').forEach(el=>{
    el.style.setProperty('--p',el.value+'%');
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SAVE / VALIDATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const esc=s=>(s||'').replace(/"/g,'&quot;');
function svName(){S.name=document.getElementById('f-name').value.trim();fwd();}
function svProject(){S.project=document.getElementById('f-proj').value.trim();fwd();}
function valSingle(f){if(!S[f]){alert(t('mustPick'));return;}fwd();}
function valMulti(f,max){if(!S[f].length){alert(t('mustPick'));return;}fwd();}
function svEmail(){
  const v=document.getElementById('f-email').value.trim();
  if(!v||!v.includes('@')||!v.includes('.')){alert(t('emailErr'));return;}
  S.email=v;
  showReport();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RAPPORT ‚Äî g√©n√©ration du brief (Hugging Face AI + fallback)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showReport(){
  step=10; upProg();
  const c=document.getElementById('card');
  c.innerHTML=`<div class="loading"><div class="spinner"></div><h2>${t('report.loading')}</h2><p>${t('report.loadSub')}</p></div>`;
  
  // Tentative avec Hugging Face AI (gratuit, rapide)
  generateBriefWithAI()
    .then(brief=>{
      S.briefText=brief;
      renderReport(brief);
    })
    .catch(err=>{
      console.warn('AI failed, using fallback:',err);
      // Fallback imm√©diat si AI √©choue
      const brief=fallback();
      S.briefText=brief;
      renderReport(brief);
    });
}

// G√©n√©ration avec Hugging Face AI (mod√®le gratuit de qualit√©)
async function generateBriefWithAI(){
  const HF_TOKEN='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';
  
  // Construire le prompt en langue cible
  const promptLang={
    fr:`Tu es Marina, photographe professionnelle √† Sitges. R√©dige un brief photo personnalis√© et chaleureux (180-220 mots, 3 paragraphes) pour ${S.name||'ce client'}.

PROJET: ${S.project||'projet photo'} - Type: ${S.type||'‚Äî'} - Secteur d√©tect√©: ${fallback().split('(')[1]?.split(')')[0]||'g√©n√©ral'}
Priorit√©s: ${S.priorities.join(', ')||'‚Äî'} | Usage: ${S.usage||'‚Äî'} | Canaux: ${S.channels.join(', ')||'‚Äî'}
Lieu: ${S.location||'‚Äî'} | Timing: ${S.timing||'‚Äî'}
Style: √ânergie ${S.calm}/100, Proximit√© ${S.present}/100, Esth√©tique ${S.rich}/100

Ton: professionnel mais chaleureux, tutoiement, une touche d'humour subtil si le secteur s'y pr√™te. Utilise le pr√©nom du client. Pas de liste, pas de prix.`,
    en:`You're Marina, professional photographer in Sitges. Write a personalized, warm photo brief (180-220 words, 3 paragraphs) for ${S.name||'this client'}.

PROJECT: ${S.project||'photo project'} - Type: ${S.type||'‚Äî'} - Detected sector: ${fallback().split('(')[1]?.split(')')[0]||'general'}
Priorities: ${S.priorities.join(', ')||'‚Äî'} | Use: ${S.usage||'‚Äî'} | Channels: ${S.channels.join(', ')||'‚Äî'}
Location: ${S.location||'‚Äî'} | Timeline: ${S.timing||'‚Äî'}
Style: Energy ${S.calm}/100, Proximity ${S.present}/100, Aesthetic ${S.rich}/100

Tone: professional but warm, use client's first name, subtle humor if appropriate. No lists, no pricing.`,
    es:`Eres Marina, fot√≥grafa profesional en Sitges. Escribe un brief fotogr√°fico personalizado y c√°lido (180-220 palabras, 3 p√°rrafos) para ${S.name||'este cliente'}.

PROYECTO: ${S.project||'proyecto foto'} - Tipo: ${S.type||'‚Äî'} - Sector detectado: ${fallback().split('(')[1]?.split(')')[0]||'general'}
Prioridades: ${S.priorities.join(', ')||'‚Äî'} | Uso: ${S.usage||'‚Äî'} | Canales: ${S.channels.join(', ')||'‚Äî'}
Lugar: ${S.location||'‚Äî'} | Planificaci√≥n: ${S.timing||'‚Äî'}
Estilo: Energ√≠a ${S.calm}/100, Proximidad ${S.present}/100, Est√©tica ${S.rich}/100

Tono: profesional pero c√°lido, usa el nombre del cliente, humor sutil si procede. Sin listas, sin precios.`,
    ca:`Ets la Marina, fot√≤grafa professional a Sitges. Escriu un brief fotogr√†fic personalitzat i c√†lid (180-220 paraules, 3 par√†grafs) per ${S.name||'aquest client'}.

PROJECTE: ${S.project||'projecte foto'} - Tipus: ${S.type||'‚Äî'} - Sector detectat: ${fallback().split('(')[1]?.split(')')[0]||'general'}
Prioritats: ${S.priorities.join(', ')||'‚Äî'} | √ös: ${S.usage||'‚Äî'} | Canals: ${S.channels.join(', ')||'‚Äî'}
Lloc: ${S.location||'‚Äî'} | Planificaci√≥: ${S.timing||'‚Äî'}
Estil: Energia ${S.calm}/100, Proximitat ${S.present}/100, Est√®tica ${S.rich}/100

To: professional per√≤ c√†lid, fes servir el nom del client, humor subtil si escau. Sense llistes, sense preus.`
  };

  try{
    const response=await fetch('https://api-inference.huggingface.co/models/mistralai/Mixtral-8x7B-Instruct-v0.1',{
      method:'POST',
      headers:{
        'Authorization':`Bearer ${HF_TOKEN}`,
        'Content-Type':'application/json'
      },
      body:JSON.stringify({
        inputs:promptLang[L]||promptLang.en,
        parameters:{
          max_new_tokens:400,
          temperature:0.7,
          top_p:0.9,
          return_full_text:false
        }
      })
    });

    if(!response.ok) throw new Error('HF API failed');
    
    const data=await response.json();
    let text=data[0]?.generated_text||'';
    
    // Nettoyer le texte
    text=text.trim();
    if(!text || text.length<100) throw new Error('Response too short');
    
    return text;
  }catch(err){
    console.warn('Hugging Face AI error:',err);
    throw err; // D√©clenche le fallback
  }
}

// Fallback ultra-riche ‚Äî VOIX DU CLIENT qui d√©crit ce qu'il veut
function fallback(){
  const proj=S.project||'';
  const c=S.calm, p=S.present, r=S.rich;

  // D√©duire le secteur du nom du projet - TOP 30 secteurs Sitges/Barcelona
  const inferSector=(name)=>{
    const n=name.toLowerCase();
    
    // H√¥tellerie & Tourisme (tr√®s courant √† Sitges)
    if(/hotel|hostal|apart|boutique.*hotel|casa.*rural|mas\b|can\s/i.test(n)) return 'hotel';
    if(/beach.*club|club.*playa|platja|chiringuito/i.test(n)) return 'beach-club';
    if(/experi[e√®]ncia|experien|tour|excurs|activit.*tour/i.test(n)) return 'tourism-exp';
    if(/transport|transfer|taxi|vtc|shuttle/i.test(n)) return 'transport';
    
    // Gastronomie
    if(/restaura|gastro|cuina|cocina|kitchen|bistro|tavern/i.test(n)) return 'restaurant';
    if(/bode?ga|celler|vi[n√±]|wine|vi\b/i.test(n)) return 'wine';
    if(/caf[e√©]|coffee|barista/i.test(n)) return 'cafe';
    if(/bar\b|tapas|vermut/i.test(n)) return 'bar';
    
    // Sant√© & Bien-√™tre (tr√®s pr√©sent √† Sitges)
    if(/dent|odonto|clinic.*dent/i.test(n)) return 'dental';
    if(/m[e√©]dic|clinic|doctor|salud|health/i.test(n)) return 'medical';
    if(/est[e√©]tic|beauty|spa|wellness|massage/i.test(n)) return 'beauty';
    if(/fisio|physio|quirop/i.test(n)) return 'physio';
    if(/yoga|pilates|fitness|gym/i.test(n)) return 'fitness';
    
    // Immobilier & Construction
    if(/inmobil|real.*estate|propied|viviend|pis.*venta|venta.*casa/i.test(n)) return 'realestate';
    if(/architect|arquitec|estudi.*disseny|interio/i.test(n)) return 'architecture';
    if(/construc|obra|reform|rehabilit/i.test(n)) return 'construction';
    
    // Commerce & Services locaux
    if(/taller|atelier|artesa|craft|joier|bijou/i.test(n)) return 'craft';
    if(/botiga|tienda|shop|store|boutique/i.test(n)) return 'retail';
    if(/florist|flor|garden/i.test(n)) return 'florist';
    if(/vie.*locale|comer.*local|mercat|market/i.test(n)) return 'local-life';
    
    // Cr√©atif & Design
    if(/estudi|studio|design|gr√†fic|graphic/i.test(n)) return 'design';
    if(/fotograf|photo.*studio/i.test(n)) return 'photo-studio';
    if(/galer[i√≠]|art.*space|sala.*exposi/i.test(n)) return 'gallery';
    
    // √âv√©nementiel (d√©taill√©)
    if(/event|celebra|festes|party/i.test(n)) return 'events';
    if(/wedding|boda|casament|nuvi/i.test(n)) return 'wedding';
    if(/congr[e√®]s|congress|confer[e√®]n|seminar/i.test(n)) return 'corporate-events';
    
    // Formation & √âducation
    if(/formaci[o√≥]|training|cours|clase|ense√±|school|academi/i.test(n)) return 'training';
    if(/escuela|escola|college|universit/i.test(n)) return 'education';
    
    // Services professionnels
    if(/fiduci|asesor|consult|gestori|comptab|accounta/i.test(n)) return 'fiduciary';
    if(/bureau|oficin|cowork|espacio.*trabajo|workspace/i.test(n)) return 'office-services';
    if(/administra|ayuntami|ajuntam|gobierno|govern|public/i.test(n)) return 'administration';
    
    // Industrie
    if(/indust|f[a√†]bric|manufact|producci√≥|production/i.test(n)) return 'industry';
    
    return null;
  };
  const sector=inferSector(proj);

  // Labels traduits
  const TYPE_L={
    fr:{place:'un lieu',story:'une histoire de marque',moment:'un moment de vie'},
    en:{place:'a place',story:'a brand story',moment:'a life moment'},
    es:{place:'un lugar',story:'una historia de marca',moment:'un momento de vida'},
    ca:{place:'un lloc',story:'una hist√≤ria de marca',moment:'un moment de vida'}
  };
  const PRIO_L={
    fr:{auth:'authenticit√©',brand:'coh√©rence',singular:'singularit√©',trust:'cr√©dibilit√©'},
    en:{auth:'authenticity',brand:'coherence',singular:'singularity',trust:'credibility'},
    es:{auth:'autenticidad',brand:'coherencia',singular:'singularidad',trust:'credibilidad'},
    ca:{auth:'autenticitat',brand:'coher√®ncia',singular:'singularitat',trust:'credibilitat'}
  };
  const CHAN_L={
    fr:{web:'site web',social:'r√©seaux sociaux',press:'presse',print:'print'},
    en:{web:'website',social:'social media',press:'press',print:'print'},
    es:{web:'web',social:'redes sociales',press:'prensa',print:'impresi√≥n'},
    ca:{web:'web',social:'xarxes socials',press:'premsa',print:'impressi√≥'}
  };
  const LOC_L={
    fr:{sitges:'Sitges et environs (Garraf, Vilanova...)',bcn:'Barcelone',cat:'Catalogne',other:'en dehors de la Catalogne'},
    en:{sitges:'Sitges area (Garraf, Vilanova...)',bcn:'Barcelona',cat:'Catalonia',other:'outside Catalonia'},
    es:{sitges:'Sitges y alrededores (Garraf, Vilanova...)',bcn:'Barcelona',cat:'Catalu√±a',other:'fuera de Catalu√±a'},
    ca:{sitges:'Sitges i rodal (Garraf, Vilanova...)',bcn:'Barcelona',cat:'Catalunya',other:'fora de Catalunya'}
  };
  const TIM_L={
    fr:{fixed:'avec une date pr√©cise',approx:'dans les prochains mois',flex:'sans urgence, on peut planifier ensemble'},
    en:{fixed:'with a specific date',approx:'within the next few months',flex:'no rush, we can plan together'},
    es:{fixed:'con una fecha espec√≠fica',approx:'en los pr√≥ximos meses',flex:'sin prisa, podemos planificar juntos'},
    ca:{fixed:'amb una data espec√≠fica',approx:'en els propers mesos',flex:'sense pressa, podem planificar junts'}
  };

  const tl=S.type && TYPE_L[L] && TYPE_L[L][S.type] ? TYPE_L[L][S.type] : '';
  const prios=S.priorities.map(x=>PRIO_L[L] && PRIO_L[L][x] ? PRIO_L[L][x] : null).filter(x=>x);
  const chans=S.channels.map(x=>CHAN_L[L] && CHAN_L[L][x] ? CHAN_L[L][x] : null).filter(x=>x);
  const locStr=LOC_L[L] && LOC_L[L][S.location] ? LOC_L[L][S.location] : '';
  const timStr=TIM_L[L] && TIM_L[L][S.timing] ? TIM_L[L][S.timing] : '';
  const sep={fr:' et ',en:' and ',es:' y ',ca:' i '}[L];

  // Descriptions visuelles ancr√©es dans les curseurs
  const VIBE={
    fr:{
      calm:[
        'des images pos√©es, contemplatives, qui laissent le temps au regard de se poser',
        'un √©quilibre entre calme et mouvement, sans exc√®s',
        'de l\'√©nergie, du rythme, de la vie captur√©e en mouvement'
      ],
      present:[
        'des vues d\'ensemble qui donnent le contexte, de la profondeur de champ',
        'un √©quilibre entre contexte et d√©tails, selon les moments',
        'de l\'intimit√© : les mati√®res, les textures, les d√©tails, les gestes de pr√®s'
      ],
      rich:[
        'une esth√©tique √©pur√©e ‚Äî cadrages nets, peu d\'√©l√©ments, beaucoup d\'espace et de lumi√®re',
        'un √©quilibre entre sobri√©t√© et pr√©sence visuelle',
        'une richesse de textures, des ambiances denses, des images qui racontent par les mati√®res'
      ]
    },
    en:{
      calm:[
        'still, contemplative images that give the eye time to rest',
        'a balance between calm and movement, no extremes',
        'energy, rhythm, life captured in motion'
      ],
      present:[
        'wide shots that provide context, depth of field',
        'a balance between context and details, depending on the moment',
        'intimacy: materials, textures, details, gestures up close'
      ],
      rich:[
        'a clean aesthetic ‚Äî sharp framing, few elements, lots of space and light',
        'a balance between restraint and visual presence',
        'rich textures, dense atmosphere, images that tell through materials'
      ]
    },
    es:{
      calm:[
        'im√°genes serenas, contemplativas, que dan tiempo a la mirada para detenerse',
        'un equilibrio entre calma y movimiento, sin excesos',
        'energ√≠a, ritmo, vida capturada en movimiento'
      ],
      present:[
        'vistas generales que dan contexto, profundidad de campo',
        'un equilibrio entre contexto y detalles, seg√∫n los momentos',
        'intimidad: materiales, texturas, detalles, gestos de cerca'
      ],
      rich:[
        'una est√©tica limpia ‚Äî encuadres netos, pocos elementos, mucho espacio y luz',
        'un equilibrio entre sobriedad y presencia visual',
        'riqueza de texturas, ambientes densos, im√°genes que cuentan a trav√©s de los materiales'
      ]
    },
    ca:{
      calm:[
        'imatges serenes, contemplatives, que donen temps a la mirada per aturar-se',
        'un equilibri entre calma i moviment, sense excessos',
        'energia, ritme, vida capturada en moviment'
      ],
      present:[
        'vistes generals que donen context, profunditat de camp',
        'un equilibri entre context i detalls, segons els moments',
        'intimitat: materials, textures, detalls, gestos de prop'
      ],
      rich:[
        'una est√®tica neta ‚Äî enquadraments nets, pocs elements, molt espai i llum',
        'un equilibri entre sobrietat i pres√®ncia visual',
        'riquesa de textures, atmosferes denses, imatges que expliquen a trav√©s dels materials'
      ]
    }
  };

  const vCal=c<35?0:c>65?2:1;
  const vPre=p<35?0:p>65?2:1;
  const vRic=r<35?0:r>65?2:1;

  const calmTxt=VIBE[L] && VIBE[L].calm && VIBE[L].calm[vCal] ? VIBE[L].calm[vCal] : '';
  const preTxt=VIBE[L] && VIBE[L].present && VIBE[L].present[vPre] ? VIBE[L].present[vPre] : '';
  const ricTxt=VIBE[L] && VIBE[L].rich && VIBE[L].rich[vRic] ? VIBE[L].rich[vRic] : '';

  // Contexte sectoriel si identifi√© - TOP 30 secteurs
  const SECTOR_HINT={
    fr:{
      hotel:'l\'atmosph√®re de l\'espace, la lumi√®re dans les chambres, les d√©tails du lieu',
      'beach-club':'l\'ambiance estivale, la lumi√®re en terrasse, les moments de d√©tente au bord de mer',
      'tourism-exp':'les moments d\'exp√©rience, les participants en action, l\'√©motion de la d√©couverte',
      transport:'les v√©hicules, l\'environnement professionnel, le confort et la modernit√©',
      restaurant:'la lumi√®re sur les assiettes, les gestes en cuisine, l\'atmosph√®re du service',
      wine:'les vignes, la lumi√®re sur les barriques, les gestes de la vinification',
      cafe:'la lumi√®re du matin, les tasses, les moments du quotidien, l\'ambiance chaleureuse',
      bar:'l\'ambiance du soir, les verres, les moments de convivialit√©',
      dental:'l\'environnement moderne et rassurant, les gestes pr√©cis, la lumi√®re technique et douce',
      medical:'la confiance, l\'environnement professionnel, les gestes attentifs',
      beauty:'la lumi√®re douce, les gestes, l\'atmosph√®re relaxante et soign√©e',
      physio:'les mains au travail, le mouvement, l\'espace th√©rapeutique',
      fitness:'le mouvement, l\'√©nergie, la lumi√®re naturelle dans l\'espace',
      realestate:'les volumes, la lumi√®re naturelle, les espaces de vie, les d√©tails architecturaux',
      architecture:'les lignes, les volumes, la mati√®re et la fa√ßon dont la lumi√®re les r√©v√®le',
      construction:'les chantiers, les mat√©riaux, le travail en cours, l\'environnement professionnel',
      craft:'les mains au travail, les mati√®res premi√®res, la lumi√®re de l\'atelier',
      retail:'les produits, l\'agencement, l\'ambiance du lieu',
      florist:'les fleurs, les textures, la lumi√®re naturelle, les compositions',
      'local-life':'les moments du quotidien, les gens, l\'authenticit√© du lieu',
      design:'les lignes, les volumes, la mati√®re et comment la lumi√®re interagit',
      'photo-studio':'l\'espace de travail, la lumi√®re technique, l\'environnement cr√©atif',
      gallery:'les ≈ìuvres, l\'espace d\'exposition, la lumi√®re sur les murs',
      events:'les moments, les √©motions, l\'ambiance, les d√©tails qui racontent',
      wedding:'l\'√©motion, les d√©tails, la lumi√®re du jour, les moments intimes',
      'corporate-events':'le professionnalisme, les interactions, l\'espace de conf√©rence',
      training:'les participants en action, les interactions, l\'environnement d\'apprentissage',
      education:'les √©tudiants, l\'environnement p√©dagogique, les moments d\'apprentissage',
      fiduciary:'le professionnalisme, la confiance, l\'environnement de bureau moderne',
      'office-services':'l\'espace de travail, la modernit√©, les √©quipes en action',
      administration:'les espaces publics, l\'architecture, l\'environnement institutionnel',
      industry:'les machines, le processus de production, les travailleurs en action, la lumi√®re industrielle'
    },
    en:{
      hotel:'the atmosphere of the space, light in the rooms, details of the place',
      'beach-club':'summer vibes, light on the terrace, relaxed moments by the sea',
      'tourism-exp':'experience moments, participants in action, the emotion of discovery',
      transport:'vehicles, professional environment, comfort and modernity',
      restaurant:'light on the plates, gestures in the kitchen, the atmosphere of service',
      wine:'the vines, light on the barrels, gestures of winemaking',
      cafe:'morning light, cups, everyday moments, warm atmosphere',
      bar:'evening ambiance, glasses, convivial moments',
      dental:'modern and reassuring environment, precise gestures, soft yet technical lighting',
      medical:'trust, professional environment, attentive gestures',
      beauty:'soft light, gestures, relaxing and refined atmosphere',
      physio:'hands at work, movement, therapeutic space',
      fitness:'movement, energy, natural light in the space',
      realestate:'volumes, natural light, living spaces, architectural details',
      architecture:'lines, volumes, materials and how light reveals them',
      construction:'construction sites, materials, work in progress, professional environment',
      craft:'hands at work, raw materials, workshop light',
      retail:'products, layout, atmosphere of the place',
      florist:'flowers, textures, natural light, compositions',
      'local-life':'everyday moments, people, authenticity of the place',
      design:'lines, volumes, materials and how light interacts',
      'photo-studio':'workspace, technical lighting, creative environment',
      gallery:'artworks, exhibition space, light on the walls',
      events:'moments, emotions, atmosphere, storytelling details',
      wedding:'emotion, details, daylight, intimate moments',
      'corporate-events':'professionalism, interactions, conference space',
      training:'participants in action, interactions, learning environment',
      education:'students, educational environment, learning moments',
      fiduciary:'professionalism, trust, modern office environment',
      'office-services':'workspace, modernity, teams in action',
      administration:'public spaces, architecture, institutional environment',
      industry:'machines, production process, workers in action, industrial lighting'
    },
    es:{
      hotel:'la atm√≥sfera del espacio, la luz en las habitaciones, los detalles del lugar',
      'beach-club':'ambiente veraniego, luz en la terraza, momentos de relax junto al mar',
      'tourism-exp':'momentos de experiencia, participantes en acci√≥n, la emoci√≥n del descubrimiento',
      transport:'los veh√≠culos, el ambiente profesional, el confort y la modernidad',
      restaurant:'la luz sobre los platos, los gestos en la cocina, la atm√≥sfera del servicio',
      wine:'las vi√±as, la luz sobre las barricas, los gestos de la vinificaci√≥n',
      cafe:'la luz de la ma√±ana, las tazas, los momentos cotidianos, el ambiente acogedor',
      bar:'el ambiente nocturno, las copas, los momentos de convivencia',
      dental:'entorno moderno y tranquilizador, gestos precisos, iluminaci√≥n t√©cnica y suave',
      medical:'confianza, entorno profesional, gestos atentos',
      beauty:'luz suave, gestos, atm√≥sfera relajante y cuidada',
      physio:'manos trabajando, movimiento, espacio terap√©utico',
      fitness:'movimiento, energ√≠a, luz natural en el espacio',
      realestate:'vol√∫menes, luz natural, espacios de vida, detalles arquitect√≥nicos',
      architecture:'l√≠neas, vol√∫menes, materiales y c√≥mo la luz los revela',
      construction:'obras, materiales, trabajo en curso, ambiente profesional',
      craft:'manos trabajando, materias primas, luz del taller',
      retail:'productos, disposici√≥n, ambiente del lugar',
      florist:'flores, texturas, luz natural, composiciones',
      'local-life':'momentos cotidianos, personas, autenticidad del lugar',
      design:'l√≠neas, vol√∫menes, materiales y c√≥mo interact√∫a la luz',
      'photo-studio':'espacio de trabajo, iluminaci√≥n t√©cnica, ambiente creativo',
      gallery:'obras, espacio expositivo, luz sobre las paredes',
      events:'momentos, emociones, ambiente, detalles que cuentan historias',
      wedding:'emoci√≥n, detalles, luz del d√≠a, momentos √≠ntimos',
      'corporate-events':'profesionalismo, interacciones, espacio de conferencia',
      training:'participantes en acci√≥n, interacciones, ambiente de aprendizaje',
      education:'estudiantes, ambiente educativo, momentos de aprendizaje',
      fiduciary:'profesionalismo, confianza, ambiente de oficina moderna',
      'office-services':'espacio de trabajo, modernidad, equipos en acci√≥n',
      administration:'espacios p√∫blicos, arquitectura, ambiente institucional',
      industry:'m√°quinas, proceso de producci√≥n, trabajadores en acci√≥n, iluminaci√≥n industrial'
    },
    ca:{
      hotel:'l\'atmosfera de l\'espai, la llum a les habitacions, els detalls del lloc',
      'beach-club':'ambient estiuenc, llum a la terrassa, moments de relax vora el mar',
      'tourism-exp':'moments d\'experi√®ncia, participants en acci√≥, l\'emoci√≥ del descobriment',
      transport:'els vehicles, l\'ambient professional, el confort i la modernitat',
      restaurant:'la llum sobre els plats, els gestos a la cuina, l\'atmosfera del servei',
      wine:'les vinyes, la llum sobre les barriques, els gestos de la vinificaci√≥',
      cafe:'la llum del mat√≠, les tasses, els moments quotidians, l\'ambient acollidor',
      bar:'l\'ambient nocturn, les copes, els moments de conviv√®ncia',
      dental:'entorn modern i tranquil¬∑litzador, gestos precisos, il¬∑luminaci√≥ t√®cnica i suau',
      medical:'confian√ßa, entorn professional, gestos atents',
      beauty:'llum suau, gestos, atmosfera relaxant i acurada',
      physio:'mans treballant, moviment, espai terap√®utic',
      fitness:'moviment, energia, llum natural a l\'espai',
      realestate:'volums, llum natural, espais de vida, detalls arquitect√≤nics',
      architecture:'l√≠nies, volums, materials i com la llum els revela',
      construction:'obres, materials, treball en curs, ambient professional',
      craft:'mans treballant, mat√®ries primeres, llum del taller',
      retail:'productes, disposici√≥, ambient del lloc',
      florist:'flors, textures, llum natural, composicions',
      'local-life':'moments quotidians, persones, autenticitat del lloc',
      design:'l√≠nies, volums, materials i com interactua la llum',
      'photo-studio':'espai de treball, il¬∑luminaci√≥ t√®cnica, ambient creatiu',
      gallery:'obres, espai expositiu, llum sobre les parets',
      events:'moments, emocions, ambient, detalls que expliquen hist√≤ries',
      wedding:'emoci√≥, detalls, llum del dia, moments √≠ntims',
      'corporate-events':'professionalitat, interaccions, espai de confer√®ncia',
      training:'participants en acci√≥, interaccions, ambient d\'aprenentatge',
      education:'estudiants, ambient educatiu, moments d\'aprenentatge',
      fiduciary:'professionalitat, confian√ßa, ambient d\'oficina moderna',
      'office-services':'espai de treball, modernitat, equips en acci√≥',
      administration:'espais p√∫blics, arquitectura, ambient institucional',
      industry:'m√†quines, proc√©s de producci√≥, treballadors en acci√≥, il¬∑luminaci√≥ industrial'
    }
  };
  const sectorHint=sector && SECTOR_HINT[L] && SECTOR_HINT[L][sector] ? SECTOR_HINT[L][sector] : '';

  // PARAGRAPHE 1 : Projet + besoin - TOUS les secteurs
  const SECTOR_NAMES={
    fr:{hotel:'h√¥tellerie','beach-club':'club de plage','tourism-exp':'exp√©riences touristiques',transport:'transport',restaurant:'gastronomie',wine:'vignoble',cafe:'caf√©',bar:'bar',dental:'cabinet dentaire',medical:'m√©dical',beauty:'esth√©tique & spa',physio:'physioth√©rapie',fitness:'fitness & sport',realestate:'immobilier',architecture:'architecture',construction:'construction',craft:'artisanat',retail:'commerce',florist:'fleuriste','local-life':'vie locale',design:'design','photo-studio':'studio photo',gallery:'galerie d\'art',events:'√©v√©nementiel',wedding:'mariage','corporate-events':'√©v√©nements corporate',training:'formation',education:'√©ducation',fiduciary:'fiduciaire','office-services':'services de bureau',administration:'administration',industry:'industrie'},
    en:{hotel:'hospitality','beach-club':'beach club','tourism-exp':'tourism experiences',transport:'transport',restaurant:'gastronomy',wine:'winery',cafe:'caf√©',bar:'bar',dental:'dental clinic',medical:'medical',beauty:'beauty & spa',physio:'physiotherapy',fitness:'fitness & sports',realestate:'real estate',architecture:'architecture',construction:'construction',craft:'craft',retail:'retail',florist:'florist','local-life':'local life',design:'design','photo-studio':'photo studio',gallery:'art gallery',events:'events',wedding:'wedding','corporate-events':'corporate events',training:'training',education:'education',fiduciary:'fiduciary','office-services':'office services',administration:'administration',industry:'industry'},
    es:{hotel:'hosteler√≠a','beach-club':'club de playa','tourism-exp':'experiencias tur√≠sticas',transport:'transporte',restaurant:'gastronom√≠a',wine:'vi√±edo',cafe:'caf√©',bar:'bar',dental:'cl√≠nica dental',medical:'m√©dico',beauty:'est√©tica & spa',physio:'fisioterapia',fitness:'fitness & deporte',realestate:'inmobiliaria',architecture:'arquitectura',construction:'construcci√≥n',craft:'artesan√≠a',retail:'comercio',florist:'florister√≠a','local-life':'vida local',design:'dise√±o','photo-studio':'estudio fotogr√°fico',gallery:'galer√≠a de arte',events:'eventos',wedding:'boda','corporate-events':'eventos corporativos',training:'formaci√≥n',education:'educaci√≥n',fiduciary:'fiduciario','office-services':'servicios de oficina',administration:'administraci√≥n',industry:'industria'},
    ca:{hotel:'hostaleria','beach-club':'club de platja','tourism-exp':'experi√®ncies tur√≠stiques',transport:'transport',restaurant:'gastronomia',wine:'vinya',cafe:'caf√®',bar:'bar',dental:'cl√≠nica dental',medical:'m√®dic',beauty:'est√®tica & spa',physio:'fisioter√†pia',fitness:'fitness & esport',realestate:'immobili√†ria',architecture:'arquitectura',construction:'construcci√≥',craft:'artesania',retail:'comer√ß',florist:'floristeria','local-life':'vida local',design:'disseny','photo-studio':'estudi fotogr√†fic',gallery:'galeria d\'art',events:'esdeveniments',wedding:'casament','corporate-events':'esdeveniments corporatius',training:'formaci√≥',education:'educaci√≥',fiduciary:'fiduciari','office-services':'serveis d\'oficina',administration:'administraci√≥',industry:'ind√∫stria'}
  };
  
  const sectorName=sector && SECTOR_NAMES[L] && SECTOR_NAMES[L][sector] ? SECTOR_NAMES[L][sector] : '';
  
  const INTRO={
    fr:`${proj?proj+' ‚Äî ':''}photographier ${tl}${sectorName?' ('+sectorName+')':''}, destin√© ${chans.length?'√† '+chans.join(sep):'√† vos supports'}. ${prios.length?'Vos priorit√©s : '+prios.join(sep)+'.':''}`,
    en:`${proj?proj+' ‚Äî ':''}photographing ${tl}${sectorName?' ('+sectorName+')':''}, for ${chans.length?chans.join(sep):'your channels'}. ${prios.length?'Your priorities: '+prios.join(sep)+'.':''}`,
    es:`${proj?proj+' ‚Äî ':''}fotografiar ${tl}${sectorName?' ('+sectorName+')':''}, destinado ${chans.length?'a '+chans.join(sep):'a tus plataformas'}. ${prios.length?'Tus prioridades: '+prios.join(sep)+'.':''}`,
    ca:`${proj?proj+' ‚Äî ':''}fotografiar ${tl}${sectorName?' ('+sectorName+')':''}, destinat ${chans.length?'a '+chans.join(sep):'a les teves plataformes'}. ${prios.length?'Les teves prioritats: '+prios.join(sep)+'.':''}`
  };

  // PARAGRAPHE 2 : Direction photographique - PERSONNALIS√â avec humour subtil
  const DIRECTION={
    fr:`${S.name?S.name+', vous':'Vous'} souhaitez ${calmTxt}${sectorHint?', en valorisant '+sectorHint:''}. Visuellement : ${preTxt}. ${ricTxt.charAt(0).toUpperCase()+ricTxt.slice(1)}. ${sector==='wine'?'(Et oui, on va faire briller ces barriques !)':sector==='restaurant'?'(Promis, on donnera faim aux gens.)':sector==='wedding'?'(Les mouchoirs ne seront pas de trop.)':sector==='fitness'?'(On captera l\'√©nergie, pas la transpiration.)':''}`,
    en:`${S.name?S.name+', you':'You'} want ${calmTxt}${sectorHint?', highlighting '+sectorHint:''}. Visually: ${preTxt}. ${ricTxt.charAt(0).toUpperCase()+ricTxt.slice(1)}. ${sector==='wine'?'(Yes, we\'ll make those barrels shine!)':sector==='restaurant'?'(Promise, we\'ll make people hungry.)':sector==='wedding'?'(Tissues recommended.)':sector==='fitness'?'(We\'ll capture the energy, not the sweat.)':''}`,
    es:`${S.name?S.name+', quieres':'Quieres'} ${calmTxt}${sectorHint?', valorando '+sectorHint:''}. Visualmente: ${preTxt}. ${ricTxt.charAt(0).toUpperCase()+ricTxt.slice(1)}. ${sector==='wine'?'(¬°S√≠, haremos brillar esas barricas!)':sector==='restaurant'?'(Promesa: daremos hambre a la gente.)':sector==='wedding'?'(Los pa√±uelos no sobrar√°n.)':sector==='fitness'?'(Capturaremos la energ√≠a, no el sudor.)':''}`,
    ca:`${S.name?S.name+', vols':'Vols'} ${calmTxt}${sectorHint?', valorant '+sectorHint:''}. Visualment: ${preTxt}. ${ricTxt.charAt(0).toUpperCase()+ricTxt.slice(1)}. ${sector==='wine'?'(S√≠, farem brillar aquestes barriques!)':sector==='restaurant'?'(Prom√®s: farem venir gana.)':sector==='wedding'?'(Els mocadors no sobren.)':sector==='fitness'?'(Capturarem l\'energia, no la suor.)':''}`
  };

  // PARAGRAPHE 3 : Logistique - PERSONNALIS√â
  const LOGISTICS={
    fr:`Lieu : ${locStr}. Planning : ${timStr}. ${S.name?S.name+', ':''}discutons ensemble pour affiner ce brief et organiser la s√©ance. ${S.email?'Je vous contacte vite √† '+S.email+' !':'√Ä tr√®s bient√¥t !'}`,
    en:`Location: ${locStr}. Timeline: ${timStr}. ${S.name?S.name+', ':''}let's talk to refine this brief and organize the shoot. ${S.email?'I\'ll reach out soon at '+S.email+'!':'Talk soon!'}`,
    es:`Lugar: ${locStr}. Planificaci√≥n: ${timStr}. ${S.name?S.name+', ':''}hablemos para afinar este brief y organizar la sesi√≥n. ${S.email?'Te contacto pronto a '+S.email+'!':'¬°Hasta pronto!'}`,
    ca:`Lloc: ${locStr}. Planificaci√≥: ${timStr}. ${S.name?S.name+', ':''}parlem per afinar aquest brief i organitzar la sessi√≥. ${S.email?'Et contacto aviat a '+S.email+'!':'Fins aviat!'}`
  };

  return (INTRO[L]||INTRO.en)+'\n\n'+(DIRECTION[L]||DIRECTION.en)+'\n\n'+(LOGISTICS[L]||LOGISTICS.en);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER RAPPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderReport(txt){
  const c=document.getElementById('card');
  const proj=S.project||(L==='fr'?'Votre projet':L==='es'?'Tu proyecto':L==='ca'?'El teu projecte':'Your project');
  const locale={fr:'fr-FR',en:'en-GB',es:'es-ES',ca:'ca-ES'}[L]||'en-GB';
  const date=new Date().toLocaleDateString(locale,{day:'numeric',month:'long',year:'numeric'});
  const paras=txt.split('\n\n').filter(p=>p.trim()).map(p=>`<p>${p.trim()}</p>`).join('');
  c.innerHTML=`
    <div class="rpt-hero">
      <h1>${proj}</h1>
      ${S.name?`<div class="client">${S.name}</div>`:''}
      <div class="rdate">${date}</div>
    </div>
    <div class="rpt-body">${paras}</div>
    <div class="rpt-cta">
      <h2>${t('report.ctaTitle')}</h2>
      <div class="closing-q">"${t('report.ctaQuote')}"</div>
      <p>${t('report.ctaText')}</p>
      <div class="cta-btns">
        <button class="bp" onclick="doEmail().catch(e=>console.error('Email error:',e))">${t('report.btnEmail')}</button>
        <button class="bs" onclick="doRdv()">${t('report.btnRdv')}</button>
        <button class="bs" onclick="doPDF()">${t('report.btnPdf')}</button>
        <button class="bs" onclick="doRestart()">${t('report.btnRestart')}</button>
      </div>
    </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ACTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function doEmail(){
  const NL='\n';

  // Labels lisibles
  const TYPE_L={fr:{place:'Lieu',story:'Narration / Marque',moment:'Moment'},en:{place:'Place',story:'Brand story',moment:'Moment'},es:{place:'Lugar',story:'Historia / Marca',moment:'Momento'},ca:{place:'Lloc',story:'Hist√≤ria / Marca',moment:'Moment'}};
  const PRIO_L={fr:{auth:'Authenticit√©',brand:'Coh√©rence',singular:'Singularit√©',trust:'Cr√©dibilit√©'},en:{auth:'Authenticity',brand:'Coherence',singular:'Singularity',trust:'Credibility'},es:{auth:'Autenticidad',brand:'Coherencia',singular:'Singularidad',trust:'Credibilidad'},ca:{auth:'Autenticitat',brand:'Coher√®ncia',singular:'Singularitat',trust:'Credibilitat'}};
  const CHAN_L={fr:{web:'Site web',social:'R√©seaux sociaux',press:'Presse',print:'Print'},en:{web:'Website',social:'Social media',press:'Press',print:'Print'},es:{web:'Web',social:'Redes sociales',press:'Prensa',print:'Print'},ca:{web:'Web',social:'Xarxes socials',press:'Premsa',print:'Print'}};
  const LOC_L={fr:{sitges:'Sitges et environs',bcn:'Barcelone',cat:'Catalogne',other:'Hors Catalogne'},en:{sitges:'Sitges area',bcn:'Barcelona',cat:'Catalonia',other:'Outside Catalonia'},es:{sitges:'Sitges y alrededores',bcn:'Barcelona',cat:'Catalu√±a',other:'Fuera de Catalu√±a'},ca:{sitges:'Sitges i rodal',bcn:'Barcelona',cat:'Catalunya',other:'Fora de Catalunya'}};
  const TIM_L={fr:{fixed:'Date fix√©e',approx:'P√©riode approximative',flex:'Flexible'},en:{fixed:'Fixed date',approx:'Approximate period',flex:'Flexible'},es:{fixed:'Fecha fija',approx:'Per√≠odo aproximado',flex:'Flexible'},ca:{fixed:'Data fixada',approx:'Per√≠ode aproximat',flex:'Flexible'}};
  const VIBE_L={fr:['Calme','√âquilibr√©','Vivant'],en:['Calm','Balanced','Lively'],es:['Calmo','Equilibrado','Vivo'],ca:['Calmat','Equilibrat','Viu']};
  const vibeWord=(val)=>val<35?VIBE_L[L][0]:val>65?VIBE_L[L][2]:VIBE_L[L][1];

  const FIELDS={
    fr:{proj:'Projet',type:'Type',prio:'Priorit√©s',usage:'Usage',chan:'Diffusion',loc:'Lieu',tim:'Planning',calm:'√ânergie',pres:'Proximit√©',rich:'Esth√©tique',email:'Email'},
    en:{proj:'Project',type:'Type',prio:'Priorities',usage:'Use',chan:'Distribution',loc:'Location',tim:'Timeline',calm:'Energy',pres:'Proximity',rich:'Aesthetic',email:'Email'},
    es:{proj:'Proyecto',type:'Tipo',prio:'Prioridades',usage:'Uso',chan:'Difusi√≥n',loc:'Lugar',tim:'Planificaci√≥n',calm:'Energ√≠a',pres:'Proximidad',rich:'Est√©tica',email:'Email'},
    ca:{proj:'Projecte',type:'Tipus',prio:'Prioritats',usage:'√ös',chan:'Difusi√≥',loc:'Lloc',tim:'Planificaci√≥',calm:'Energia',pres:'Proximitat',rich:'Est√®tica',email:'Email'}
  };
  const F=FIELDS[L]||FIELDS.en;

  const subj=t('emailSubj')+': '+(S.project||'‚Äî');

  const formBlock=[
    `${F.proj}: ${S.project||'‚Äî'}`,
    `${F.type}: ${TYPE_L[L] && TYPE_L[L][S.type] ? TYPE_L[L][S.type] : '‚Äî'}`,
    `${F.prio}: ${S.priorities.map(x=>PRIO_L[L] && PRIO_L[L][x] ? PRIO_L[L][x] : null).filter(x=>x).join(', ')||'‚Äî'}`,
    `${F.usage}: ${(function(){const u={launch:{fr:'Lancement',en:'Launch',es:'Lanzamiento',ca:'Llan√ßament'},base:{fr:'Biblioth√®que',en:'Library',es:'Biblioteca',ca:'Biblioteca'},series:{fr:'S√©rie',en:'Series',es:'Serie',ca:'S√®rie'}};return u[S.usage] && u[S.usage][L] ? u[S.usage][L] : '‚Äî';})()}`,
    `${F.chan}: ${S.channels.map(x=>CHAN_L[L] && CHAN_L[L][x] ? CHAN_L[L][x] : null).filter(x=>x).join(', ')||'‚Äî'}`,
    `${F.loc}: ${LOC_L[L] && LOC_L[L][S.location] ? LOC_L[L][S.location] : '‚Äî'}`,
    `${F.tim}: ${TIM_L[L] && TIM_L[L][S.timing] ? TIM_L[L][S.timing] : '‚Äî'}`,
    `${F.calm}: ${S.calm}/100 (${vibeWord(S.calm)})`,
    `${F.pres}: ${S.present}/100 (${vibeWord(S.present)})`,
    `${F.rich}: ${S.rich}/100 (${vibeWord(S.rich)})`,
    `${F.email}: ${S.email||'‚Äî'}`
  ].join(NL);

  const emailBody=
    t('emailHi')+NL+NL+
    t('emailIntro')+NL+NL+
    '‚îÅ‚îÅ‚îÅ BRIEF ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ'+NL+NL+
    (S.briefText||fallback())+NL+NL+
    '‚îÅ‚îÅ‚îÅ FORMULAIRE ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ'+NL+NL+
    formBlock+NL+NL+
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ'+NL+NL+
    t('emailSign')+NL+(S.name||'');

  const sendMsg={
    fr:{sending:'Envoi...',success:'‚úÖ Brief envoy√©!',error:'Erreur. Redirection vers votre client mail...'},
    en:{sending:'Sending...',success:'‚úÖ Brief sent!',error:'Error. Redirecting to your mail client...'},
    es:{sending:'Enviando...',success:'‚úÖ Brief enviado!',error:'Error. Redirigiendo a tu cliente de correo...'},
    ca:{sending:'Enviant...',success:'‚úÖ Brief enviat!',error:'Error. Redirigint al teu client de correu...'}
  };
  const msg=sendMsg[L]||sendMsg.en;

  // Trouver le bouton qui a d√©clench√© l'action
  const btn=document.querySelector('.cta-btns .bp');
  if(btn){
    const origTxt=btn.textContent;
    btn.textContent=msg.sending;
    btn.disabled=true;

    try{
      // Envoi direct via Web3Forms
      const res=await fetch('https://api.web3forms.com/submit',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({
          access_key: '31469485-cf3b-405a-832e-c6b18c9911ea',
          subject: subj,
          from_name: S.name||'Questionnaire Marinaphoto',
          email: S.email,
          message: emailBody,
          to: 'info@marinaphoto.es'
        })
      });

      if(!res.ok) throw new Error('Web3Forms failed');
      const data=await res.json();
      if(!data.success) throw new Error(data.message||'Send failed');
      
      alert(msg.success);
    }catch(err){
      console.warn('Direct send failed, using mailto fallback:',err);
      alert(msg.error);
      // Fallback mailto si Web3Forms √©choue
      window.location.href=`mailto:info@marinaphoto.es?subject=${encodeURIComponent(subj)}&body=${encodeURIComponent(emailBody)}`;
    }finally{
      btn.textContent=origTxt;
      btn.disabled=false;
    }
  }else{
    // Si le bouton n'est pas trouv√©, utiliser directement mailto
    window.location.href=`mailto:info@marinaphoto.es?subject=${encodeURIComponent(subj)}&body=${encodeURIComponent(emailBody)}`;
  }
}

function doRdv(){
  window.open('https://calendly.com/ericimstepf/30min','_blank','noopener');
}

function doPDF(){
  // V√©rifier que jsPDF est charg√©
  if(typeof window.jspdf==='undefined' || !window.jspdf.jsPDF){
    alert({
      fr:'Erreur : le module PDF n\'est pas charg√©. Veuillez recharger la page.',
      en:'Error: PDF module not loaded. Please reload the page.',
      es:'Error: m√≥dulo PDF no cargado. Por favor recargue la p√°gina.',
      ca:'Error: m√≤dul PDF no carregat. Si us plau, recarrega la p√†gina.'
    }[L]||'PDF module error');
    return;
  }

  try{
    const {jsPDF}=window.jspdf;
    const doc=new jsPDF({unit:'mm',format:'a4',orientation:'portrait'});
    const gold=[200,168,130], dark=[44,44,44], white=[254,254,254], cream=[245,241,232];
    const W=210, margin=18;

    // --- HEADER BAND ---
    doc.setFillColor(...gold);
    doc.rect(0,0,W,38,'F');
    doc.setTextColor(...white);
    doc.setFontSize(18);doc.setFont('helvetica','bold');
    doc.text('MARINAPHOTO',margin,16);
    doc.setFontSize(9);doc.setFont('helvetica','normal');
    doc.text('Photography Brief',margin,24);
    const locale={fr:'fr-FR',en:'en-GB',es:'es-ES',ca:'ca-ES'}[L]||'en-GB';
    const dateStr=new Date().toLocaleDateString(locale,{day:'numeric',month:'long',year:'numeric'});
    doc.text(dateStr,W-margin,24,{align:'right'});

    // --- HERO PROJECT NAME ---
    doc.setFillColor(...cream);
    doc.rect(0,38,W,36,'F');
    doc.setTextColor(...dark);
    doc.setFontSize(26);doc.setFont('helvetica','bold');
    const proj=S.project||(L==='fr'?'Votre projet':L==='es'?'Tu proyecto':L==='ca'?'El teu projecte':'Your project');
    doc.text(proj,margin,58);
    if(S.name){
      doc.setFontSize(12);doc.setFont('helvetica','normal');
      doc.setTextColor(...gold);
      doc.text(S.name,margin,68);
    }

    // --- GOLD VERTICAL BAR + BRIEF TEXT ---
    let y=88;
    doc.setFillColor(...gold);
    doc.rect(margin,y,2,140,'F');

    doc.setTextColor(...dark);
    doc.setFontSize(11);doc.setFont('helvetica','normal');
    const briefTxt=S.briefText||fallback();
    const lines=doc.splitTextToSize(briefTxt,W-margin*2-8);
    lines.forEach(ln=>{
      if(y>262){doc.addPage();y=20;
        doc.setFillColor(...gold);doc.rect(margin,y,2,140,'F');
      }
      doc.text(ln,margin+6,y);
      y+=6.2;
    });

    // --- CLOSING QUOTE BOX ---
    y+=12;
    if(y>250){doc.addPage();y=20;}
    doc.setFillColor(...gold);
    doc.roundedRect(margin,y,W-margin*2,26,4,4,'F');
    doc.setTextColor(...white);
    doc.setFontSize(10);doc.setFont('helvetica','italic');
    const cq=t('report.ctaQuote');
    doc.text('"'+cq+'"',W/2,y+10,{align:'center',maxWidth:W-margin*2-8});
    doc.setFont('helvetica','normal');doc.setFontSize(9);
    const ct=t('report.ctaText');
    doc.text(ct,W/2,y+18,{align:'center',maxWidth:W-margin*2-8});

    // --- FOOTER ---
    const FY=285;
    doc.setFillColor(...dark);
    doc.rect(0,FY-2,W,14,'F');
    doc.setTextColor(...white);
    doc.setFontSize(9);
    doc.setFont('helvetica','bold');doc.text('MARINAPHOTO',margin,FY+5);
    doc.setFont('helvetica','normal');doc.text('info@marinaphoto.es',W/2,FY+5,{align:'center'});
    doc.text('Sitges ‚Äî Barcelona',W-margin,FY+5,{align:'right'});

    const fn=(t('pdfFilename')+'-'+(S.project||'project').replace(/[^a-z0-9]/gi,'-').toLowerCase()+'.pdf');
    doc.save(fn);
  }catch(e){
    console.error('PDF generation error:',e);
    alert({
      fr:'Erreur lors de la g√©n√©ration du PDF : '+e.message,
      en:'PDF generation error: '+e.message,
      es:'Error al generar el PDF: '+e.message,
      ca:'Error en generar el PDF: '+e.message
    }[L]||('PDF error: '+e.message));
  }
}

function doRestart(){
  if(!confirm(t('restartConfirm')))return;
  step=0;
  S.name='';S.project='';S.type=null;S.priorities=[];S.usage=null;
  S.channels=[];S.location=null;S.timing=null;
  S.calm=50;S.present=50;S.rich=50;S.email='';S.briefText='';
  go();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// START
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
go();
</script>
</body>
</html>
