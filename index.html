<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Marinaphoto ‚Äî Brief</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,400&family=Inter:wght@400;500;600;700&display=swap');
:root{--cream:#F5F1E8;--gold:#C8A882;--gold-l:#E8D5BC;--dark:#2C2C2C;--white:#FEFEFE;}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Inter',sans-serif;background:var(--cream);color:var(--dark);min-height:100vh;}
.page{min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:32px 20px 60px;}

/* TOP BAR */
.topbar{width:100%;max-width:860px;display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:12px;}
.brand{font-family:'Playfair Display',serif;font-size:20px;font-weight:700;color:var(--dark);}
.brand em{font-style:normal;color:var(--gold);font-family:'Inter',sans-serif;font-size:12px;font-weight:400;margin-left:8px;}
.langs{display:flex;gap:2px;background:var(--white);border-radius:20px;padding:3px;box-shadow:0 2px 12px rgba(44,44,44,.08);}
.langs button{border:none;background:transparent;color:var(--dark);opacity:.4;font-size:12px;font-weight:700;padding:7px 11px;border-radius:16px;cursor:pointer;transition:all .2s;font-family:'Inter',sans-serif;}
.langs button.on{background:var(--gold);color:var(--white);opacity:1;}

/* PROGRESS */
.prog-wrap{width:100%;max-width:860px;background:var(--white);border-radius:16px;padding:16px 22px;margin-bottom:22px;box-shadow:0 2px 16px rgba(44,44,44,.06);}
.prog-bar{height:5px;background:var(--cream);border-radius:10px;overflow:hidden;margin-bottom:10px;}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--gold),var(--gold-l));border-radius:10px;transition:width .5s ease;}
.prog-meta{display:flex;justify-content:space-between;font-size:12px;font-weight:500;opacity:.6;}
.prog-meta .t{color:var(--gold);font-weight:700;opacity:1;}

/* CARD */
.card{width:100%;max-width:860px;background:var(--white);border-radius:24px;padding:clamp(28px,5vw,52px);box-shadow:0 8px 40px rgba(44,44,44,.10);animation:up .4s ease;}
@keyframes up{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

/* TYPOGRAPHY */
.kicker{font-size:11px;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;color:var(--gold);margin-bottom:14px;}
h1{font-family:'Playfair Display',serif;font-size:clamp(24px,4vw,38px);font-weight:700;line-height:1.2;margin-bottom:12px;}
.sub{font-size:17px;opacity:.7;line-height:1.65;margin-bottom:26px;}
.opening-quote{font-family:'Playfair Display',serif;font-style:italic;font-size:clamp(20px,3vw,30px);color:var(--gold);line-height:1.45;text-align:center;margin:20px 0 32px;}

/* INPUTS */
input[type=text],input[type=email]{width:100%;padding:15px 20px;border:2px solid transparent;background:var(--cream);border-radius:14px;font-size:16px;font-family:'Inter',sans-serif;color:var(--dark);outline:none;margin-top:8px;transition:all .25s;}
input:focus{border-color:var(--gold);background:var(--white);box-shadow:0 0 0 4px rgba(200,168,130,.12);}
input::placeholder{opacity:.4;}

/* OPTIONS */
.opts{display:flex;flex-direction:column;gap:10px;margin:20px 0;}
.opt{padding:18px 22px;background:var(--cream);border:2px solid transparent;border-radius:18px;cursor:pointer;transition:all .25s;position:relative;user-select:none;}
.opt:hover{background:var(--white);border-color:var(--gold-l);transform:translateY(-2px);box-shadow:0 4px 20px rgba(44,44,44,.07);}
.opt.sel{background:var(--white);border-color:var(--gold);box-shadow:0 0 0 3px rgba(200,168,130,.15);}
.opt.sel::after{content:'‚úì';position:absolute;top:50%;right:20px;transform:translateY(-50%);width:26px;height:26px;background:var(--gold);color:var(--white);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;line-height:26px;text-align:center;}
.opt-t{font-size:16px;font-weight:700;margin-bottom:3px;padding-right:36px;}
.opt-d{font-size:13px;opacity:.6;line-height:1.4;padding-right:36px;}

/* VIBE SLIDERS ‚Äî images illustratives seulement */
.vibe-block{background:var(--cream);border-radius:20px;padding:22px;margin-bottom:18px;}
.vibe-label-row{display:flex;justify-content:space-between;font-size:13px;font-weight:600;margin-bottom:4px;opacity:.75;}
.vibe-cat{font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;opacity:.45;margin-bottom:10px;}
input[type=range]{width:100%;height:6px;-webkit-appearance:none;appearance:none;background:linear-gradient(90deg,var(--gold) var(--p,50%),rgba(200,168,130,.2) var(--p,50%));border-radius:10px;outline:none;cursor:pointer;margin:10px 0 16px;}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:22px;height:22px;background:var(--white);border:3px solid var(--gold);border-radius:50%;box-shadow:0 2px 8px rgba(200,168,130,.4);}
input[type=range]::-moz-range-thumb{width:22px;height:22px;background:var(--white);border:3px solid var(--gold);border-radius:50%;}
/* Deux images illustrant les deux extr√™mes ‚Äî LECTURE SEULE */
.vibe-illus{display:grid;grid-template-columns:1fr 1fr;gap:8px;pointer-events:none;}
.vibe-img{border-radius:12px;overflow:hidden;aspect-ratio:3/2;position:relative;}
.vibe-img img{width:100%;height:100%;object-fit:cover;display:block;}
.vibe-img-lbl{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(transparent,rgba(44,44,44,.65));color:#fff;font-size:11px;font-weight:600;padding:12px 10px 7px;letter-spacing:.5px;}

/* BUTTONS */
.btns{display:flex;gap:12px;margin-top:28px;flex-wrap:wrap;}
.bp{padding:14px 32px;background:var(--gold);color:var(--white);border:2px solid var(--gold);border-radius:50px;font-size:15px;font-weight:700;font-family:'Inter',sans-serif;cursor:pointer;transition:all .25s;}
.bp:hover{background:#b89060;border-color:#b89060;transform:translateY(-2px);box-shadow:0 8px 20px rgba(200,168,130,.3);}
.bs{padding:14px 24px;background:transparent;color:var(--gold);border:2px solid var(--gold);border-radius:50px;font-size:15px;font-weight:700;font-family:'Inter',sans-serif;cursor:pointer;transition:all .25s;}
.bs:hover{background:var(--gold);color:var(--white);transform:translateY(-2px);}

/* LOADING */
.loading{text-align:center;padding:80px 20px;}
.spinner{width:50px;height:50px;border:4px solid var(--cream);border-top-color:var(--gold);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 22px;}
@keyframes spin{to{transform:rotate(360deg)}}
.loading h2{font-family:'Playfair Display',serif;margin-bottom:10px;}
.loading p{opacity:.6;font-size:16px;}

/* RAPPORT */
.rpt-hero{text-align:center;padding:56px 24px 40px;margin:-52px -52px 40px;background:linear-gradient(160deg,rgba(200,168,130,.07) 0%,transparent 60%);border-radius:24px 24px 0 0;border-bottom:1px solid rgba(200,168,130,.15);}
.rpt-hero h1{font-family:'Playfair Display',serif;font-size:clamp(38px,7vw,72px);font-weight:900;line-height:1.1;margin-bottom:16px;background:linear-gradient(135deg,var(--dark) 30%,var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.rpt-hero .client{font-size:18px;color:var(--gold);font-weight:600;margin-bottom:6px;}
.rpt-hero .rdate{font-size:13px;opacity:.45;}
.rpt-body{border-left:3px solid var(--gold);padding:4px 0 4px 32px;margin:0 0 44px;}
.rpt-body p{font-size:18px;line-height:1.9;color:var(--dark);margin-bottom:22px;}
.rpt-body p:last-child{margin-bottom:0;}

/* CTA FINALE */
.rpt-cta{background:linear-gradient(135deg,var(--gold) 0%,#b8916a 100%);border-radius:24px;padding:48px;text-align:center;}
.rpt-cta h2{font-family:'Playfair Display',serif;font-size:26px;color:#fff;margin-bottom:10px;}
.closing-q{font-family:'Playfair Display',serif;font-style:italic;font-size:20px;color:#fff;opacity:.95;margin:18px 0 24px;line-height:1.5;}
.rpt-cta p{color:#fff;opacity:.92;font-size:16px;line-height:1.65;margin-bottom:30px;}
.cta-btns{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;}
.rpt-cta .bp{background:#fff;color:var(--gold);border-color:#fff;}
.rpt-cta .bp:hover{background:var(--cream);}
.rpt-cta .bs{background:transparent;color:#fff;border-color:rgba(255,255,255,.7);}
.rpt-cta .bs:hover{background:rgba(255,255,255,.15);}

@media(max-width:640px){
  .card{padding:22px 18px;}
  .rpt-hero{margin:-22px -18px 30px;padding:38px 18px 26px;}
  .rpt-body{padding-left:18px;}
  .rpt-cta{padding:30px 20px;}
  .btns,.cta-btns{flex-direction:column;}
  .bp,.bs{width:100%;text-align:center;}
}
</style>
</head>
<body>
<div class="page">
  <div class="topbar">
    <div class="brand">MARINAPHOTO <em>Photography Brief</em></div>
    <div class="langs">
      <button id="l-fr" class="on" onclick="setLang('fr')">FR</button>
      <button id="l-en" onclick="setLang('en')">EN</button>
      <button id="l-es" onclick="setLang('es')">ES</button>
      <button id="l-ca" onclick="setLang('ca')">CA</button>
    </div>
  </div>
  <div class="prog-wrap">
    <div class="prog-bar"><div class="prog-fill" id="pbar"></div></div>
    <div class="prog-meta"><span id="pstep"></span><span class="t" id="ptime"></span></div>
  </div>
  <div class="card" id="card"></div>
</div>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let L = 'fr', step = 0;
const TOTAL = 11;
const S = {
  name:'', project:'', type:null,
  priorities:[], usage:null, channels:[],
  location:null, timing:null,
  calm:50, present:50, rich:50,
  email:'', briefText:''
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TRANSLATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const TX = {
fr:{
  steps:['Intro','Pr√©nom','Projet','Type','Priorit√©s','Usage','Canaux','Lieu','Timing','Ambiance','Contact'],
  times:['3 min','2 min','2 min','2 min','1 min','1 min','1 min','1 min','30 sec','30 sec','20 sec'],
  back:'Retour', maxTwo:'Maximum 2 choix', mustPick:'Veuillez choisir une option', emailErr:'Email invalide',
  intro:{kicker:'Commen√ßons',quote:'Je sais ce qu\'une image repr√©sente pour vous‚Ä¶',title:'3 minutes pour comprendre votre projet.',sub:'Quelques questions simples. Je transforme vos r√©ponses en un brief personnalis√© qui nous guide.',btn:'Commencer'},
  name:{kicker:'√Ä propos de vous',title:'Votre pr√©nom',ph:'Ex : Sophie',btn:'Continuer'},
  project:{kicker:'Le projet',title:'Comment s\'appelle votre projet ?',sub:'Un nom, m√™me provisoire.',ph:'Ex : H√¥tel Can Ros / Bodega Garraf',btn:'Continuer'},
  type:{kicker:'Nature du projet',title:'Votre projet, c\'est avant tout‚Ä¶',opts:[
    {id:'place',t:'üè† Un lieu √† faire ressentir',d:'H√¥tel, restaurant, architecture. La lumi√®re, l\'espace, l\'atmosph√®re.'},
    {id:'story',t:'üìñ Une histoire √† raconter',d:'Artisan, marque, projet. Les gens, les gestes, le contexte.'},
    {id:'moment',t:'‚è≥ Un moment √† garder',d:'Famille, couple, √©v√©nement. L\'instant, l\'√©motion, la vie.'}
  ],btn:'Continuer'},
  priorities:{kicker:'L\'effet recherch√©',title:'Ce que vous voulez transmettre',sub:'1 ou 2 priorit√©s',opts:[
    {id:'auth',t:'Authenticit√©',d:'Vrai, pr√©sent, pas artificiel'},
    {id:'brand',t:'Coh√©rence',d:'Align√© avec votre identit√© visuelle'},
    {id:'singular',t:'Singularit√©',d:'Un regard reconnaissable, pas du d√©j√†-vu'},
    {id:'trust',t:'Cr√©dibilit√©',d:'Professionnel, humain, qui inspire confiance'}
  ],btn:'Continuer'},
  usage:{kicker:'Usage',title:'Ces images vont servir √†‚Ä¶',opts:[
    {id:'launch',t:'üìÜ Un lancement',d:'Campagne, √©v√©nement, ouverture ‚Äî une deadline pr√©cise'},
    {id:'base',t:'üîÅ Constituer une base',d:'Un fonds d\'images r√©utilisables sur la dur√©e'},
    {id:'series',t:'üå± Une s√©rie r√©guli√®re',d:'Contenu r√©current, qui √©volue dans le temps'}
  ],btn:'Continuer'},
  channels:{kicker:'Diffusion',title:'O√π ces images vivront-elles ?',sub:'Max 2',opts:[
    {id:'web',t:'Site web'},{id:'social',t:'R√©seaux sociaux'},{id:'press',t:'Presse / √©ditorial'},{id:'print',t:'Print / affichage'}
  ],btn:'Continuer'},
  location:{kicker:'Logistique',title:'O√π se d√©roule la s√©ance ?',opts:[
    {id:'sitges',t:'üìç Sitges et environs',d:'Garraf, Vilanova, Cubelles‚Ä¶'},
    {id:'bcn',t:'üìç Barcelone',d:'Ville ou p√©riph√©rie'},
    {id:'cat',t:'üìç Ailleurs en Catalogne',d:'Costa Brava, Tarragone, int√©rieur‚Ä¶'},
    {id:'other',t:'üìç En dehors de Catalogne',d:'√Ä d√©finir ensemble'}
  ],btn:'Continuer'},
  timing:{kicker:'Planning',title:'Quand avez-vous besoin des images ?',opts:[
    {id:'fixed',t:'üìÖ Date fix√©e',d:'J\'ai une deadline pr√©cise'},
    {id:'approx',t:'üìÜ P√©riode approximative',d:'Dans les prochaines semaines ou mois'},
    {id:'flex',t:'üåä Pas d\'urgence',d:'On cale √ßa ensemble'}
  ],btn:'Continuer'},
  vibe:{kicker:'Direction artistique',title:'Comment je dois photographier',
    sub:'Ajustez les trois curseurs. Les photos illustrent chaque extr√™me ‚Äî elles ne sont pas cliquables.',
    sliders:[
      {id:'calm',cat:'√ânergie',lo:'Calme & contemplatif',hi:'Vivant & dynamique',
        imgs:[{src:'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=500&q=75',lbl:'Calme'},
              {src:'https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=500&q=75',lbl:'Vivant'}]},
      {id:'present',cat:'Proximit√©',lo:'Distance & contexte',hi:'Intime & d√©tails',
        imgs:[{src:'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=500&q=75',lbl:'Vue large'},
              {src:'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=500&q=75',lbl:'Proximit√©'}]},
      {id:'rich',cat:'Esth√©tique',lo:'√âpur√© & minimaliste',hi:'Textur√© & riche',
        imgs:[{src:'https://images.unsplash.com/photo-1556909190-eccf4a8bf97a?w=500&q=75',lbl:'√âpur√©'},
              {src:'https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?w=500&q=75',lbl:'Textur√©'}]}
    ],btn:'Voir le brief'},
  contact:{kicker:'Derni√®re √©tape',title:'Votre adresse email',sub:'Pour recevoir ce brief et commencer √† √©changer.',ph:'vous@email.com',btn:'G√©n√©rer le brief'},
  report:{loading:'R√©daction de votre brief‚Ä¶',loadSub:'L\'IA analyse vos r√©ponses et compose votre brief personnalis√©.',
    ctaTitle:'La suite',ctaQuote:'‚Ä¶Et maintenant vous savez ce qu\'une image repr√©sente pour moi.',
    ctaText:'Discutons de votre projet. Je vous pr√©pare une proposition personnalis√©e ‚Äî approche, planning et budget.',
    btnEmail:'Envoyer le brief √† Marina',btnRdv:'Prendre rendez-vous',btnPdf:'T√©l√©charger en PDF',btnRestart:'Nouveau brief'},
  emailSubj:'Brief photo',emailHi:'Bonjour Marina,',emailIntro:'Voici mon brief compl√©t√© via le questionnaire en ligne.',emailSign:'Cordialement,',
  restartConfirm:'Recommencer le questionnaire ?',
  pdfFilename:'marinaphoto-brief'
},
en:{
  steps:['Intro','Name','Project','Type','Priorities','Use','Channels','Location','Timing','Vibe','Contact'],
  times:['3 min','2 min','2 min','2 min','1 min','1 min','1 min','1 min','30 sec','30 sec','20 sec'],
  back:'Back', maxTwo:'Maximum 2 choices', mustPick:'Please choose an option', emailErr:'Invalid email',
  intro:{kicker:'Let\'s start',quote:'I know what an image means to you‚Ä¶',title:'3 minutes to understand your project.',sub:'A few simple questions. I turn your answers into a personalised brief that guides our work.',btn:'Start'},
  name:{kicker:'About you',title:'Your first name',ph:'e.g. Sophie',btn:'Continue'},
  project:{kicker:'The project',title:'What is your project called?',sub:'A name, even a working one.',ph:'e.g. Hotel Can Ros / Garraf Winery',btn:'Continue'},
  type:{kicker:'Project type',title:'Your project is mainly‚Ä¶',opts:[
    {id:'place',t:'üè† A place to make felt',d:'Hotel, restaurant, architecture. Light, space, atmosphere.'},
    {id:'story',t:'üìñ A story to tell',d:'Artisan, brand, project. People, gestures, context.'},
    {id:'moment',t:'‚è≥ A moment to keep',d:'Family, couple, event. The instant, emotion, life.'}
  ],btn:'Continue'},
  priorities:{kicker:'The desired effect',title:'What you want to convey',sub:'1 or 2 priorities',opts:[
    {id:'auth',t:'Authenticity',d:'Real, present, not artificial'},
    {id:'brand',t:'Coherence',d:'Aligned with your visual identity'},
    {id:'singular',t:'Singularity',d:'A recognisable eye, nothing generic'},
    {id:'trust',t:'Credibility',d:'Professional, human, trust-inspiring'}
  ],btn:'Continue'},
  usage:{kicker:'Use',title:'These images will serve‚Ä¶',opts:[
    {id:'launch',t:'üìÜ A launch',d:'Campaign, event, opening ‚Äî a precise deadline'},
    {id:'base',t:'üîÅ Building a library',d:'A reusable image bank over time'},
    {id:'series',t:'üå± An ongoing series',d:'Regular content, evolving over time'}
  ],btn:'Continue'},
  channels:{kicker:'Distribution',title:'Where will these images live?',sub:'Max 2',opts:[
    {id:'web',t:'Website'},{id:'social',t:'Social media'},{id:'press',t:'Press / editorial'},{id:'print',t:'Print / display'}
  ],btn:'Continue'},
  location:{kicker:'Logistics',title:'Where will the shoot take place?',opts:[
    {id:'sitges',t:'üìç Sitges area',d:'Garraf, Vilanova, Cubelles‚Ä¶'},
    {id:'bcn',t:'üìç Barcelona',d:'City or surroundings'},
    {id:'cat',t:'üìç Elsewhere in Catalonia',d:'Costa Brava, Tarragona, inland‚Ä¶'},
    {id:'other',t:'üìç Outside Catalonia',d:'To define together'}
  ],btn:'Continue'},
  timing:{kicker:'Schedule',title:'When do you need the images?',opts:[
    {id:'fixed',t:'üìÖ Fixed date',d:'I have a precise deadline'},
    {id:'approx',t:'üìÜ Approximate timeframe',d:'Within the next weeks or months'},
    {id:'flex',t:'üåä No urgency',d:'We figure it out together'}
  ],btn:'Continue'},
  vibe:{kicker:'Artistic direction',title:'How should I photograph',
    sub:'Adjust the three sliders. Photos illustrate each extreme ‚Äî they are not clickable.',
    sliders:[
      {id:'calm',cat:'Energy',lo:'Calm & contemplative',hi:'Lively & dynamic',
        imgs:[{src:'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=500&q=75',lbl:'Still'},
              {src:'https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=500&q=75',lbl:'Lively'}]},
      {id:'present',cat:'Proximity',lo:'Distance & context',hi:'Intimate & details',
        imgs:[{src:'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=500&q=75',lbl:'Wide'},
              {src:'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=500&q=75',lbl:'Close'}]},
      {id:'rich',cat:'Aesthetic',lo:'Minimal & clean',hi:'Textured & rich',
        imgs:[{src:'https://images.unsplash.com/photo-1556909190-eccf4a8bf97a?w=500&q=75',lbl:'Minimal'},
              {src:'https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?w=500&q=75',lbl:'Textured'}]}
    ],btn:'See brief'},
  contact:{kicker:'Last step',title:'Your email address',sub:'To send you this brief and start the conversation.',ph:'you@email.com',btn:'Generate brief'},
  report:{loading:'Writing your brief‚Ä¶',loadSub:'AI is analysing your answers and composing your personalised brief.',
    ctaTitle:'Next step',ctaQuote:'‚Ä¶And now you know what an image means to me.',
    ctaText:'Let\'s talk about your project. I\'ll prepare a personalised proposal ‚Äî approach, timeline and budget.',
    btnEmail:'Send brief to Marina',btnRdv:'Book a call',btnPdf:'Download PDF',btnRestart:'New brief'},
  emailSubj:'Photo brief',emailHi:'Hello Marina,',emailIntro:'Here is my completed brief from the online questionnaire.',emailSign:'Best regards,',
  restartConfirm:'Restart the questionnaire?',
  pdfFilename:'marinaphoto-brief'
},
es:{
  steps:['Intro','Nombre','Proyecto','Tipo','Prioridades','Uso','Canales','Lugar','Timing','Vibra','Contacto'],
  times:['3 min','2 min','2 min','2 min','1 min','1 min','1 min','1 min','30 seg','30 seg','20 seg'],
  back:'Atr√°s', maxTwo:'M√°ximo 2 opciones', mustPick:'Por favor elija una opci√≥n', emailErr:'Email inv√°lido',
  intro:{kicker:'Empecemos',quote:'S√© lo que una imagen significa para ti‚Ä¶',title:'3 minutos para entender tu proyecto.',sub:'Algunas preguntas simples. Transformo tus respuestas en un brief personalizado que gu√≠a nuestra colaboraci√≥n.',btn:'Empezar'},
  name:{kicker:'Sobre ti',title:'Tu nombre',ph:'ej. Sof√≠a',btn:'Continuar'},
  project:{kicker:'El proyecto',title:'¬øC√≥mo se llama tu proyecto?',sub:'Un nombre, aunque sea provisional.',ph:'ej. Hotel Can Ros / Bodega Garraf',btn:'Continuar'},
  type:{kicker:'Naturaleza del proyecto',title:'Tu proyecto es sobre todo‚Ä¶',opts:[
    {id:'place',t:'üè† Un lugar para sentir',d:'Hotel, restaurante, arquitectura. Luz, espacio, atm√≥sfera.'},
    {id:'story',t:'üìñ Una historia que contar',d:'Artesano, marca, proyecto. Personas, gestos, contexto.'},
    {id:'moment',t:'‚è≥ Un momento para guardar',d:'Familia, pareja, evento. El instante, la emoci√≥n, la vida.'}
  ],btn:'Continuar'},
  priorities:{kicker:'El efecto deseado',title:'Lo que quieres transmitir',sub:'1 o 2 prioridades',opts:[
    {id:'auth',t:'Autenticidad',d:'Real, presente, no artificial'},
    {id:'brand',t:'Coherencia',d:'Alineado con tu identidad visual'},
    {id:'singular',t:'Singularidad',d:'Una mirada reconocible, nada gen√©rico'},
    {id:'trust',t:'Credibilidad',d:'Profesional, humano, que inspira confianza'}
  ],btn:'Continuar'},
  usage:{kicker:'Uso',title:'Estas im√°genes servir√°n para‚Ä¶',opts:[
    {id:'launch',t:'üìÜ Un lanzamiento',d:'Campa√±a, evento, apertura ‚Äî una fecha l√≠mite precisa'},
    {id:'base',t:'üîÅ Construir una biblioteca',d:'Un fondo de im√°genes reutilizables a lo largo del tiempo'},
    {id:'series',t:'üå± Una serie continua',d:'Contenido regular, que evoluciona en el tiempo'}
  ],btn:'Continuar'},
  channels:{kicker:'Difusi√≥n',title:'¬øD√≥nde vivir√°n estas im√°genes?',sub:'M√°x 2',opts:[
    {id:'web',t:'Web'},{id:'social',t:'Redes sociales'},{id:'press',t:'Prensa / editorial'},{id:'print',t:'Impresi√≥n / display'}
  ],btn:'Continuar'},
  location:{kicker:'Log√≠stica',title:'¬øD√≥nde se realizar√° la sesi√≥n?',opts:[
    {id:'sitges',t:'üìç Sitges y alrededores',d:'Garraf, Vilanova, Cubelles‚Ä¶'},
    {id:'bcn',t:'üìç Barcelona',d:'Ciudad o alrededores'},
    {id:'cat',t:'üìç Otra parte de Catalu√±a',d:'Costa Brava, Tarragona, interior‚Ä¶'},
    {id:'other',t:'üìç Fuera de Catalu√±a',d:'A definir juntos'}
  ],btn:'Continuar'},
  timing:{kicker:'Planificaci√≥n',title:'¬øCu√°ndo necesitas las im√°genes?',opts:[
    {id:'fixed',t:'üìÖ Fecha fija',d:'Tengo una fecha l√≠mite precisa'},
    {id:'approx',t:'üìÜ Per√≠odo aproximado',d:'En las pr√≥ximas semanas o meses'},
    {id:'flex',t:'üåä Sin urgencia',d:'Lo decidimos juntos'}
  ],btn:'Continuar'},
  vibe:{kicker:'Direcci√≥n art√≠stica',title:'C√≥mo debo fotografiar',
    sub:'Ajusta los tres controles. Las fotos ilustran cada extremo ‚Äî no son clicables.',
    sliders:[
      {id:'calm',cat:'Energ√≠a',lo:'Calmo & contemplativo',hi:'Vivo & din√°mico',
        imgs:[{src:'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=500&q=75',lbl:'Sereno'},
              {src:'https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=500&q=75',lbl:'Vivo'}]},
      {id:'present',cat:'Proximidad',lo:'Distancia & contexto',hi:'√çntimo & detalles',
        imgs:[{src:'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=500&q=75',lbl:'Amplio'},
              {src:'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=500&q=75',lbl:'Cercano'}]},
      {id:'rich',cat:'Est√©tica',lo:'Limpio & minimalista',hi:'Texturado & rico',
        imgs:[{src:'https://images.unsplash.com/photo-1556909190-eccf4a8bf97a?w=500&q=75',lbl:'Limpio'},
              {src:'https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?w=500&q=75',lbl:'Texturado'}]}
    ],btn:'Ver brief'},
  contact:{kicker:'√öltimo paso',title:'Tu direcci√≥n de email',sub:'Para enviarte este brief y empezar a hablar.',ph:'tu@email.com',btn:'Generar brief'},
  report:{loading:'Redactando tu brief‚Ä¶',loadSub:'La IA analiza tus respuestas y compone tu brief personalizado.',
    ctaTitle:'El pr√≥ximo paso',ctaQuote:'‚Ä¶Y ahora sabes lo que una imagen significa para m√≠.',
    ctaText:'Hablemos de tu proyecto. Te preparo una propuesta personalizada ‚Äî enfoque, planificaci√≥n y presupuesto.',
    btnEmail:'Enviar brief a Marina',btnRdv:'Reservar una llamada',btnPdf:'Descargar PDF',btnRestart:'Nuevo brief'},
  emailSubj:'Brief fotogr√°fico',emailHi:'Hola Marina,',emailIntro:'Aqu√≠ est√° mi brief completado a trav√©s del cuestionario en l√≠nea.',emailSign:'Saludos,',
  restartConfirm:'¬øReiniciar el cuestionario?',
  pdfFilename:'marinaphoto-brief'
},
ca:{
  steps:['Intro','Nom','Projecte','Tipus','Prioritats','√ös','Canals','Lloc','Timing','Vibra','Contacte'],
  times:['3 min','2 min','2 min','2 min','1 min','1 min','1 min','1 min','30 seg','30 seg','20 seg'],
  back:'Enrere', maxTwo:'M√†xim 2 opcions', mustPick:'Si us plau, tria una opci√≥', emailErr:'Email inv√†lid',
  intro:{kicker:'Comencem',quote:'S√© el que una imatge significa per a tu‚Ä¶',title:'3 minuts per entendre el teu projecte.',sub:'Unes quantes preguntes simples. Transformo les teves respostes en un brief personalitzat que guia la nostra col¬∑laboraci√≥.',btn:'Comen√ßar'},
  name:{kicker:'Sobre tu',title:'El teu nom',ph:'ex. N√∫ria',btn:'Continuar'},
  project:{kicker:'El projecte',title:'Com s\'anomena el teu projecte?',sub:'Un nom, encara que sigui provisional.',ph:'ex. Hotel Can Ros / Celler Garraf',btn:'Continuar'},
  type:{kicker:'Naturalesa del projecte',title:'El teu projecte √©s sobretot‚Ä¶',opts:[
    {id:'place',t:'üè† Un lloc per sentir',d:'Hotel, restaurant, arquitectura. Llum, espai, atmosfera.'},
    {id:'story',t:'üìñ Una hist√≤ria per explicar',d:'Artes√†, marca, projecte. Persones, gestos, context.'},
    {id:'moment',t:'‚è≥ Un moment per guardar',d:'Fam√≠lia, parella, esdeveniment. L\'instant, l\'emoci√≥, la vida.'}
  ],btn:'Continuar'},
  priorities:{kicker:'L\'efecte desitjat',title:'El que vols transmetre',sub:'1 o 2 prioritats',opts:[
    {id:'auth',t:'Autenticitat',d:'Real, present, no artificial'},
    {id:'brand',t:'Coher√®ncia',d:'Alineat amb la teva identitat visual'},
    {id:'singular',t:'Singularitat',d:'Una mirada reconeixible, res gen√®ric'},
    {id:'trust',t:'Credibilitat',d:'Professional, hum√†, que inspira confian√ßa'}
  ],btn:'Continuar'},
  usage:{kicker:'√ös',title:'Aquestes imatges serviran per a‚Ä¶',opts:[
    {id:'launch',t:'üìÜ Un llan√ßament',d:'Campanya, esdeveniment, obertura ‚Äî una data l√≠mit precisa'},
    {id:'base',t:'üîÅ Construir una biblioteca',d:'Un fons d\'imatges reutilitzables al llarg del temps'},
    {id:'series',t:'üå± Una s√®rie cont√≠nua',d:'Contingut regular, que evoluciona en el temps'}
  ],btn:'Continuar'},
  channels:{kicker:'Difusi√≥',title:'On viuran aquestes imatges?',sub:'M√†x 2',opts:[
    {id:'web',t:'Web'},{id:'social',t:'Xarxes socials'},{id:'press',t:'Premsa / editorial'},{id:'print',t:'Impressi√≥ / cartelleria'}
  ],btn:'Continuar'},
  location:{kicker:'Log√≠stica',title:'On es far√† la sessi√≥?',opts:[
    {id:'sitges',t:'üìç Sitges i rodalia',d:'Garraf, Vilanova, Cubelles‚Ä¶'},
    {id:'bcn',t:'üìç Barcelona',d:'Ciutat o voltants'},
    {id:'cat',t:'üìç Altra part de Catalunya',d:'Costa Brava, Tarragona, interior‚Ä¶'},
    {id:'other',t:'üìç Fora de Catalunya',d:'A definir junts'}
  ],btn:'Continuar'},
  timing:{kicker:'Planificaci√≥',title:'Quan necessites les imatges?',opts:[
    {id:'fixed',t:'üìÖ Data fixada',d:'Tinc una data l√≠mit precisa'},
    {id:'approx',t:'üìÜ Per√≠ode aproximat',d:'En les properes setmanes o mesos'},
    {id:'flex',t:'üåä Sense urg√®ncia',d:'Ho decidim junts'}
  ],btn:'Continuar'},
  vibe:{kicker:'Direcci√≥ art√≠stica',title:'Com he de fotografiar',
    sub:'Ajusta els tres controls. Les fotos il¬∑lustren cada extrem ‚Äî no es poden clicar.',
    sliders:[
      {id:'calm',cat:'Energia',lo:'Calmat & contemplatiu',hi:'Viu & din√†mic',
        imgs:[{src:'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=500&q=75',lbl:'Ser√®'},
              {src:'https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=500&q=75',lbl:'Viu'}]},
      {id:'present',cat:'Proximitat',lo:'Dist√†ncia & context',hi:'√çntim & detalls',
        imgs:[{src:'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=500&q=75',lbl:'Ampli'},
              {src:'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=500&q=75',lbl:'Proper'}]},
      {id:'rich',cat:'Est√®tica',lo:'Net & minimalista',hi:'Texturat & ric',
        imgs:[{src:'https://images.unsplash.com/photo-1556909190-eccf4a8bf97a?w=500&q=75',lbl:'Net'},
              {src:'https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?w=500&q=75',lbl:'Texturat'}]}
    ],btn:'Veure brief'},
  contact:{kicker:'Darrer pas',title:'El teu email',sub:'Per enviar-te aquest brief i comen√ßar a parlar.',ph:'tu@email.cat',btn:'Generar brief'},
  report:{loading:'Redactant el teu brief‚Ä¶',loadSub:'La IA analitza les teves respostes i compon el teu brief personalitzat.',
    ctaTitle:'El proper pas',ctaQuote:'‚Ä¶I ara saps el que una imatge significa per a mi.',
    ctaText:'Parlem del teu projecte. Et preparo una proposta personalitzada ‚Äî enfocament, planificaci√≥ i pressupost.',
    btnEmail:'Enviar brief a Marina',btnRdv:'Reservar una trucada',btnPdf:'Descarregar PDF',btnRestart:'Nou brief'},
  emailSubj:'Brief fotogr√†fic',emailHi:'Hola Marina,',emailIntro:'Aqu√≠ tens el meu brief completat a trav√©s del q√ºestionari en l√≠nia.',emailSign:'Cordialment,',
  restartConfirm:'Reiniciar el q√ºestionari?',
  pdfFilename:'marinaphoto-brief'
}
};

const t = k => { let r=TX[L]; for(const p of k.split('.')) r=r[p]; return r; };

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROGRESS + NAV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function upProg(){
  document.getElementById('pbar').style.width=((step+1)/TOTAL*100)+'%';
  document.getElementById('pstep').textContent=(step+1)+'/'+TOTAL+' ¬∑ '+t('steps')[step];
  document.getElementById('ptime').textContent='~'+t('times')[step];
}
function setLang(l){
  L=l;
  ['fr','en','es','ca'].forEach(x=>document.getElementById('l-'+x).classList.remove('on'));
  document.getElementById('l-'+l).classList.add('on');
  go();
}
function fwd(){if(step<TOTAL-1){step++;go();}}
function bck(){if(step>0){step--;go();}}
function go(){
  upProg();
  const c=document.getElementById('card');
  c.style.cssText='opacity:0;transform:translateY(10px);transition:none;';
  setTimeout(()=>{
    draw();
    c.style.cssText='opacity:1;transform:translateY(0);transition:all .35s ease;';
    window.scrollTo({top:0,behavior:'smooth'});
  },60);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DRAW STEPS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function draw(){
  const c=document.getElementById('card');
  const fns=[drawIntro,drawName,drawProject,drawType,drawPriorities,
              drawUsage,drawChannels,drawLocation,drawTiming,drawVibe,drawContact];
  if(fns[step]) c.innerHTML=fns[step]();
  bindOpts();
  initSliders();
}

const BK = ()=>`<button class="bs" onclick="bck()">‚Üê ${t('back')}</button>`;

function drawIntro(){
  return `<div class="kicker">${t('intro.kicker')}</div>
  <div class="opening-quote">"${t('intro.quote')}"</div>
  <h1>${t('intro.title')}</h1>
  <p class="sub">${t('intro.sub')}</p>
  <div class="btns"><button class="bp" onclick="fwd()">${t('intro.btn')}</button></div>`;
}
function drawName(){
  return `<div class="kicker">${t('name.kicker')}</div>
  <h1>${t('name.title')}</h1>
  <input type="text" id="f-name" value="${esc(S.name)}" placeholder="${t('name.ph')}">
  <div class="btns"><button class="bp" onclick="svName()">${t('name.btn')}</button>${BK()}</div>`;
}
function drawProject(){
  return `<div class="kicker">${t('project.kicker')}</div>
  <h1>${t('project.title')}</h1><p class="sub">${t('project.sub')}</p>
  <input type="text" id="f-proj" value="${esc(S.project)}" placeholder="${t('project.ph')}">
  <div class="btns"><button class="bp" onclick="svProject()">${t('project.btn')}</button>${BK()}</div>`;
}
function drawOpts(key, field, multi, stateRef){
  const opts=t(key+'.opts');
  return `<div class="kicker">${t(key+'.kicker')}</div>
  <h1>${t(key+'.title')}</h1>
  ${t(key+'.sub') ? `<p class="sub">${t(key+'.sub')}</p>` : ''}
  <div class="opts">${opts.map(o=>`
    <div class="opt${(multi?stateRef.includes(o.id):stateRef===o.id)?' sel':''}" data-id="${o.id}" data-field="${field}" data-multi="${multi}">
      <div class="opt-t">${o.t}</div>${o.d?`<div class="opt-d">${o.d}</div>`:''}
    </div>`).join('')}
  </div>
  <div class="btns">
    <button class="bp" onclick="${multi?`valMulti('${field}',2)`:`valSingle('${field}')`}">${t(key+'.btn')}</button>
    ${BK()}
  </div>`;
}
function drawType(){return drawOpts('type','type',false,S.type);}
function drawPriorities(){return drawOpts('priorities','priorities',true,S.priorities);}
function drawUsage(){return drawOpts('usage','usage',false,S.usage);}
function drawChannels(){return drawOpts('channels','channels',true,S.channels);}
function drawLocation(){return drawOpts('location','location',false,S.location);}
function drawTiming(){return drawOpts('timing','timing',false,S.timing);}

function drawVibe(){
  const sls=t('vibe.sliders');
  return `<div class="kicker">${t('vibe.kicker')}</div>
  <h1>${t('vibe.title')}</h1>
  <p class="sub">${t('vibe.sub')}</p>
  ${sls.map(sl=>`
  <div class="vibe-block">
    <div class="vibe-cat">${sl.cat}</div>
    <div class="vibe-label-row"><span>${sl.lo}</span><span>${sl.hi}</span></div>
    <input type="range" min="0" max="100" value="${S[sl.id]}" data-key="${sl.id}"
      style="--p:${S[sl.id]}%"
      oninput="S['${sl.id}']=+this.value;this.style.setProperty('--p',this.value+'%')">
    <div class="vibe-illus">
      ${sl.imgs.map(img=>`
      <div class="vibe-img">
        <img src="${img.src}" alt="${img.lbl}" loading="lazy">
        <div class="vibe-img-lbl">${img.lbl}</div>
      </div>`).join('')}
    </div>
  </div>`).join('')}
  <div class="btns"><button class="bp" onclick="fwd()">${t('vibe.btn')}</button>${BK()}</div>`;
}

function drawContact(){
  return `<div class="kicker">${t('contact.kicker')}</div>
  <h1>${t('contact.title')}</h1>
  <p class="sub">${t('contact.sub')}</p>
  <input type="email" id="f-email" value="${esc(S.email)}" placeholder="${t('contact.ph')}">
  <div class="btns"><button class="bp" onclick="svEmail()">${t('contact.btn')}</button>${BK()}</div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EVENT BINDING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function bindOpts(){
  document.querySelectorAll('.opt[data-field]').forEach(el=>{
    el.addEventListener('click',()=>{
      const id=el.dataset.id, field=el.dataset.field, multi=el.dataset.multi==='true';
      if(multi){
        if(el.classList.contains('sel')){
          S[field]=S[field].filter(x=>x!==id);
          el.classList.remove('sel');
        } else {
          if(S[field].length>=2){alert(t('maxTwo'));return;}
          S[field].push(id);
          el.classList.add('sel');
        }
      } else {
        document.querySelectorAll(`.opt[data-field="${field}"]`).forEach(x=>x.classList.remove('sel'));
        S[field]=id;
        el.classList.add('sel');
      }
    });
  });
}
function initSliders(){
  document.querySelectorAll('input[type=range]').forEach(el=>{
    el.style.setProperty('--p',el.value+'%');
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SAVE / VALIDATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const esc=s=>(s||'').replace(/"/g,'&quot;');
function svName(){S.name=document.getElementById('f-name').value.trim();fwd();}
function svProject(){S.project=document.getElementById('f-proj').value.trim();fwd();}
function valSingle(f){if(!S[f]){alert(t('mustPick'));return;}fwd();}
function valMulti(f,max){if(!S[f].length){alert(t('mustPick'));return;}fwd();}
function svEmail(){
  const v=document.getElementById('f-email').value.trim();
  if(!v||!v.includes('@')||!v.includes('.')){alert(t('emailErr'));return;}
  S.email=v;
  showReport();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RAPPORT ‚Äî affichage loading + appel AI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showReport(){
  step=10; upProg();
  const c=document.getElementById('card');
  c.innerHTML=`<div class="loading"><div class="spinner"></div><h2>${t('report.loading')}</h2><p>${t('report.loadSub')}</p></div>`;
  callAI().then(txt=>{S.briefText=txt;renderReport(txt);}).catch(()=>{const fb=fallback();S.briefText=fb;renderReport(fb);});
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROMPT AI ‚Äî riche, traduit, ancr√© dans les r√©ponses
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function callAI(){
  // Labels traduits selon la langue choisie
  const TYPES={
    place:{fr:'lieu (h√¥tel, restaurant, architecture)',en:'place (hotel, restaurant, architecture)',es:'lugar (hotel, restaurante, arquitectura)',ca:'lloc (hotel, restaurant, arquitectura)'},
    story:{fr:'histoire / marque (artisan, projet, entreprise)',en:'story / brand (artisan, project, business)',es:'historia / marca (artesano, proyecto, empresa)',ca:'hist√≤ria / marca (artes√†, projecte, empresa)'},
    moment:{fr:'moment (famille, couple, √©v√©nement)',en:'moment (family, couple, event)',es:'momento (familia, pareja, evento)',ca:'moment (fam√≠lia, parella, esdeveniment)'}
  };
  const PRIOS={
    auth:{fr:'authenticit√©',en:'authenticity',es:'autenticidad',ca:'autenticitat'},
    brand:{fr:'coh√©rence de marque',en:'brand coherence',es:'coherencia de marca',ca:'coher√®ncia de marca'},
    singular:{fr:'singularit√© du regard',en:'singularity of vision',es:'singularidad de la mirada',ca:'singularitat de la mirada'},
    trust:{fr:'cr√©dibilit√©',en:'credibility',es:'credibilidad',ca:'credibilitat'}
  };
  const USAGE={
    launch:{fr:'lancement ponctuel avec deadline',en:'one-time launch with deadline',es:'lanzamiento puntual con fecha l√≠mite',ca:'llan√ßament puntual amb data l√≠mit'},
    base:{fr:'constitution d\'une biblioth√®que d\'images durable',en:'building a long-term image library',es:'construcci√≥n de una biblioteca de im√°genes duradera',ca:'constituci√≥ d\'una biblioteca d\'imatges duradora'},
    series:{fr:'s√©rie r√©guli√®re dans le temps',en:'ongoing series over time',es:'serie regular en el tiempo',ca:'s√®rie regular en el temps'}
  };
  const CHAN={web:{fr:'site web',en:'website',es:'web',ca:'web'},social:{fr:'r√©seaux sociaux',en:'social media',es:'redes sociales',ca:'xarxes socials'},press:{fr:'presse/√©ditorial',en:'press/editorial',es:'prensa/editorial',ca:'premsa/editorial'},print:{fr:'print',en:'print',es:'impresi√≥n',ca:'impressi√≥'}};
  const LOC={sitges:{fr:'Sitges/Garraf',en:'Sitges/Garraf',es:'Sitges/Garraf',ca:'Sitges/Garraf'},bcn:{fr:'Barcelone',en:'Barcelona',es:'Barcelona',ca:'Barcelona'},cat:{fr:'Catalogne',en:'Catalonia',es:'Catalu√±a',ca:'Catalunya'},other:{fr:'hors Catalogne',en:'outside Catalonia',es:'fuera de Catalu√±a',ca:'fora de Catalunya'}};
  const TIM={fixed:{fr:'date fix√©e',en:'fixed date',es:'fecha fija',ca:'data fixada'},approx:{fr:'p√©riode flexible',en:'flexible period',es:'per√≠odo flexible',ca:'per√≠ode flexible'},flex:{fr:'sans urgence',en:'no urgency',es:'sin urgencia',ca:'sense urg√®ncia'}};
  const VIBE_LO={calm:{fr:'calme et contemplatif',en:'calm and contemplative',es:'calmo y contemplativo',ca:'calmat i contemplatiu'},present:{fr:'distant avec contexte large',en:'distant with wide context',es:'distante con contexto amplio',ca:'distant amb context ampli'},rich:{fr:'√©pur√© et minimaliste',en:'clean and minimal',es:'limpio y minimalista',ca:'net i minimalista'}};
  const VIBE_HI={calm:{fr:'vivant et dynamique',en:'lively and dynamic',es:'vivo y din√°mico',ca:'viu i din√†mic'},present:{fr:'intime et proche des d√©tails',en:'intimate and close to details',es:'√≠ntimo y cercano a los detalles',ca:'√≠ntim i proper als detalls'},rich:{fr:'riche en textures et mati√®res',en:'rich in textures and materials',es:'rico en texturas y materiales',ca:'ric en textures i materials'}};

  const lv=(map,id)=>map[id]?.[L]||id;
  const vDesc=(id,val)=>{
    if(val<35) return lv(VIBE_LO,id);
    if(val>65) return lv(VIBE_HI,id);
    return L==='fr'?'√©quilibr√©':L==='es'?'equilibrado':L==='ca'?'equilibrat':'balanced';
  };

  const LANG_NAME={fr:'fran√ßais',en:'English',es:'espa√±ol',ca:'catal√†'};

  // Instructions dans la langue cible pour que l'AI r√©ponde naturellement
  const INSTRUCTIONS={
    fr:{
      role:'Tu es Marina, photographe professionnelle bas√©e √† Sitges, Barcelone.',
      infer:'Si le nom du projet √©voque un secteur pr√©cis (h√¥tellerie, restauration, viticulture, artisanat, immobilier, √©v√©nement, famille‚Ä¶), utilise ce contexte pour rendre le brief concret et ancr√© dans la r√©alit√© du projet.',
      task:`R√©dige un brief photographique EN FRAN√áAIS, 180‚Äì220 mots, en 3 paragraphes (sans titre, sans liste).`,
      p1:'Paragraphe 1 (2‚Äì3 phrases) : Montre que tu as compris le projet. Commence par le nom du projet. D√©duis ce que tu peux du nom (ex : "Bodega Garraf" ‚Üí vignoble/vin, "Can Ros" ‚Üí mas/h√¥tel rural, "Terrassa Sud" ‚Üí commerce local). Mentionne le type, les priorit√©s et l\'usage naturellement.',
      p2:'Paragraphe 2 (3‚Äì4 phrases) : D√©cris ton approche photographique concr√®te. Traduis les curseurs en intentions visuelles r√©elles et sp√©cifiques au secteur d√©duit : lumi√®re, cadrage, distance, rythme. Ex : pour un restaurant, parle de la lumi√®re sur les assiettes, des gestes en cuisine, de l\'atmosph√®re du service.',
      p3:'Paragraphe 3 (2 phrases) : Lieu et planning bri√®vement. Propose un √©change direct.',
      rules:'INTERDICTIONS : pas de liste, pas de titre, pas de prix, pas de nombre d\'images, pas d\'enthousiasme forc√©, pas de "je suis ravie".'
    },
    en:{
      role:'You are Marina, a professional photographer based in Sitges, Barcelona.',
      infer:'If the project name suggests a specific sector (hospitality, food & beverage, wine, crafts, real estate, events, family‚Ä¶), use that context to make the brief concrete and grounded in the project\'s reality.',
      task:`Write a photography brief IN ENGLISH, 180‚Äì220 words, in 3 paragraphs (no titles, no bullet points).`,
      p1:'Paragraph 1 (2‚Äì3 sentences): Show that you understood the project. Start with the project name. Infer what you can from it (e.g. "Garraf Winery" ‚Üí vineyard/wine, "Can Ros" ‚Üí rural hotel/farmhouse, "Terrassa Sud" ‚Üí local business). Mention the type, priorities and intended use naturally.',
      p2:'Paragraph 2 (3‚Äì4 sentences): Describe your photographic approach concretely. Translate the sliders into real, sector-specific visual intentions: light, framing, distance, rhythm. E.g. for a restaurant, talk about light on the plates, kitchen gestures, the atmosphere of service.',
      p3:'Paragraph 3 (2 sentences): Location and timeline briefly. Propose a direct next conversation.',
      rules:'RULES: no bullet points, no titles, no prices, no image counts, no forced enthusiasm, no "I\'m so excited".'
    },
    es:{
      role:'Eres Marina, fot√≥grafa profesional con base en Sitges, Barcelona.',
      infer:'Si el nombre del proyecto evoca un sector concreto (hosteler√≠a, restauraci√≥n, viticultura, artesan√≠a, inmobiliaria, eventos, familia‚Ä¶), usa ese contexto para hacer el brief concreto y anclado en la realidad del proyecto.',
      task:`Redacta un brief fotogr√°fico EN ESPA√ëOL, 180‚Äì220 palabras, en 3 p√°rrafos (sin t√≠tulos, sin listas).`,
      p1:'P√°rrafo 1 (2‚Äì3 frases): Muestra que entendiste el proyecto. Empieza por el nombre del proyecto. Deduce lo que puedas del nombre (ej: "Bodega Garraf" ‚Üí vi√±edo/vino, "Can Ros" ‚Üí mas√≠a/hotel rural). Menciona el tipo, las prioridades y el uso de forma natural.',
      p2:'P√°rrafo 2 (3‚Äì4 frases): Describe tu enfoque fotogr√°fico de forma concreta. Traduce los cursores en intenciones visuales reales y espec√≠ficas al sector deducido: luz, encuadre, distancia, ritmo.',
      p3:'P√°rrafo 3 (2 frases): Lugar y planificaci√≥n brevemente. Prop√≥n un intercambio directo.',
      rules:'PROHIBICIONES: sin listas, sin t√≠tulos, sin precios, sin n√∫mero de im√°genes, sin entusiasmo forzado.'
    },
    ca:{
      role:'Ets la Marina, fot√≤grafa professional amb base a Sitges, Barcelona.',
      infer:'Si el nom del projecte evoca un sector concret (hostaleria, restauraci√≥, viticultura, artesania, immobili√†ria, esdeveniments, fam√≠lia‚Ä¶), fes servir aquest context per fer el brief concret i ancorat en la realitat del projecte.',
      task:`Redacta un brief fotogr√†fic EN CATAL√Ä, 180‚Äì220 paraules, en 3 par√†grafs (sense t√≠tols, sense llistes).`,
      p1:'Par√†graf 1 (2‚Äì3 frases): Mostra que has ent√®s el projecte. Comen√ßa pel nom del projecte. Dedueix el que puguis del nom (ex: "Celler Garraf" ‚Üí vinya/vi, "Can Ros" ‚Üí masia/hotel rural). Esmenta el tipus, les prioritats i l\'√∫s de forma natural.',
      p2:'Par√†graf 2 (3‚Äì4 frases): Descriu el teu enfocament fotogr√†fic de forma concreta. Tradueix els controls en intencions visuals reals i espec√≠fiques al sector dedu√Øt: llum, enquadrament, dist√†ncia, ritme.',
      p3:'Par√†graf 3 (2 frases): Lloc i planificaci√≥ breument. Proposa un intercanvi directe.',
      rules:'PROHIBICIONS: sense llistes, sense t√≠tols, sense preus, sense nombre d\'imatges, sense entusiasme for√ßat.'
    }
  };

  const I=INSTRUCTIONS[L]||INSTRUCTIONS.en;
  const prompt=`${I.role}

${I.infer}

QUESTIONNAIRE DATA:
- Client name: ${S.name||'‚Äî'}
- Project name: ${S.project||'‚Äî'}
- Project type: ${lv(TYPES,S.type)}
- Visual priorities: ${S.priorities.map(p=>lv(PRIOS,p)).join(', ')||'‚Äî'}
- Intended use: ${lv(USAGE,S.usage)}
- Distribution channels: ${S.channels.map(c=>lv(CHAN,c)).join(', ')||'‚Äî'}
- Shoot location: ${lv(LOC,S.location)}
- Timeline: ${lv(TIM,S.timing)}
- Energy slider (0=calm, 100=lively) value ${S.calm}/100 ‚Üí ${vDesc('calm',S.calm)}
- Proximity slider (0=distant, 100=intimate) value ${S.present}/100 ‚Üí ${vDesc('present',S.present)}
- Aesthetic slider (0=minimal, 100=textured) value ${S.rich}/100 ‚Üí ${vDesc('rich',S.rich)}

${I.task}

${I.p1}

${I.p2}

${I.p3}

${I.rules}`;

  const r=await fetch('https://api.anthropic.com/v1/messages',{
    method:'POST',
    headers:{'Content-Type':'application/json','anthropic-version':'2023-06-01'},
    body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:500,messages:[{role:'user',content:prompt}]})
  });
  if(!r.ok) throw new Error('API');
  const d=await r.json();
  return d.content[0].text;
}

// Fallback enti√®rement traduit avec labels lisibles (jamais d'IDs bruts)
function fallback(){
  const proj=S.project;
  const c=S.calm, p=S.present, r=S.rich;

  // Labels traduits pour chaque valeur
  const TYPE={
    fr:{place:'lieu',story:'narration de marque',moment:'moment de vie'},
    en:{place:'place',story:'brand story',moment:'life moment'},
    es:{place:'lugar',story:'historia de marca',moment:'momento de vida'},
    ca:{place:'lloc',story:'hist√≤ria de marca',moment:'moment de vida'}
  };
  const PRIO={
    fr:{auth:'authenticit√©',brand:'coh√©rence visuelle',singular:'singularit√©',trust:'cr√©dibilit√©'},
    en:{auth:'authenticity',brand:'visual coherence',singular:'singularity',trust:'credibility'},
    es:{auth:'autenticidad',brand:'coherencia visual',singular:'singularidad',trust:'credibilidad'},
    ca:{auth:'autenticitat',brand:'coher√®ncia visual',singular:'singularitat',trust:'credibilitat'}
  };
  const CHAN={
    fr:{web:'site web',social:'r√©seaux sociaux',press:'presse',print:'print'},
    en:{web:'website',social:'social media',press:'press',print:'print'},
    es:{web:'web',social:'redes sociales',press:'prensa',print:'impresi√≥n'},
    ca:{web:'web',social:'xarxes socials',press:'premsa',print:'impressi√≥'}
  };
  const LOC={
    fr:{sitges:'√† Sitges',bcn:'√† Barcelone',cat:'en Catalogne',other:'hors Catalogne'},
    en:{sitges:'in Sitges',bcn:'in Barcelona',cat:'in Catalonia',other:'outside Catalonia'},
    es:{sitges:'en Sitges',bcn:'en Barcelona',cat:'en Catalu√±a',other:'fuera de Catalu√±a'},
    ca:{sitges:'a Sitges',bcn:'a Barcelona',cat:'a Catalunya',other:'fora de Catalunya'}
  };
  const TIM={
    fr:{fixed:'√† date fix√©e',approx:'approximatif',flex:'flexible'},
    en:{fixed:'fixed',approx:'approximate',flex:'flexible'},
    es:{fixed:'con fecha fija',approx:'aproximado',flex:'flexible'},
    ca:{fixed:'amb data fixada',approx:'aproximat',flex:'flexible'}
  };

  const tl=S.type?TYPE[L]?.[S.type]||S.type:'';
  const prios=S.priorities.map(x=>PRIO[L]?.[x]||x);
  const chans=S.channels.map(x=>CHAN[L]?.[x]||x);
  const locStr=LOC[L]?.[S.location]||'';
  const timStr=TIM[L]?.[S.timing]||'';

  const sep={fr:' et ',en:' and ',es:' y ',ca:' i '}[L]||' & ';

  const FB={
    fr:`${proj||'Ce projet'} est un projet de photographie ${tl}, destin√© √† ${chans.join(sep)||'vos supports'}. Je comprends l'essentiel : vous cherchez ${prios.join(sep)||'un r√©sultat authentique'}.\n\nMon approche sera ${c<40?'calme et pos√©e, des images contemplatives qui laissent respirer':c>60?'vivante et rythm√©e, avec de l\'√©nergie dans chaque cadre':'√©quilibr√©e entre calme et pr√©sence'}. Je vais travailler ${p<40?'√† distance pour donner du contexte et de la profondeur':p>60?'au plus pr√®s, attentive aux d√©tails, aux mati√®res, aux gestes':'en alternant vues d\'ensemble et d√©tails'}. Esth√©tiquement, je privil√©gie ${r<40?'l\'√©pure ‚Äî des cadrages nets, peu d\'√©l√©ments, de l\'espace':r>60?'la richesse des textures et des ambiances, des images denses':'un √©quilibre entre sobri√©t√© et pr√©sence visuelle'}.\n\nLa s√©ance est pr√©vue ${locStr}, avec un planning ${timStr}. Discutons ensemble pour affiner la proposition.`,
    en:`${proj||'This project'} is a ${tl} photography project, intended for ${chans.join(sep)||'your platforms'}. I understand the core: you're after ${prios.join(sep)||'authentic results'}.\n\nMy approach will be ${c<40?'calm and contemplative ‚Äî images that breathe, that let the eye rest':c>60?'lively and energetic, with rhythm in every frame':'balanced between stillness and presence'}. I'll work ${p<40?'at a distance to convey context and depth':p>60?'up close, attentive to details, textures, gestures':'alternating wide views with intimate details'}. Aesthetically, I'll lean toward ${r<40?'clean, minimal framing ‚Äî space, light, simplicity':r>60?'rich textures and layered atmosphere, dense and evocative images':'a balance between restraint and visual depth'}.\n\nThe shoot is planned ${locStr}, with a ${timStr} timeline. Let's talk to refine the details.`,
    es:`${proj||'Este proyecto'} es un proyecto de fotograf√≠a ${tl}, destinado a ${chans.join(sep)||'tus plataformas'}. Entiendo lo esencial: buscas ${prios.join(sep)||'resultados aut√©nticos'}.\n\nMi enfoque ser√° ${c<40?'calmo y contemplativo ‚Äî im√°genes que respiran, que dejan reposar la mirada':c>60?'vivo y din√°mico, con energ√≠a en cada encuadre':'equilibrado entre calma y presencia'}. Trabajar√© ${p<40?'con distancia para transmitir contexto y profundidad':p>60?'muy cerca, atenta a los detalles, texturas y gestos':'alternando vistas generales con detalles √≠ntimos'}. Est√©ticamente, privilegiar√© ${r<40?'la limpieza ‚Äî encuadres netos, pocos elementos, espacio':r>60?'la riqueza de texturas y ambientes, im√°genes densas':'un equilibrio entre sobriedad y presencia visual'}.\n\nLa sesi√≥n est√° prevista ${locStr}, con una planificaci√≥n ${timStr}. Hablemos para afinar la propuesta.`,
    ca:`${proj||'Aquest projecte'} √©s un projecte de fotografia ${tl}, destinat a ${chans.join(sep)||'les teves plataformes'}. Entenc l'essencial: busques ${prios.join(sep)||'resultats aut√®ntics'}.\n\nEl meu enfocament ser√† ${c<40?'calmat i contemplatiu ‚Äî imatges que respiren, que deixen reposar la mirada':c>60?'viu i din√†mic, amb energia a cada enquadrament':'equilibrat entre calma i pres√®ncia'}. Treballar√© ${p<40?'amb dist√†ncia per transmetre context i profunditat':p>60?'molt a prop, atenta als detalls, textures i gestos':'alternant vistes generals amb detalls √≠ntims'}. Est√®ticament, privilegiar√© ${r<40?'l\'epur√© ‚Äî enquadraments nets, pocs elements, espai':r>60?'la riquesa de textures i atmosferes, imatges denses':'un equilibri entre sobrietat i pres√®ncia visual'}.\n\nLa sessi√≥ √©s prevista ${locStr}, amb una planificaci√≥ ${timStr}. Parlem per afinar la proposta.`
  };
  return FB[L]||FB.en;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER RAPPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderReport(txt){
  const c=document.getElementById('card');
  const proj=S.project||(L==='fr'?'Votre projet':L==='es'?'Tu proyecto':L==='ca'?'El teu projecte':'Your project');
  const locale={fr:'fr-FR',en:'en-GB',es:'es-ES',ca:'ca-ES'}[L]||'en-GB';
  const date=new Date().toLocaleDateString(locale,{day:'numeric',month:'long',year:'numeric'});
  const paras=txt.split('\n\n').filter(p=>p.trim()).map(p=>`<p>${p.trim()}</p>`).join('');
  c.innerHTML=`
    <div class="rpt-hero">
      <h1>${proj}</h1>
      ${S.name?`<div class="client">${S.name}</div>`:''}
      <div class="rdate">${date}</div>
    </div>
    <div class="rpt-body">${paras}</div>
    <div class="rpt-cta">
      <h2>${t('report.ctaTitle')}</h2>
      <div class="closing-q">"${t('report.ctaQuote')}"</div>
      <p>${t('report.ctaText')}</p>
      <div class="cta-btns">
        <button class="bp" onclick="doEmail()">${t('report.btnEmail')}</button>
        <button class="bs" onclick="doRdv()">${t('report.btnRdv')}</button>
        <button class="bs" onclick="doPDF()">${t('report.btnPdf')}</button>
        <button class="bs" onclick="doRestart()">${t('report.btnRestart')}</button>
      </div>
    </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ACTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function doEmail(){
  const NL='\n';

  // Labels lisibles pour les donn√©es du formulaire
  const TYPE_L={fr:{place:'Lieu',story:'Narration / Marque',moment:'Moment'},en:{place:'Place',story:'Brand story',moment:'Moment'},es:{place:'Lugar',story:'Historia / Marca',moment:'Momento'},ca:{place:'Lloc',story:'Hist√≤ria / Marca',moment:'Moment'}};
  const PRIO_L={fr:{auth:'Authenticit√©',brand:'Coh√©rence',singular:'Singularit√©',trust:'Cr√©dibilit√©'},en:{auth:'Authenticity',brand:'Coherence',singular:'Singularity',trust:'Credibility'},es:{auth:'Autenticidad',brand:'Coherencia',singular:'Singularidad',trust:'Credibilidad'},ca:{auth:'Autenticitat',brand:'Coher√®ncia',singular:'Singularitat',trust:'Credibilitat'}};
  const CHAN_L={fr:{web:'Site web',social:'R√©seaux sociaux',press:'Presse',print:'Print'},en:{web:'Website',social:'Social media',press:'Press',print:'Print'},es:{web:'Web',social:'Redes sociales',press:'Prensa',print:'Print'},ca:{web:'Web',social:'Xarxes socials',press:'Premsa',print:'Print'}};
  const LOC_L={fr:{sitges:'Sitges / Garraf',bcn:'Barcelone',cat:'Catalogne',other:'Hors Catalogne'},en:{sitges:'Sitges / Garraf',bcn:'Barcelona',cat:'Catalonia',other:'Outside Catalonia'},es:{sitges:'Sitges / Garraf',bcn:'Barcelona',cat:'Catalu√±a',other:'Fuera de Catalu√±a'},ca:{sitges:'Sitges / Garraf',bcn:'Barcelona',cat:'Catalunya',other:'Fora de Catalunya'}};
  const TIM_L={fr:{fixed:'Date fix√©e',approx:'P√©riode approximative',flex:'Flexible'},en:{fixed:'Fixed date',approx:'Approximate period',flex:'Flexible'},es:{fixed:'Fecha fija',approx:'Per√≠odo aproximado',flex:'Flexible'},ca:{fixed:'Data fixada',approx:'Per√≠ode aproximat',flex:'Flexible'}};
  const VIBE_L={fr:['Calme','√âquilibr√©','Vivant'],en:['Calm','Balanced','Lively'],es:['Calmo','Equilibrado','Vivo'],ca:['Calmat','Equilibrat','Viu']};
  const vibeWord=(val)=>val<35?VIBE_L[L][0]:val>65?VIBE_L[L][2]:VIBE_L[L][1];

  // Labels des champs selon la langue
  const FIELDS={
    fr:{proj:'Projet',type:'Type',prio:'Priorit√©s',usage:'Usage',chan:'Diffusion',loc:'Lieu',tim:'Planning',calm:'√ânergie',pres:'Proximit√©',rich:'Esth√©tique',email:'Email client'},
    en:{proj:'Project',type:'Type',prio:'Priorities',usage:'Use',chan:'Distribution',loc:'Location',tim:'Timeline',calm:'Energy',pres:'Proximity',rich:'Aesthetic',email:'Client email'},
    es:{proj:'Proyecto',type:'Tipo',prio:'Prioridades',usage:'Uso',chan:'Difusi√≥n',loc:'Lugar',tim:'Planificaci√≥n',calm:'Energ√≠a',pres:'Proximidad',rich:'Est√©tica',email:'Email cliente'},
    ca:{proj:'Projecte',type:'Tipus',prio:'Prioritats',usage:'√ös',chan:'Difusi√≥',loc:'Lloc',tim:'Planificaci√≥',calm:'Energia',pres:'Proximitat',rich:'Est√®tica',email:'Email client'}
  };
  const F=FIELDS[L]||FIELDS.en;

  const subj=t('emailSubj')+': '+(S.project||'‚Äî');

  const formBlock=[
    `${F.proj} : ${S.project||'‚Äî'}`,
    `${F.type} : ${TYPE_L[L]?.[S.type]||'‚Äî'}`,
    `${F.prio} : ${S.priorities.map(x=>PRIO_L[L]?.[x]||x).join(', ')||'‚Äî'}`,
    `${F.usage} : ${({launch:{fr:'Lancement',en:'Launch',es:'Lanzamiento',ca:'Llan√ßament'},base:{fr:'Base long terme',en:'Long-term library',es:'Biblioteca duradera',ca:'Biblioteca duradora'},series:{fr:'S√©rie continue',en:'Ongoing series',es:'Serie continua',ca:'S√®rie cont√≠nua'}}[S.usage]?.[L])||'‚Äî'}`,
    `${F.chan} : ${S.channels.map(x=>CHAN_L[L]?.[x]||x).join(', ')||'‚Äî'}`,
    `${F.loc} : ${LOC_L[L]?.[S.location]||'‚Äî'}`,
    `${F.tim} : ${TIM_L[L]?.[S.timing]||'‚Äî'}`,
    `${F.calm} : ${S.calm}/100 (${vibeWord(S.calm)})`,
    `${F.pres} : ${S.present}/100 (${vibeWord(S.present)})`,
    `${F.rich} : ${S.rich}/100 (${vibeWord(S.rich)})`,
    `${F.email} : ${S.email||'‚Äî'}`
  ].join(NL);

  const body=
    t('emailHi')+NL+NL+
    t('emailIntro')+NL+NL+
    '‚îÅ‚îÅ‚îÅ BRIEF ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ'+NL+NL+
    (S.briefText||fallback())+NL+NL+
    '‚îÅ‚îÅ‚îÅ FORMULAIRE ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ'+NL+NL+
    formBlock+NL+NL+
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ'+NL+NL+
    t('emailSign')+NL+(S.name||'');

  window.location.href=`mailto:info@marinaphoto.es?subject=${encodeURIComponent(subj)}&body=${encodeURIComponent(body)}`;
}

function doRdv(){
  // Remplacer par l'URL Calendly r√©elle de Marina
  window.open('https://calendly.com/marinaphoto/30min','_blank','noopener');
}

function doPDF(){
  try{
    const {jsPDF}=window.jspdf;
    const doc=new jsPDF({unit:'mm',format:'a4',orientation:'portrait'});
    const gold=[200,168,130], dark=[44,44,44], white=[254,254,254], cream=[245,241,232];
    const W=210, margin=18;

    // --- HEADER BAND ---
    doc.setFillColor(...gold);
    doc.rect(0,0,W,38,'F');
    doc.setTextColor(...white);
    doc.setFontSize(18);doc.setFont('helvetica','bold');
    doc.text('MARINAPHOTO',margin,16);
    doc.setFontSize(9);doc.setFont('helvetica','normal');
    doc.text('Photography Brief',margin,24);
    const locale={fr:'fr-FR',en:'en-GB',es:'es-ES',ca:'ca-ES'}[L]||'en-GB';
    const dateStr=new Date().toLocaleDateString(locale,{day:'numeric',month:'long',year:'numeric'});
    doc.text(dateStr,W-margin,24,{align:'right'});

    // --- HERO PROJECT NAME ---
    doc.setFillColor(...cream);
    doc.rect(0,38,W,36,'F');
    doc.setTextColor(...dark);
    doc.setFontSize(26);doc.setFont('helvetica','bold');
    const proj=S.project||(L==='fr'?'Votre projet':L==='es'?'Tu proyecto':L==='ca'?'El teu projecte':'Your project');
    doc.text(proj,margin,58);
    if(S.name){
      doc.setFontSize(12);doc.setFont('helvetica','normal');
      doc.setTextColor(...gold);
      doc.text(S.name,margin,68);
    }

    // --- GOLD VERTICAL BAR + BRIEF TEXT ---
    let y=88;
    doc.setFillColor(...gold);
    doc.rect(margin,y,2,140,'F');

    doc.setTextColor(...dark);
    doc.setFontSize(11);doc.setFont('helvetica','normal');
    const briefTxt=S.briefText||fallback();
    const lines=doc.splitTextToSize(briefTxt,W-margin*2-8);
    lines.forEach(ln=>{
      if(y>262){doc.addPage();y=20;
        doc.setFillColor(...gold);doc.rect(margin,y,2,140,'F');
      }
      doc.text(ln,margin+6,y);
      y+=6.2;
    });

    // --- CLOSING QUOTE BOX ---
    y+=12;
    if(y>250){doc.addPage();y=20;}
    doc.setFillColor(...gold);
    doc.roundedRect(margin,y,W-margin*2,24,4,4,'F');
    doc.setTextColor(...white);
    doc.setFontSize(10);doc.setFont('helvetica','italic');
    doc.text('"'+t('report.ctaQuote')+'"',W/2,y+10,{align:'center',maxWidth:W-margin*2-8});
    doc.setFont('helvetica','normal');doc.setFontSize(9);
    doc.text(t('report.ctaText'),W/2,y+18,{align:'center',maxWidth:W-margin*2-8});

    // --- FOOTER ---
    const FY=285;
    doc.setFillColor(...dark);
    doc.rect(0,FY-2,W,14,'F');
    doc.setTextColor(...white);
    doc.setFontSize(9);
    doc.setFont('helvetica','bold');doc.text('MARINAPHOTO',margin,FY+5);
    doc.setFont('helvetica','normal');doc.text('info@marinaphoto.es',W/2,FY+5,{align:'center'});
    doc.text('Sitges ‚Äî Barcelona',W-margin,FY+5,{align:'right'});

    const fn=(t('pdfFilename')+'-'+(S.project||'project').replace(/[^a-z0-9]/gi,'-').toLowerCase()+'.pdf');
    doc.save(fn);
  }catch(e){
    console.error('PDF error:',e);
    alert('PDF error: '+e.message);
  }
}

function doRestart(){
  if(!confirm(t('restartConfirm')))return;
  step=0;
  S.name='';S.project='';S.type=null;S.priorities=[];S.usage=null;
  S.channels=[];S.location=null;S.timing=null;
  S.calm=50;S.present=50;S.rich=50;S.email='';S.briefText='';
  go();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// START
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
go();
</script>
</body>
</html>
