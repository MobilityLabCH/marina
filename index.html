<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Marinaphoto ‚Äî Brief</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,400&family=Inter:wght@400;500;600;700&display=swap');
:root{--cream:#F5F1E8;--gold:#C8A882;--gold-l:#E8D5BC;--dark:#2C2C2C;--white:#FEFEFE;}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Inter',sans-serif;background:var(--cream);color:var(--dark);min-height:100vh;}
.page{min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:32px 20px 60px;}

/* TOP BAR */
.topbar{width:100%;max-width:860px;display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:12px;}
.brand{font-family:'Playfair Display',serif;font-size:20px;font-weight:700;color:var(--dark);}
.brand em{font-style:normal;color:var(--gold);font-family:'Inter',sans-serif;font-size:12px;font-weight:400;margin-left:8px;}
.langs{display:flex;gap:2px;background:var(--white);border-radius:20px;padding:3px;box-shadow:0 2px 12px rgba(44,44,44,.08);}
.langs button{border:none;background:transparent;color:var(--dark);opacity:.4;font-size:12px;font-weight:700;padding:7px 11px;border-radius:16px;cursor:pointer;transition:all .2s;font-family:'Inter',sans-serif;}
.langs button.on{background:var(--gold);color:var(--white);opacity:1;}

/* PROGRESS */
.prog-wrap{width:100%;max-width:860px;background:var(--white);border-radius:16px;padding:16px 22px;margin-bottom:22px;box-shadow:0 2px 16px rgba(44,44,44,.06);}
.prog-bar{height:5px;background:var(--cream);border-radius:10px;overflow:hidden;margin-bottom:10px;}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--gold),var(--gold-l));border-radius:10px;transition:width .5s ease;}
.prog-meta{display:flex;justify-content:space-between;font-size:12px;font-weight:500;opacity:.6;}
.prog-meta .t{color:var(--gold);font-weight:700;opacity:1;}

/* CARD */
.card{width:100%;max-width:860px;background:var(--white);border-radius:24px;padding:clamp(28px,5vw,52px);box-shadow:0 8px 40px rgba(44,44,44,.10);animation:up .4s ease;}
@keyframes up{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

/* TYPOGRAPHY */
.kicker{font-size:11px;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;color:var(--gold);margin-bottom:14px;}
h1{font-family:'Playfair Display',serif;font-size:clamp(24px,4vw,38px);font-weight:700;line-height:1.2;margin-bottom:12px;}
.sub{font-size:17px;opacity:.7;line-height:1.65;margin-bottom:26px;}
.opening-quote{font-family:'Playfair Display',serif;font-style:italic;font-size:clamp(20px,3vw,30px);color:var(--gold);line-height:1.45;text-align:center;margin:20px 0 32px;}

/* INPUTS */
input[type=text],input[type=email]{width:100%;padding:15px 20px;border:2px solid transparent;background:var(--cream);border-radius:14px;font-size:16px;font-family:'Inter',sans-serif;color:var(--dark);outline:none;margin-top:8px;transition:all .25s;}
input:focus{border-color:var(--gold);background:var(--white);box-shadow:0 0 0 4px rgba(200,168,130,.12);}
input::placeholder{opacity:.4;}

/* OPTIONS */
.opts{display:flex;flex-direction:column;gap:10px;margin:20px 0;}
.opt{padding:18px 22px;background:var(--cream);border:2px solid transparent;border-radius:18px;cursor:pointer;transition:all .25s;position:relative;user-select:none;}
.opt:hover{background:var(--white);border-color:var(--gold-l);transform:translateY(-2px);box-shadow:0 4px 20px rgba(44,44,44,.07);}
.opt.sel{background:var(--white);border-color:var(--gold);box-shadow:0 0 0 3px rgba(200,168,130,.15);}
.opt.sel::after{content:'‚úì';position:absolute;top:50%;right:20px;transform:translateY(-50%);width:26px;height:26px;background:var(--gold);color:var(--white);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;line-height:26px;text-align:center;}
.opt-t{font-size:16px;font-weight:700;margin-bottom:3px;padding-right:36px;}
.opt-d{font-size:13px;opacity:.6;line-height:1.4;padding-right:36px;}

/* VIBE SLIDERS */
.vibe-block{background:var(--cream);border-radius:20px;padding:22px;margin-bottom:18px;}
.vibe-label-row{display:flex;justify-content:space-between;font-size:13px;font-weight:600;margin-bottom:4px;opacity:.75;}
.vibe-cat{font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;opacity:.45;margin-bottom:10px;}
input[type=range]{width:100%;height:6px;-webkit-appearance:none;appearance:none;background:linear-gradient(90deg,var(--gold) var(--p,50%),rgba(200,168,130,.2) var(--p,50%));border-radius:10px;outline:none;cursor:pointer;margin:10px 0 16px;}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:22px;height:22px;background:var(--white);border:3px solid var(--gold);border-radius:50%;box-shadow:0 2px 8px rgba(200,168,130,.4);}
input[type=range]::-moz-range-thumb{width:22px;height:22px;background:var(--white);border:3px solid var(--gold);border-radius:50%;}
.vibe-illus{display:grid;grid-template-columns:1fr 1fr;gap:8px;pointer-events:none;}
.vibe-img{border-radius:12px;overflow:hidden;aspect-ratio:3/2;position:relative;}
.vibe-img img{width:100%;height:100%;object-fit:cover;display:block;}
.vibe-img-lbl{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(transparent,rgba(44,44,44,.65));color:#fff;font-size:11px;font-weight:600;padding:12px 10px 7px;letter-spacing:.5px;}

/* BUTTONS */
.btns{display:flex;gap:12px;margin-top:28px;flex-wrap:wrap;}
.bp{padding:14px 32px;background:var(--gold);color:var(--white);border:2px solid var(--gold);border-radius:50px;font-size:15px;font-weight:700;font-family:'Inter',sans-serif;cursor:pointer;transition:all .25s;}
.bp:hover{background:#b89060;border-color:#b89060;transform:translateY(-2px);box-shadow:0 8px 20px rgba(200,168,130,.3);}
.bs{padding:14px 24px;background:transparent;color:var(--gold);border:2px solid var(--gold);border-radius:50px;font-size:15px;font-weight:700;font-family:'Inter',sans-serif;cursor:pointer;transition:all .25s;}
.bs:hover{background:var(--gold);color:var(--white);transform:translateY(-2px);}

/* LOADING */
.loading{text-align:center;padding:80px 20px;}
.spinner{width:50px;height:50px;border:4px solid var(--cream);border-top-color:var(--gold);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 22px;}
@keyframes spin{to{transform:rotate(360deg)}}
.loading h2{font-family:'Playfair Display',serif;margin-bottom:10px;}
.loading p{opacity:.6;font-size:16px;}

/* RAPPORT */
.rpt-hero{text-align:center;padding:56px 24px 40px;margin:-52px -52px 40px;background:linear-gradient(160deg,rgba(200,168,130,.07) 0%,transparent 60%);border-radius:24px 24px 0 0;border-bottom:1px solid rgba(200,168,130,.15);}
.rpt-hero h1{font-family:'Playfair Display',serif;font-size:clamp(38px,7vw,72px);font-weight:900;line-height:1.1;margin-bottom:16px;background:linear-gradient(135deg,var(--dark) 30%,var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.rpt-hero .client{font-size:18px;color:var(--gold);font-weight:600;margin-bottom:6px;}
.rpt-hero .rdate{font-size:13px;opacity:.45;}
.rpt-body{border-left:3px solid var(--gold);padding:4px 0 4px 32px;margin:0 0 44px;}
.rpt-body p{font-size:18px;line-height:1.9;color:var(--dark);margin-bottom:22px;}
.rpt-body p:last-child{margin-bottom:0;}

/* Badge source IA */
.ai-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(200,168,130,.12);border:1px solid rgba(200,168,130,.3);border-radius:20px;padding:4px 12px;font-size:11px;font-weight:600;color:var(--gold);margin-bottom:20px;letter-spacing:.5px;}
.ai-badge::before{content:'‚ú¶';font-size:10px;}

/* CTA FINALE */
.rpt-cta{background:linear-gradient(135deg,var(--gold) 0%,#b8916a 100%);border-radius:24px;padding:48px;text-align:center;}
.rpt-cta h2{font-family:'Playfair Display',serif;font-size:26px;color:#fff;margin-bottom:10px;}
.closing-q{font-family:'Playfair Display',serif;font-style:italic;font-size:20px;color:#fff;opacity:.95;margin:18px 0 24px;line-height:1.5;}
.rpt-cta p{color:#fff;opacity:.92;font-size:16px;line-height:1.65;margin-bottom:30px;}
.cta-btns{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;}
.rpt-cta .bp{background:#fff;color:var(--gold);border-color:#fff;}
.rpt-cta .bp:hover{background:var(--cream);}
.rpt-cta .bs{background:transparent;color:#fff;border-color:rgba(255,255,255,.7);}
.rpt-cta .bs:hover{background:rgba(255,255,255,.15);}

@media(max-width:640px){
  .card{padding:22px 18px;}
  .rpt-hero{margin:-22px -18px 30px;padding:38px 18px 26px;}
  .rpt-body{padding-left:18px;}
  .rpt-cta{padding:30px 20px;}
  .btns,.cta-btns{flex-direction:column;}
  .bp,.bs{width:100%;text-align:center;}
}
</style>
</head>
<body>
<div class="page">
  <div class="topbar">
    <div class="brand">MARINAPHOTO <em>Photography Brief</em></div>
    <div class="langs">
      <button id="l-fr" class="on" onclick="setLang('fr')">FR</button>
      <button id="l-en" onclick="setLang('en')">EN</button>
      <button id="l-es" onclick="setLang('es')">ES</button>
      <button id="l-ca" onclick="setLang('ca')">CA</button>
    </div>
  </div>
  <div class="prog-wrap">
    <div class="prog-bar"><div class="prog-fill" id="pbar"></div></div>
    <div class="prog-meta"><span id="pstep"></span><span class="t" id="ptime"></span></div>
  </div>
  <div class="card" id="card"></div>
</div>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const detectLang=()=>{
  try{
    const nav=navigator.language||navigator.userLanguage;
    if(!nav) return 'en';
    const code=nav.toLowerCase().slice(0,2);
    if(code==='fr') return 'fr';
    if(code==='es') return 'es';
    if(code==='ca') return 'ca';
    return 'en';
  }catch(e){ return 'en'; }
};

let L = detectLang(), step = 0;
const TOTAL = 11;
const S = {
  name:'', project:'', type:null,
  priorities:[], usage:null, channels:[],
  location:null, timing:null,
  calm:50, present:50, rich:50,
  email:'', briefText:'', briefSource:'ai'
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TRANSLATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const TX = {
fr:{
  steps:['Intro','Pr√©nom','Projet','Type','Priorit√©s','Usage','Canaux','Lieu','Timing','Ambiance','Contact'],
  times:['3 min','2 min','2 min','2 min','1 min','1 min','1 min','1 min','30 sec','30 sec','20 sec'],
  back:'Retour', maxTwo:'Maximum 2 choix', mustPick:'Veuillez choisir une option', emailErr:'Email invalide',
  aiBadge:'R√©dig√© par IA ¬∑ Cloudflare Workers AI',
  fallbackBadge:'Brief g√©n√©r√© automatiquement',
  intro:{kicker:'Commen√ßons',quote:'Je sais ce qu\'une image repr√©sente pour vous‚Ä¶',title:'3 minutes pour comprendre votre projet.',sub:'Quelques questions simples. Je transforme vos r√©ponses en un brief personnalis√© qui nous guide.',btn:'Commencer'},
  name:{kicker:'√Ä propos de vous',title:'Votre pr√©nom',ph:'Ex : Sophie',btn:'Continuer'},
  project:{kicker:'Le projet',title:'Comment s\'appelle votre projet ?',sub:'Un nom, m√™me provisoire.',ph:'Ex : H√¥tel Can Ros / Bodega Garraf',btn:'Continuer'},
  type:{kicker:'Nature du projet',title:'Votre projet, c\'est avant tout‚Ä¶',opts:[
    {id:'place',t:'üè† Un lieu √† faire ressentir',d:'H√¥tel, restaurant, architecture. La lumi√®re, l\'espace, l\'atmosph√®re.'},
    {id:'story',t:'üìñ Une histoire √† raconter',d:'Artisan, marque, projet. Les gens, les gestes, le contexte.'},
    {id:'moment',t:'‚è≥ Un moment √† garder',d:'Famille, couple, √©v√©nement. L\'instant, l\'√©motion, la vie.'}
  ],btn:'Continuer'},
  priorities:{kicker:'L\'effet recherch√©',title:'Ce que vous voulez transmettre',sub:'1 ou 2 priorit√©s',opts:[
    {id:'auth',t:'Authenticit√©',d:'Vrai, pr√©sent, pas artificiel'},
    {id:'brand',t:'Coh√©rence',d:'Align√© avec votre identit√© visuelle'},
    {id:'singular',t:'Singularit√©',d:'Un regard reconnaissable, pas du d√©j√†-vu'},
    {id:'trust',t:'Cr√©dibilit√©',d:'Professionnel, humain, qui inspire confiance'}
  ],btn:'Continuer'},
  usage:{kicker:'Usage',title:'Ces images vont servir √†‚Ä¶',opts:[
    {id:'launch',t:'üìÜ Un lancement / √©v√©nement',d:'Ouverture, campagne pr√©cise, √©v√©nement avec deadline'},
    {id:'base',t:'üîÅ Constituer une biblioth√®que',d:'Images r√©utilisables pour votre communication courante'},
    {id:'series',t:'üå± Une s√©rie r√©guli√®re',d:'Contenu continu (r√©seaux, blog, √©volution dans le temps)'}
  ],btn:'Continuer'},
  channels:{kicker:'Diffusion',title:'O√π ces images vivront-elles ?',sub:'Max 2',opts:[
    {id:'web',t:'Site web'},{id:'social',t:'R√©seaux sociaux'},{id:'press',t:'Presse / √©ditorial'},{id:'print',t:'Print / affichage'}
  ],btn:'Continuer'},
  location:{kicker:'Logistique',title:'O√π se d√©roule la s√©ance ?',opts:[
    {id:'sitges',t:'üìç Sitges et environs',d:'Garraf, Vilanova, Cubelles‚Ä¶'},
    {id:'bcn',t:'üìç Barcelone',d:'Ville ou p√©riph√©rie'},
    {id:'cat',t:'üìç Ailleurs en Catalogne',d:'Costa Brava, Tarragone, int√©rieur‚Ä¶'},
    {id:'other',t:'üìç En dehors de Catalogne',d:'√Ä d√©finir ensemble'}
  ],btn:'Continuer'},
  timing:{kicker:'Planning',title:'Quand avez-vous besoin des images ?',opts:[
    {id:'fixed',t:'üìÖ Date fix√©e',d:'J\'ai une deadline pr√©cise'},
    {id:'approx',t:'üìÜ P√©riode approximative',d:'Dans les prochaines semaines ou mois'},
    {id:'flex',t:'üåä Pas d\'urgence',d:'On cale √ßa ensemble'}
  ],btn:'Continuer'},
  vibe:{kicker:'Direction artistique',title:'Comment je dois photographier',
    sub:'Ajustez les trois curseurs. Les photos illustrent chaque extr√™me ‚Äî elles ne sont pas cliquables.',
    sliders:[
      {id:'calm',cat:'√ânergie',lo:'Calme & contemplatif',hi:'Vivant & dynamique',
        imgs:[{src:'https://images.unsplash.com/photo-1518709268805-4e9042af9f23?w=600',lbl:'Calme'},
              {src:'https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=600',lbl:'Vivant'}]},
      {id:'present',cat:'Proximit√©',lo:'Distance & contexte',hi:'Intime & d√©tails',
        imgs:[{src:'https://images.unsplash.com/photo-1505373877841-8d25f7d46678?w=600',lbl:'Vue large'},
              {src:'https://images.unsplash.com/photo-1495195134817-aeb325a55b65?w=600',lbl:'Proximit√©'}]},
      {id:'rich',cat:'Esth√©tique',lo:'√âpur√© & minimaliste',hi:'Textur√© & riche',
        imgs:[{src:'https://images.unsplash.com/photo-1484101403633-562f891dc89a?w=600',lbl:'√âpur√©'},
              {src:'https://images.unsplash.com/photo-1513151233558-d860c5398176?w=600',lbl:'Textur√©'}]}
    ],btn:'Voir le brief'},
  contact:{kicker:'Derni√®re √©tape',title:'Votre adresse email',sub:'Pour recevoir ce brief et commencer √† √©changer.',ph:'vous@email.com',btn:'G√©n√©rer le brief'},
  report:{loading:'R√©daction de votre brief‚Ä¶',loadSub:'L\'IA Cloudflare analyse vos r√©ponses et compose votre brief personnalis√©.',
    ctaTitle:'La suite',ctaQuote:'‚Ä¶Et maintenant vous savez ce qu\'une image repr√©sente pour moi.',
    ctaText:'Discutons de votre projet. Je vous pr√©pare une proposition personnalis√©e ‚Äî approche, planning et budget.',
    btnEmail:'Envoyer le brief √† Marina',btnRdv:'Prendre rendez-vous',btnPdf:'T√©l√©charger en PDF',btnRestart:'Nouveau brief'},
  emailSubj:'Brief photo',emailHi:'Bonjour Marina,',emailIntro:'Voici mon brief compl√©t√© via le questionnaire en ligne.',emailSign:'Cordialement,',
  restartConfirm:'Recommencer le questionnaire ?',
  pdfFilename:'marinaphoto-brief'
},
en:{
  steps:['Intro','Name','Project','Type','Priorities','Use','Channels','Location','Timing','Vibe','Contact'],
  times:['3 min','2 min','2 min','2 min','1 min','1 min','1 min','1 min','30 sec','30 sec','20 sec'],
  back:'Back', maxTwo:'Maximum 2 choices', mustPick:'Please choose an option', emailErr:'Invalid email',
  aiBadge:'Written by AI ¬∑ Cloudflare Workers AI',
  fallbackBadge:'Auto-generated brief',
  intro:{kicker:'Let\'s start',quote:'I know what an image means to you‚Ä¶',title:'3 minutes to understand your project.',sub:'A few simple questions. I turn your answers into a personalised brief that guides our work.',btn:'Start'},
  name:{kicker:'About you',title:'Your first name',ph:'e.g. Sophie',btn:'Continue'},
  project:{kicker:'The project',title:'What is your project called?',sub:'A name, even a working one.',ph:'e.g. Hotel Can Ros / Garraf Winery',btn:'Continue'},
  type:{kicker:'Project type',title:'Your project is mainly‚Ä¶',opts:[
    {id:'place',t:'üè† A place to make felt',d:'Hotel, restaurant, architecture. Light, space, atmosphere.'},
    {id:'story',t:'üìñ A story to tell',d:'Artisan, brand, project. People, gestures, context.'},
    {id:'moment',t:'‚è≥ A moment to keep',d:'Family, couple, event. The instant, emotion, life.'}
  ],btn:'Continue'},
  priorities:{kicker:'The desired effect',title:'What you want to convey',sub:'1 or 2 priorities',opts:[
    {id:'auth',t:'Authenticity',d:'Real, present, not artificial'},
    {id:'brand',t:'Coherence',d:'Aligned with your visual identity'},
    {id:'singular',t:'Singularity',d:'A recognisable eye, nothing generic'},
    {id:'trust',t:'Credibility',d:'Professional, human, trust-inspiring'}
  ],btn:'Continue'},
  usage:{kicker:'Use',title:'These images will serve‚Ä¶',opts:[
    {id:'launch',t:'üìÜ A launch / event',d:'Opening, specific campaign, event with deadline'},
    {id:'base',t:'üîÅ Building a library',d:'Reusable images for your ongoing communication'},
    {id:'series',t:'üå± An ongoing series',d:'Continuous content (social, blog, evolution over time)'}
  ],btn:'Continue'},
  channels:{kicker:'Distribution',title:'Where will these images live?',sub:'Max 2',opts:[
    {id:'web',t:'Website'},{id:'social',t:'Social media'},{id:'press',t:'Press / editorial'},{id:'print',t:'Print / display'}
  ],btn:'Continue'},
  location:{kicker:'Logistics',title:'Where will the shoot take place?',opts:[
    {id:'sitges',t:'üìç Sitges area',d:'Garraf, Vilanova, Cubelles‚Ä¶'},
    {id:'bcn',t:'üìç Barcelona',d:'City or surroundings'},
    {id:'cat',t:'üìç Elsewhere in Catalonia',d:'Costa Brava, Tarragona, inland‚Ä¶'},
    {id:'other',t:'üìç Outside Catalonia',d:'To define together'}
  ],btn:'Continue'},
  timing:{kicker:'Schedule',title:'When do you need the images?',opts:[
    {id:'fixed',t:'üìÖ Fixed date',d:'I have a precise deadline'},
    {id:'approx',t:'üìÜ Approximate timeframe',d:'Within the next weeks or months'},
    {id:'flex',t:'üåä No urgency',d:'We figure it out together'}
  ],btn:'Continue'},
  vibe:{kicker:'Artistic direction',title:'How should I photograph',
    sub:'Adjust the three sliders. Photos illustrate each extreme ‚Äî they are not clickable.',
    sliders:[
      {id:'calm',cat:'Energy',lo:'Calm & contemplative',hi:'Lively & dynamic',
        imgs:[{src:'https://images.unsplash.com/photo-1518709268805-4e9042af9f23?w=600',lbl:'Still'},
              {src:'https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=600',lbl:'Lively'}]},
      {id:'present',cat:'Proximity',lo:'Distance & context',hi:'Intimate & details',
        imgs:[{src:'https://images.unsplash.com/photo-1505373877841-8d25f7d46678?w=600',lbl:'Wide'},
              {src:'https://images.unsplash.com/photo-1495195134817-aeb325a55b65?w=600',lbl:'Close'}]},
      {id:'rich',cat:'Aesthetic',lo:'Minimal & clean',hi:'Textured & rich',
        imgs:[{src:'https://images.unsplash.com/photo-1484101403633-562f891dc89a?w=600',lbl:'Minimal'},
              {src:'https://images.unsplash.com/photo-1513151233558-d860c5398176?w=600',lbl:'Textured'}]}
    ],btn:'See brief'},
  contact:{kicker:'Last step',title:'Your email address',sub:'To send you this brief and start the conversation.',ph:'you@email.com',btn:'Generate brief'},
  report:{loading:'Writing your brief‚Ä¶',loadSub:'Cloudflare AI is analysing your answers and composing your personalised brief.',
    ctaTitle:'Next step',ctaQuote:'‚Ä¶And now you know what an image means to me.',
    ctaText:'Let\'s talk about your project. I\'ll prepare a personalised proposal ‚Äî approach, timeline and budget.',
    btnEmail:'Send brief to Marina',btnRdv:'Book a call',btnPdf:'Download PDF',btnRestart:'New brief'},
  emailSubj:'Photo brief',emailHi:'Hello Marina,',emailIntro:'Here is my completed brief from the online questionnaire.',emailSign:'Best regards,',
  restartConfirm:'Restart the questionnaire?',
  pdfFilename:'marinaphoto-brief'
},
es:{
  steps:['Intro','Nombre','Proyecto','Tipo','Prioridades','Uso','Canales','Lugar','Timing','Vibra','Contacto'],
  times:['3 min','2 min','2 min','2 min','1 min','1 min','1 min','1 min','30 seg','30 seg','20 seg'],
  back:'Atr√°s', maxTwo:'M√°ximo 2 opciones', mustPick:'Por favor elija una opci√≥n', emailErr:'Email inv√°lido',
  aiBadge:'Redactado por IA ¬∑ Cloudflare Workers AI',
  fallbackBadge:'Brief generado autom√°ticamente',
  intro:{kicker:'Empecemos',quote:'S√© lo que una imagen significa para ti‚Ä¶',title:'3 minutos para entender tu proyecto.',sub:'Algunas preguntas simples. Transformo tus respuestas en un brief personalizado que gu√≠a nuestra colaboraci√≥n.',btn:'Empezar'},
  name:{kicker:'Sobre ti',title:'Tu nombre',ph:'ej. Sof√≠a',btn:'Continuar'},
  project:{kicker:'El proyecto',title:'¬øC√≥mo se llama tu proyecto?',sub:'Un nombre, aunque sea provisional.',ph:'ej. Hotel Can Ros / Bodega Garraf',btn:'Continuar'},
  type:{kicker:'Naturaleza del proyecto',title:'Tu proyecto es sobre todo‚Ä¶',opts:[
    {id:'place',t:'üè† Un lugar para sentir',d:'Hotel, restaurante, arquitectura. Luz, espacio, atm√≥sfera.'},
    {id:'story',t:'üìñ Una historia que contar',d:'Artesano, marca, proyecto. Personas, gestos, contexto.'},
    {id:'moment',t:'‚è≥ Un momento para guardar',d:'Familia, pareja, evento. El instante, la emoci√≥n, la vida.'}
  ],btn:'Continuar'},
  priorities:{kicker:'El efecto deseado',title:'Lo que quieres transmitir',sub:'1 o 2 prioridades',opts:[
    {id:'auth',t:'Autenticidad',d:'Real, presente, no artificial'},
    {id:'brand',t:'Coherencia',d:'Alineado con tu identidad visual'},
    {id:'singular',t:'Singularidad',d:'Una mirada reconocible, nada gen√©rico'},
    {id:'trust',t:'Credibilidad',d:'Profesional, humano, que inspira confianza'}
  ],btn:'Continuar'},
  usage:{kicker:'Uso',title:'Estas im√°genes servir√°n para‚Ä¶',opts:[
    {id:'launch',t:'üìÜ Un lanzamiento / evento',d:'Apertura, campa√±a espec√≠fica, evento con fecha l√≠mite'},
    {id:'base',t:'üîÅ Construir una biblioteca',d:'Im√°genes reutilizables para tu comunicaci√≥n habitual'},
    {id:'series',t:'üå± Una serie continua',d:'Contenido continuo (redes, blog, evoluci√≥n en el tiempo)'}
  ],btn:'Continuar'},
  channels:{kicker:'Difusi√≥n',title:'¬øD√≥nde vivir√°n estas im√°genes?',sub:'M√°x 2',opts:[
    {id:'web',t:'Web'},{id:'social',t:'Redes sociales'},{id:'press',t:'Prensa / editorial'},{id:'print',t:'Impresi√≥n / display'}
  ],btn:'Continuar'},
  location:{kicker:'Log√≠stica',title:'¬øD√≥nde se realizar√° la sesi√≥n?',opts:[
    {id:'sitges',t:'üìç Sitges y alrededores',d:'Garraf, Vilanova, Cubelles‚Ä¶'},
    {id:'bcn',t:'üìç Barcelona',d:'Ciudad o alrededores'},
    {id:'cat',t:'üìç Otra parte de Catalu√±a',d:'Costa Brava, Tarragona, interior‚Ä¶'},
    {id:'other',t:'üìç Fuera de Catalu√±a',d:'A definir juntos'}
  ],btn:'Continuar'},
  timing:{kicker:'Planificaci√≥n',title:'¬øCu√°ndo necesitas las im√°genes?',opts:[
    {id:'fixed',t:'üìÖ Fecha fija',d:'Tengo una fecha l√≠mite precisa'},
    {id:'approx',t:'üìÜ Per√≠odo aproximado',d:'En las pr√≥ximas semanas o meses'},
    {id:'flex',t:'üåä Sin urgencia',d:'Lo decidimos juntos'}
  ],btn:'Continuar'},
  vibe:{kicker:'Direcci√≥n art√≠stica',title:'C√≥mo debo fotografiar',
    sub:'Ajusta los tres controles. Las fotos ilustran cada extremo ‚Äî no son clicables.',
    sliders:[
      {id:'calm',cat:'Energ√≠a',lo:'Calmo & contemplativo',hi:'Vivo & din√°mico',
        imgs:[{src:'https://images.unsplash.com/photo-1518709268805-4e9042af9f23?w=600',lbl:'Sereno'},
              {src:'https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=600',lbl:'Vivo'}]},
      {id:'present',cat:'Proximidad',lo:'Distancia & contexto',hi:'√çntimo & detalles',
        imgs:[{src:'https://images.unsplash.com/photo-1505373877841-8d25f7d46678?w=600',lbl:'Amplio'},
              {src:'https://images.unsplash.com/photo-1495195134817-aeb325a55b65?w=600',lbl:'Cercano'}]},
      {id:'rich',cat:'Est√©tica',lo:'Limpio & minimalista',hi:'Texturado & rico',
        imgs:[{src:'https://images.unsplash.com/photo-1484101403633-562f891dc89a?w=600',lbl:'Limpio'},
              {src:'https://images.unsplash.com/photo-1513151233558-d860c5398176?w=600',lbl:'Texturado'}]}
    ],btn:'Ver brief'},
  contact:{kicker:'√öltimo paso',title:'Tu direcci√≥n de email',sub:'Para enviarte este brief y empezar a hablar.',ph:'tu@email.com',btn:'Generar brief'},
  report:{loading:'Redactando tu brief‚Ä¶',loadSub:'La IA de Cloudflare analiza tus respuestas y compone tu brief personalizado.',
    ctaTitle:'El pr√≥ximo paso',ctaQuote:'‚Ä¶Y ahora sabes lo que una imagen significa para m√≠.',
    ctaText:'Hablemos de tu proyecto. Te preparo una propuesta personalizada ‚Äî enfoque, planificaci√≥n y presupuesto.',
    btnEmail:'Enviar brief a Marina',btnRdv:'Reservar una llamada',btnPdf:'Descargar PDF',btnRestart:'Nuevo brief'},
  emailSubj:'Brief fotogr√°fico',emailHi:'Hola Marina,',emailIntro:'Aqu√≠ est√° mi brief completado a trav√©s del cuestionario en l√≠nea.',emailSign:'Saludos,',
  restartConfirm:'¬øReiniciar el cuestionario?',
  pdfFilename:'marinaphoto-brief'
},
ca:{
  steps:['Intro','Nom','Projecte','Tipus','Prioritats','√ös','Canals','Lloc','Timing','Vibra','Contacte'],
  times:['3 min','2 min','2 min','2 min','1 min','1 min','1 min','1 min','30 seg','30 seg','20 seg'],
  back:'Enrere', maxTwo:'M√†xim 2 opcions', mustPick:'Si us plau, tria una opci√≥', emailErr:'Email inv√†lid',
  aiBadge:'Redactat per IA ¬∑ Cloudflare Workers AI',
  fallbackBadge:'Brief generat autom√†ticament',
  intro:{kicker:'Comencem',quote:'S√© el que una imatge significa per a tu‚Ä¶',title:'3 minuts per entendre el teu projecte.',sub:'Unes quantes preguntes simples. Transformo les teves respostes en un brief personalitzat que guia la nostra col¬∑laboraci√≥.',btn:'Comen√ßar'},
  name:{kicker:'Sobre tu',title:'El teu nom',ph:'ex. N√∫ria',btn:'Continuar'},
  project:{kicker:'El projecte',title:'Com s\'anomena el teu projecte?',sub:'Un nom, encara que sigui provisional.',ph:'ex. Hotel Can Ros / Celler Garraf',btn:'Continuar'},
  type:{kicker:'Naturalesa del projecte',title:'El teu projecte √©s sobretot‚Ä¶',opts:[
    {id:'place',t:'üè† Un lloc per sentir',d:'Hotel, restaurant, arquitectura. Llum, espai, atmosfera.'},
    {id:'story',t:'üìñ Una hist√≤ria per explicar',d:'Artes√†, marca, projecte. Persones, gestos, context.'},
    {id:'moment',t:'‚è≥ Un moment per guardar',d:'Fam√≠lia, parella, esdeveniment. L\'instant, l\'emoci√≥, la vida.'}
  ],btn:'Continuar'},
  priorities:{kicker:'L\'efecte desitjat',title:'El que vols transmetre',sub:'1 o 2 prioritats',opts:[
    {id:'auth',t:'Autenticitat',d:'Real, present, no artificial'},
    {id:'brand',t:'Coher√®ncia',d:'Alineat amb la teva identitat visual'},
    {id:'singular',t:'Singularitat',d:'Una mirada reconeixible, res gen√®ric'},
    {id:'trust',t:'Credibilitat',d:'Professional, hum√†, que inspira confian√ßa'}
  ],btn:'Continuar'},
  usage:{kicker:'√ös',title:'Aquestes imatges serviran per a‚Ä¶',opts:[
    {id:'launch',t:'üìÜ Un llan√ßament / esdeveniment',d:'Obertura, campanya espec√≠fica, esdeveniment amb data l√≠mit'},
    {id:'base',t:'üîÅ Construir una biblioteca',d:'Imatges reutilitzables per a la teva comunicaci√≥ habitual'},
    {id:'series',t:'üå± Una s√®rie cont√≠nua',d:'Contingut continu (xarxes, blog, evoluci√≥ en el temps)'}
  ],btn:'Continuar'},
  channels:{kicker:'Difusi√≥',title:'On viuran aquestes imatges?',sub:'M√†x 2',opts:[
    {id:'web',t:'Web'},{id:'social',t:'Xarxes socials'},{id:'press',t:'Premsa / editorial'},{id:'print',t:'Impressi√≥ / cartelleria'}
  ],btn:'Continuar'},
  location:{kicker:'Log√≠stica',title:'On es far√† la sessi√≥?',opts:[
    {id:'sitges',t:'üìç Sitges i rodalia',d:'Garraf, Vilanova, Cubelles‚Ä¶'},
    {id:'bcn',t:'üìç Barcelona',d:'Ciutat o voltants'},
    {id:'cat',t:'üìç Altra part de Catalunya',d:'Costa Brava, Tarragona, interior‚Ä¶'},
    {id:'other',t:'üìç Fora de Catalunya',d:'A definir junts'}
  ],btn:'Continuar'},
  timing:{kicker:'Planificaci√≥',title:'Quan necessites les imatges?',opts:[
    {id:'fixed',t:'üìÖ Data fixada',d:'Tinc una data l√≠mit precisa'},
    {id:'approx',t:'üìÜ Per√≠ode aproximat',d:'En les properes setmanes o mesos'},
    {id:'flex',t:'üåä Sense urg√®ncia',d:'Ho decidim junts'}
  ],btn:'Continuar'},
  vibe:{kicker:'Direcci√≥ art√≠stica',title:'Com he de fotografiar',
    sub:'Ajusta els tres controls. Les fotos il¬∑lustren cada extrem ‚Äî no es poden clicar.',
    sliders:[
      {id:'calm',cat:'Energia',lo:'Calmat & contemplatiu',hi:'Viu & din√†mic',
        imgs:[{src:'https://images.unsplash.com/photo-1518709268805-4e9042af9f23?w=600',lbl:'Ser√®'},
              {src:'https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=600',lbl:'Viu'}]},
      {id:'present',cat:'Proximitat',lo:'Dist√†ncia & context',hi:'√çntim & detalls',
        imgs:[{src:'https://images.unsplash.com/photo-1505373877841-8d25f7d46678?w=600',lbl:'Ampli'},
              {src:'https://images.unsplash.com/photo-1495195134817-aeb325a55b65?w=600',lbl:'Proper'}]},
      {id:'rich',cat:'Est√®tica',lo:'Net & minimalista',hi:'Texturat & ric',
        imgs:[{src:'https://images.unsplash.com/photo-1484101403633-562f891dc89a?w=600',lbl:'Net'},
              {src:'https://images.unsplash.com/photo-1513151233558-d860c5398176?w=600',lbl:'Texturat'}]}
    ],btn:'Veure brief'},
  contact:{kicker:'Darrer pas',title:'El teu email',sub:'Per enviar-te aquest brief i comen√ßar a parlar.',ph:'tu@email.cat',btn:'Generar brief'},
  report:{loading:'Redactant el teu brief‚Ä¶',loadSub:'La IA de Cloudflare analitza les teves respostes i compon el teu brief personalitzat.',
    ctaTitle:'El proper pas',ctaQuote:'‚Ä¶I ara saps el que una imatge significa per a mi.',
    ctaText:'Parlem del teu projecte. Et preparo una proposta personalitzada ‚Äî enfocament, planificaci√≥ i pressupost.',
    btnEmail:'Enviar brief a Marina',btnRdv:'Reservar una trucada',btnPdf:'Descarregar PDF',btnRestart:'Nou brief'},
  emailSubj:'Brief fotogr√†fic',emailHi:'Hola Marina,',emailIntro:'Aqu√≠ tens el meu brief completat a trav√©s del q√ºestionari en l√≠nia.',emailSign:'Cordialment,',
  restartConfirm:'Reiniciar el q√ºestionari?',
  pdfFilename:'marinaphoto-brief'
}
};

const t = k => { let r=TX[L]; for(const p of k.split('.')) r=r[p]; return r; };

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROGRESS + NAV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function upProg(){
  document.getElementById('pbar').style.width=((step+1)/TOTAL*100)+'%';
  document.getElementById('pstep').textContent=(step+1)+'/'+TOTAL+' ¬∑ '+t('steps')[step];
  document.getElementById('ptime').textContent='~'+t('times')[step];
}
function setLang(l){
  L=l;
  ['fr','en','es','ca'].forEach(x=>document.getElementById('l-'+x).classList.remove('on'));
  document.getElementById('l-'+l).classList.add('on');
  go();
}
function fwd(){if(step<TOTAL-1){step++;go();}}
function bck(){if(step>0){step--;go();}}
function go(){
  upProg();
  const c=document.getElementById('card');
  c.style.cssText='opacity:0;transform:translateY(10px);transition:none;';
  setTimeout(()=>{
    draw();
    c.style.cssText='opacity:1;transform:translateY(0);transition:all .35s ease;';
    window.scrollTo({top:0,behavior:'smooth'});
  },60);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DRAW STEPS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function draw(){
  const c=document.getElementById('card');
  const fns=[drawIntro,drawName,drawProject,drawType,drawPriorities,
              drawUsage,drawChannels,drawLocation,drawTiming,drawVibe,drawContact];
  if(fns[step]) c.innerHTML=fns[step]();
  bindOpts();
  initSliders();
}

const BK = ()=>`<button class="bs" onclick="bck()">‚Üê ${t('back')}</button>`;

function drawIntro(){
  return `<div class="kicker">${t('intro.kicker')}</div>
  <div class="opening-quote">"${t('intro.quote')}"</div>
  <h1>${t('intro.title')}</h1>
  <p class="sub">${t('intro.sub')}</p>
  <div class="btns"><button class="bp" onclick="fwd()">${t('intro.btn')}</button></div>`;
}
function drawName(){
  return `<div class="kicker">${t('name.kicker')}</div>
  <h1>${t('name.title')}</h1>
  <input type="text" id="f-name" value="${esc(S.name)}" placeholder="${t('name.ph')}">
  <div class="btns"><button class="bp" onclick="svName()">${t('name.btn')}</button>${BK()}</div>`;
}
function drawProject(){
  return `<div class="kicker">${t('project.kicker')}</div>
  <h1>${t('project.title')}</h1><p class="sub">${t('project.sub')}</p>
  <input type="text" id="f-proj" value="${esc(S.project)}" placeholder="${t('project.ph')}">
  <div class="btns"><button class="bp" onclick="svProject()">${t('project.btn')}</button>${BK()}</div>`;
}
function drawOpts(key, field, multi, stateRef){
  const opts=t(key+'.opts');
  return `<div class="kicker">${t(key+'.kicker')}</div>
  <h1>${t(key+'.title')}</h1>
  ${t(key+'.sub') ? `<p class="sub">${t(key+'.sub')}</p>` : ''}
  <div class="opts">${opts.map(o=>`
    <div class="opt${(multi?stateRef.includes(o.id):stateRef===o.id)?' sel':''}" data-id="${o.id}" data-field="${field}" data-multi="${multi}">
      <div class="opt-t">${o.t}</div>${o.d?`<div class="opt-d">${o.d}</div>`:''}
    </div>`).join('')}
  </div>
  <div class="btns">
    <button class="bp" onclick="${multi?`valMulti('${field}',2)`:`valSingle('${field}')`}">${t(key+'.btn')}</button>
    ${BK()}
  </div>`;
}
function drawType(){return drawOpts('type','type',false,S.type);}
function drawPriorities(){return drawOpts('priorities','priorities',true,S.priorities);}
function drawUsage(){return drawOpts('usage','usage',false,S.usage);}
function drawChannels(){return drawOpts('channels','channels',true,S.channels);}
function drawLocation(){return drawOpts('location','location',false,S.location);}
function drawTiming(){return drawOpts('timing','timing',false,S.timing);}

function drawVibe(){
  const sls=t('vibe.sliders');
  return `<div class="kicker">${t('vibe.kicker')}</div>
  <h1>${t('vibe.title')}</h1>
  <p class="sub">${t('vibe.sub')}</p>
  ${sls.map(sl=>`
  <div class="vibe-block">
    <div class="vibe-cat">${sl.cat}</div>
    <div class="vibe-label-row"><span>${sl.lo}</span><span>${sl.hi}</span></div>
    <input type="range" min="0" max="100" value="${S[sl.id]}" data-key="${sl.id}"
      style="--p:${S[sl.id]}%"
      oninput="S['${sl.id}']=+this.value;this.style.setProperty('--p',this.value+'%')">
    <div class="vibe-illus">
      ${sl.imgs.map(img=>`
      <div class="vibe-img">
        <img src="${img.src}" alt="${img.lbl}" loading="lazy">
        <div class="vibe-img-lbl">${img.lbl}</div>
      </div>`).join('')}
    </div>
  </div>`).join('')}
  <div class="btns"><button class="bp" onclick="fwd()">${t('vibe.btn')}</button>${BK()}</div>`;
}

function drawContact(){
  return `<div class="kicker">${t('contact.kicker')}</div>
  <h1>${t('contact.title')}</h1>
  <p class="sub">${t('contact.sub')}</p>
  <input type="email" id="f-email" value="${esc(S.email)}" placeholder="${t('contact.ph')}">
  <div class="btns"><button class="bp" onclick="svEmail()">${t('contact.btn')}</button>${BK()}</div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EVENT BINDING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function bindOpts(){
  document.querySelectorAll('.opt[data-field]').forEach(el=>{
    el.addEventListener('click',()=>{
      const id=el.dataset.id, field=el.dataset.field, multi=el.dataset.multi==='true';
      if(multi){
        if(el.classList.contains('sel')){
          S[field]=S[field].filter(x=>x!==id);
          el.classList.remove('sel');
        } else {
          if(S[field].length>=2){alert(t('maxTwo'));return;}
          S[field].push(id);
          el.classList.add('sel');
        }
      } else {
        document.querySelectorAll(`.opt[data-field="${field}"]`).forEach(x=>x.classList.remove('sel'));
        S[field]=id;
        el.classList.add('sel');
      }
    });
  });
}
function initSliders(){
  document.querySelectorAll('input[type=range]').forEach(el=>{
    el.style.setProperty('--p',el.value+'%');
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SAVE / VALIDATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const esc=s=>(s||'').replace(/"/g,'&quot;');
function svName(){S.name=document.getElementById('f-name').value.trim();fwd();}
function svProject(){S.project=document.getElementById('f-proj').value.trim();fwd();}
function valSingle(f){if(!S[f]){alert(t('mustPick'));return;}fwd();}
function valMulti(f,max){if(!S[f].length){alert(t('mustPick'));return;}fwd();}
function svEmail(){
  const v=document.getElementById('f-email').value.trim();
  if(!v||!v.includes('@')||!v.includes('.')){alert(t('emailErr'));return;}
  S.email=v;
  showReport();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BUILD AI PROMPT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildPrompt(){
  const inferSector=(name)=>{
    const n=(name||'').toLowerCase();
    if(/hotel|hostal|apart|boutique.*hotel|casa.*rural|mas\b|can\s/i.test(n)) return 'h√¥tellerie';
    if(/beach.*club|club.*playa|platja|chiringuito/i.test(n)) return 'club de plage';
    if(/restaura|gastro|cuina|cocina|kitchen|bistro|tavern/i.test(n)) return 'restaurant';
    if(/bode?ga|celler|vi[n√±]|wine|vi\b/i.test(n)) return 'vignoble';
    if(/caf[e√©]|coffee|barista/i.test(n)) return 'caf√©';
    if(/bar\b|tapas|vermut/i.test(n)) return 'bar';
    if(/dent|odonto/i.test(n)) return 'cabinet dentaire';
    if(/m[e√©]dic|clinic|doctor|salud|health/i.test(n)) return 'm√©dical';
    if(/est[e√©]tic|beauty|spa|wellness/i.test(n)) return 'esth√©tique & spa';
    if(/fisio|physio/i.test(n)) return 'physioth√©rapie';
    if(/yoga|pilates|fitness|gym/i.test(n)) return 'fitness';
    if(/inmobil|real.*estate|propied/i.test(n)) return 'immobilier';
    if(/architect|arquitec/i.test(n)) return 'architecture';
    if(/construc|obra|reform/i.test(n)) return 'construction';
    if(/taller|atelier|artesa|craft/i.test(n)) return 'artisanat';
    if(/botiga|tienda|shop|store|boutique/i.test(n)) return 'commerce';
    if(/florist|flor/i.test(n)) return 'fleuriste';
    if(/design|gr√†fic|graphic/i.test(n)) return 'design';
    if(/galer[i√≠]|art.*space/i.test(n)) return 'galerie';
    if(/wedding|boda|casament/i.test(n)) return 'mariage';
    if(/event|celebra|festes/i.test(n)) return '√©v√©nementiel';
    if(/formaci[o√≥]|training|cours/i.test(n)) return 'formation';
    if(/fiduci|asesor|consult|gestori/i.test(n)) return 'services professionnels';
    if(/indust|f[a√†]bric/i.test(n)) return 'industrie';
    return null;
  };

  const sector = inferSector(S.project);
  const c=S.calm, p=S.present, r=S.rich;

  const TYPE_L={fr:{place:'lieu √† faire ressentir',story:'histoire de marque',moment:'moment √† capturer'},en:{place:'place to convey',story:'brand story',moment:'moment to capture'},es:{place:'lugar para sentir',story:'historia de marca',moment:'momento a capturar'},ca:{place:'lloc per sentir',story:'hist√≤ria de marca',moment:'moment a capturar'}};
  const PRIO_L={fr:{auth:'authenticit√©',brand:'coh√©rence',singular:'singularit√©',trust:'cr√©dibilit√©'},en:{auth:'authenticity',brand:'coherence',singular:'singularity',trust:'credibility'},es:{auth:'autenticidad',brand:'coherencia',singular:'singularidad',trust:'credibilidad'},ca:{auth:'autenticitat',brand:'coher√®ncia',singular:'singularitat',trust:'credibilitat'}};
  const CHAN_L={fr:{web:'site web',social:'r√©seaux sociaux',press:'presse',print:'print'},en:{web:'website',social:'social media',press:'press',print:'print'},es:{web:'web',social:'redes sociales',press:'prensa',print:'impresi√≥n'},ca:{web:'web',social:'xarxes socials',press:'premsa',print:'impressi√≥'}};
  const LOC_L={fr:{sitges:'Sitges et environs (Garraf, Vilanova...)',bcn:'Barcelone',cat:'Catalogne',other:'en dehors de Catalogne'},en:{sitges:'Sitges area (Garraf, Vilanova...)',bcn:'Barcelona',cat:'Catalonia',other:'outside Catalonia'},es:{sitges:'Sitges y alrededores (Garraf, Vilanova...)',bcn:'Barcelona',cat:'Catalu√±a',other:'fuera de Catalu√±a'},ca:{sitges:'Sitges i rodal (Garraf, Vilanova...)',bcn:'Barcelona',cat:'Catalunya',other:'fora de Catalunya'}};
  const TIM_L={fr:{fixed:'avec une date pr√©cise',approx:'dans les prochains mois',flex:'flexible, sans urgence'},en:{fixed:'with a specific date',approx:'within the next few months',flex:'flexible, no rush'},es:{fixed:'con fecha precisa',approx:'en los pr√≥ximos meses',flex:'flexible, sin urgencia'},ca:{fixed:'amb data precisa',approx:'en els propers mesos',flex:'flexible, sense urg√®ncia'}};

  const tl = S.type && TYPE_L[L] ? (TYPE_L[L][S.type]||'') : '';
  const prios = S.priorities.map(x=>PRIO_L[L]?.[x]).filter(Boolean);
  const chans = S.channels.map(x=>CHAN_L[L]?.[x]).filter(Boolean);
  const locStr = LOC_L[L]?.[S.location] || '';
  const timStr = TIM_L[L]?.[S.timing] || '';

  const calmDesc = c<35 ? (L==='fr'?'tr√®s calme et contemplatif':L==='es'?'muy calmo y contemplativo':L==='ca'?'molt calmat i contemplatiu':'very calm and contemplative') : c>65 ? (L==='fr'?'vivant et dynamique, plein d\'√©nergie':L==='es'?'vivo y din√°mico, lleno de energ√≠a':L==='ca'?'viu i din√†mic, ple d\'energia':'lively and dynamic, full of energy') : (L==='fr'?'√©quilibr√© entre calme et dynamisme':L==='es'?'equilibrado entre calma y dinamismo':L==='ca'?'equilibrat entre calma i dinamisme':'balanced between calm and dynamic');
  const preDesc = p<35 ? (L==='fr'?'avec des vues larges qui donnent du contexte':L==='es'?'con vistas amplias que dan contexto':L==='ca'?'amb vistes √†mplies que donen context':'with wide views providing context') : p>65 ? (L==='fr'?'intime et proche, valorisant les d√©tails et les textures':L==='es'?'√≠ntimo y cercano, valorando detalles y texturas':L==='ca'?'√≠ntim i proper, valorant detalls i textures':'intimate and close, highlighting details and textures') : (L==='fr'?'mixte entre vues d\'ensemble et d√©tails':L==='es'?'mixto entre vistas generales y detalles':L==='ca'?'mixt entre vistes generals i detalls':'a mix of wide shots and close details');
  const richDesc = r<35 ? (L==='fr'?'√©pur√© et minimaliste, beaucoup d\'espace et de lumi√®re':L==='es'?'limpio y minimalista, mucho espacio y luz':L==='ca'?'net i minimalista, molt espai i llum':'clean and minimalist, lots of space and light') : r>65 ? (L==='fr'?'riche en textures et en mati√®res, atmosph√®res denses':L==='es'?'rico en texturas y materiales, atm√≥sferas densas':L==='ca'?'ric en textures i materials, atmosferes denses':'rich in textures and materials, dense atmospheres') : (L==='fr'?'√©quilibr√© entre √©pur√© et richesse visuelle':L==='es'?'equilibrado entre limpieza y riqueza visual':L==='ca'?'equilibrat entre neteja i riquesa visual':'balanced between clean and visually rich');

  // Usage lisible
  const usageMap = {
    fr: {launch:'un lancement ou √©v√©nement avec date butoir',base:'constituer une banque d\'images durables',series:'alimenter un flux de contenu r√©gulier'},
    en: {launch:'a launch or event with a deadline',base:'building a lasting image bank',series:'feeding a regular content flow'},
    es: {launch:'un lanzamiento o evento con fecha l√≠mite',base:'crear un banco de im√°genes duraderas',series:'alimentar un flujo de contenido regular'},
    ca: {launch:'un llan√ßament o esdeveniment amb data l√≠mit',base:'crear un banc d\'imatges duradores',series:'alimentar un flux de contingut regular'}
  };
  const usageText = (usageMap[L]||usageMap.en)[S.usage] || '';

  const prompts = {
    fr: `Voici ce que ${S.name||'le client'} a r√©pondu sur son projet.

Projet : "${S.project||'sans titre'}"${sector ? ' ‚Äî secteur d√©tect√© : '+sector : ''}
Nature : ${tl}
Objectif : ${usageText}
O√π ces images vivront : ${chans.join(', ')||'web'}
Lieu : ${locStr||'√† confirmer'}
Planning : ${timStr||'flexible'}
Ce qui compte le plus pour lui : ${prios.join(', ')||'authenticit√©'}

Ses pr√©f√©rences visuelles r√©v√®lent : une esth√©tique ${richDesc}, un rythme ${calmDesc}, et une approche ${preDesc}.`,

    en: `Here is what ${S.name||'the client'} answered about their project.

Project: "${S.project||'untitled'}"${sector ? ' ‚Äî detected sector: '+sector : ''}
Type: ${tl}
Goal: ${usageText}
Where these images will live: ${chans.join(', ')||'web'}
Location: ${locStr||'to confirm'}
Timeline: ${timStr||'flexible'}
What matters most: ${prios.join(', ')||'authenticity'}

Their visual preferences reveal: ${richDesc} aesthetic, ${calmDesc} energy, ${preDesc} framing.`,

    es: `Esto es lo que ${S.name||'el cliente'} respondi√≥ sobre su proyecto.

Proyecto: "${S.project||'sin t√≠tulo'}"${sector ? ' ‚Äî sector detectado: '+sector : ''}
Tipo: ${tl}
Objetivo: ${usageText}
D√≥nde vivir√°n estas im√°genes: ${chans.join(', ')||'web'}
Lugar: ${locStr||'a confirmar'}
Planificaci√≥n: ${timStr||'flexible'}
Lo m√°s importante: ${prios.join(', ')||'autenticidad'}

Sus preferencias visuales revelan: est√©tica ${richDesc}, ritmo ${calmDesc}, enfoque ${preDesc}.`,

    ca: `Aqu√≠ el que ${S.name||'el client'} ha respost sobre el seu projecte.

Projecte: "${S.project||'sense t√≠tol'}"${sector ? ' ‚Äî sector detectat: '+sector : ''}
Tipus: ${tl}
Objectiu: ${usageText}
On viuran aquestes imatges: ${chans.join(', ')||'web'}
Lloc: ${locStr||'a confirmar'}
Planificaci√≥: ${timStr||'flexible'}
El m√©s important: ${prios.join(', ')||'autenticitat'}

Les seves prefer√®ncies visuals revelen: est√®tica ${richDesc}, ritme ${calmDesc}, enfocament ${preDesc}.`
  };
  return prompts[L] || prompts.en;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GENERATE BRIEF WITH CLOUDFLARE AI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function generateBriefWithAI(){
  const prompt = buildPrompt();

  const response = await fetch('/api/generate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ text: prompt })
  });

  if(!response.ok){
    const errText = await response.text();
    throw new Error(`HTTP ${response.status}: ${errText}`);
  }

  const data = await response.json();

  if(data && data.error){
    throw new Error(`Worker error: ${data.error}`);
  }

  const text = (data?.result || '').trim();

  if(text.length < 80){
    throw new Error(`Response too short (${text.length} chars)`);
  }

  S.briefSource = 'ai';
  return text;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SHOW REPORT ‚Äî calls AI then renders
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showReport(){
  step=10; upProg();
  const c=document.getElementById('card');
  c.innerHTML=`<div class="loading">
    <div class="spinner"></div>
    <h2>${t('report.loading')}</h2>
    <p>${t('report.loadSub')}</p>
  </div>`;

  generateBriefWithAI()
    .then(brief=>{
      S.briefText=brief;
      S.briefSource='ai';
      renderReport(brief);
    })
    .catch(err=>{
      console.warn('Cloudflare AI failed, using fallback:', err);
      const brief=fallback();
      S.briefText=brief;
      S.briefSource='fallback';
      renderReport(brief);
    });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER REPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderReport(txt){
  const c=document.getElementById('card');
  const proj=S.project||(L==='fr'?'Votre projet':L==='es'?'Tu proyecto':L==='ca'?'El teu projecte':'Your project');
  const locale={fr:'fr-FR',en:'en-GB',es:'es-ES',ca:'ca-ES'}[L]||'en-GB';
  const date=new Date().toLocaleDateString(locale,{day:'numeric',month:'long',year:'numeric'});
  const paras=txt.split('\n\n').filter(p=>p.trim()).map(p=>`<p>${p.trim().replace(/\n/g,'<br>')}</p>`).join('');
  const badgeLabel = S.briefSource==='ai' ? t('aiBadge') : t('fallbackBadge');

  c.innerHTML=`
    <div class="rpt-hero">
      <h1>${proj}</h1>
      ${S.name?`<div class="client">${S.name}</div>`:''}
      <div class="rdate">${date}</div>
    </div>
    <div class="ai-badge">${badgeLabel}</div>
    <div class="rpt-body">${paras}</div>
    <div class="rpt-cta">
      <h2>${t('report.ctaTitle')}</h2>
      <div class="closing-q">"${t('report.ctaQuote')}"</div>
      <p>${t('report.ctaText')}</p>
      <div class="cta-btns">
        <button class="bp" onclick="doEmail().catch(e=>console.error('Email error:',e))">${t('report.btnEmail')}</button>
        <button class="bs" onclick="doRdv()">${t('report.btnRdv')}</button>
        <button class="bs" onclick="doPDF()">${t('report.btnPdf')}</button>
        <button class="bs" onclick="doRestart()">${t('report.btnRestart')}</button>
      </div>
    </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FALLBACK ‚Äî rich text generation without AI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function fallback(){
  const proj=S.project||'';
  const c=S.calm, p=S.present, r=S.rich;

  const inferSector=(name)=>{
    const n=(name||'').toLowerCase();
    if(/hotel|hostal|apart|boutique.*hotel|casa.*rural|mas\b|can\s/i.test(n)) return 'hotel';
    if(/beach.*club|club.*playa|platja|chiringuito/i.test(n)) return 'beach-club';
    if(/restaura|gastro|cuina|cocina|kitchen|bistro|tavern/i.test(n)) return 'restaurant';
    if(/bode?ga|celler|vi[n√±]|wine|vi\b/i.test(n)) return 'wine';
    if(/caf[e√©]|coffee|barista/i.test(n)) return 'cafe';
    if(/bar\b|tapas|vermut/i.test(n)) return 'bar';
    if(/dent|odonto/i.test(n)) return 'dental';
    if(/m[e√©]dic|clinic|doctor|salud|health/i.test(n)) return 'medical';
    if(/est[e√©]tic|beauty|spa|wellness/i.test(n)) return 'beauty';
    if(/fisio|physio/i.test(n)) return 'physio';
    if(/yoga|pilates|fitness|gym/i.test(n)) return 'fitness';
    if(/inmobil|real.*estate|propied/i.test(n)) return 'realestate';
    if(/architect|arquitec/i.test(n)) return 'architecture';
    if(/taller|atelier|artesa|craft/i.test(n)) return 'craft';
    if(/botiga|tienda|shop|store|boutique/i.test(n)) return 'retail';
    if(/florist|flor/i.test(n)) return 'florist';
    if(/design|gr√†fic|graphic/i.test(n)) return 'design';
    if(/galer[i√≠]|art.*space/i.test(n)) return 'gallery';
    if(/wedding|boda|casament/i.test(n)) return 'wedding';
    if(/event|celebra|festes/i.test(n)) return 'events';
    return null;
  };
  const sector=inferSector(proj);

  const TYPE_L={fr:{place:'un lieu',story:'une histoire de marque',moment:'un moment de vie'},en:{place:'a place',story:'a brand story',moment:'a life moment'},es:{place:'un lugar',story:'una historia de marca',moment:'un momento de vida'},ca:{place:'un lloc',story:'una hist√≤ria de marca',moment:'un moment de vida'}};
  const PRIO_L={fr:{auth:'authenticit√©',brand:'coh√©rence',singular:'singularit√©',trust:'cr√©dibilit√©'},en:{auth:'authenticity',brand:'coherence',singular:'singularity',trust:'credibility'},es:{auth:'autenticidad',brand:'coherencia',singular:'singularidad',trust:'credibilidad'},ca:{auth:'autenticitat',brand:'coher√®ncia',singular:'singularitat',trust:'credibilitat'}};
  const CHAN_L={fr:{web:'site web',social:'r√©seaux sociaux',press:'presse',print:'print'},en:{web:'website',social:'social media',press:'press',print:'print'},es:{web:'web',social:'redes sociales',press:'prensa',print:'impresi√≥n'},ca:{web:'web',social:'xarxes socials',press:'premsa',print:'impressi√≥'}};
  const LOC_L={fr:{sitges:'Sitges et environs',bcn:'Barcelone',cat:'Catalogne',other:'en dehors de la Catalogne'},en:{sitges:'Sitges area',bcn:'Barcelona',cat:'Catalonia',other:'outside Catalonia'},es:{sitges:'Sitges y alrededores',bcn:'Barcelona',cat:'Catalu√±a',other:'fuera de Catalu√±a'},ca:{sitges:'Sitges i rodal',bcn:'Barcelona',cat:'Catalunya',other:'fora de Catalunya'}};
  const TIM_L={fr:{fixed:'avec une date pr√©cise',approx:'dans les prochains mois',flex:'sans urgence'},en:{fixed:'with a specific date',approx:'within the next few months',flex:'no rush'},es:{fixed:'con fecha precisa',approx:'en los pr√≥ximos meses',flex:'sin prisa'},ca:{fixed:'amb data precisa',approx:'en els propers mesos',flex:'sense pressa'}};

  const tl=S.type&&TYPE_L[L]?.[S.type]||'';
  const prios=S.priorities.map(x=>PRIO_L[L]?.[x]).filter(Boolean);
  const chans=S.channels.map(x=>CHAN_L[L]?.[x]).filter(Boolean);
  const locStr=LOC_L[L]?.[S.location]||'';
  const timStr=TIM_L[L]?.[S.timing]||'';
  const sep={fr:' et ',en:' and ',es:' y ',ca:' i '}[L];

  const SECTOR_NAMES={
    fr:{hotel:'h√¥tellerie','beach-club':'club de plage',restaurant:'restaurant',wine:'vignoble',cafe:'caf√©',bar:'bar',dental:'cabinet dentaire',medical:'m√©dical',beauty:'esth√©tique & spa',physio:'physioth√©rapie',fitness:'fitness',realestate:'immobilier',architecture:'architecture',craft:'artisanat',retail:'commerce',florist:'fleuriste',design:'design',gallery:'galerie d\'art',events:'√©v√©nementiel',wedding:'mariage'},
    en:{hotel:'hospitality','beach-club':'beach club',restaurant:'gastronomy',wine:'winery',cafe:'caf√©',bar:'bar',dental:'dental clinic',medical:'medical',beauty:'beauty & spa',physio:'physiotherapy',fitness:'fitness',realestate:'real estate',architecture:'architecture',craft:'craft',retail:'retail',florist:'florist',design:'design',gallery:'art gallery',events:'events',wedding:'wedding'},
    es:{hotel:'hosteler√≠a','beach-club':'club de playa',restaurant:'gastronom√≠a',wine:'vi√±edo',cafe:'caf√©',bar:'bar',dental:'cl√≠nica dental',medical:'m√©dico',beauty:'est√©tica & spa',physio:'fisioterapia',fitness:'fitness',realestate:'inmobiliaria',architecture:'arquitectura',craft:'artesan√≠a',retail:'comercio',florist:'florister√≠a',design:'dise√±o',gallery:'galer√≠a de arte',events:'eventos',wedding:'boda'},
    ca:{hotel:'hostaleria','beach-club':'club de platja',restaurant:'gastronomia',wine:'vinya',cafe:'caf√®',bar:'bar',dental:'cl√≠nica dental',medical:'m√®dic',beauty:'est√®tica & spa',physio:'fisioter√†pia',fitness:'fitness',realestate:'immobili√†ria',architecture:'arquitectura',craft:'artesania',retail:'comer√ß',florist:'floristeria',design:'disseny',gallery:'galeria d\'art',events:'esdeveniments',wedding:'casament'}
  };
  const sectorName=sector&&SECTOR_NAMES[L]?.[sector]||'';

  const VIBE={
    fr:{
      calm:[['des images pos√©es, contemplatives','un rythme calme qui laisse respirer'],['un √©quilibre entre calme et √©nergie','du mouvement sans agitation'],['de l\'√©nergie et du mouvement','des images vivantes, pleines de vie']],
      present:[['des vues larges qui donnent du contexte','de la profondeur, de l\'espace'],['un √©quilibre entre vues d\'ensemble et d√©tails','alterner les angles'],['de la proximit√© et de l\'intimit√©','les textures, les d√©tails, les gestes de pr√®s']],
      rich:[['une esth√©tique √©pur√©e','des cadrages nets, de l\'espace, de la lumi√®re'],['un √©quilibre entre sobri√©t√© et pr√©sence visuelle','propre sans √™tre vide'],['des images riches en textures','des atmosph√®res denses et sensuelles']]
    },
    en:{
      calm:[['still, contemplative images','a calm rhythm that lets images breathe'],['a balance of calm and energy','movement without agitation'],['energy and movement','lively images full of life']],
      present:[['wide shots giving context','depth and space'],['a mix of wide and close shots','alternating perspectives'],['intimacy and proximity','textures, details, gestures up close']],
      rich:[['a clean aesthetic','sharp framing, space and light'],['a balance of restraint and visual presence','clean but not empty'],['rich textured images','dense, sensorial atmospheres']]
    },
    es:{
      calm:[['im√°genes serenas y contemplativas','un ritmo calmo que deja respirar'],['un equilibrio entre calma y energ√≠a','movimiento sin agitaci√≥n'],['energ√≠a y movimiento','im√°genes vivas y llenas de vida']],
      present:[['vistas amplias que dan contexto','profundidad y espacio'],['un mix de vistas generales y detalles','alternar perspectivas'],['intimidad y proximidad','texturas, detalles, gestos de cerca']],
      rich:[['est√©tica limpia','encuadres netos, espacio y luz'],['equilibrio entre sobriedad y presencia visual','limpio pero no vac√≠o'],['im√°genes ricas en texturas','atm√≥sferas densas y sensoriales']]
    },
    ca:{
      calm:[['imatges serenes i contemplatives','un ritme calmat que deixa respirar'],['un equilibri entre calma i energia','moviment sense agitaci√≥'],['energia i moviment','imatges vives i plenes de vida']],
      present:[['vistes √†mplies que donen context','profunditat i espai'],['un mix de vistes generals i detalls','alternar perspectives'],['intimitat i proximitat','textures, detalls, gestos de prop']],
      rich:[['est√®tica neta','enquadraments nets, espai i llum'],['equilibri entre sobrietat i pres√®ncia visual','net per√≤ no buit'],['imatges riques en textures','atmosferes denses i sensorials']]
    }
  };

  const vi=c<35?0:c>65?2:1;
  const vp=p<35?0:p>65?2:1;
  const vr=r<35?0:r>65?2:1;
  const vC=VIBE[L]?.calm?.[vi]||['',''];
  const vP=VIBE[L]?.present?.[vp]||['',''];
  const vR=VIBE[L]?.rich?.[vr]||['',''];

  const INTRO={
    fr:`${sectorName?`Je vois que ${proj||'votre projet'} est dans le secteur ${sectorName} ‚Äî `:proj?`${proj} ‚Äî `:''}${S.name?`${S.name}, votre projet `:'Ce projet '}porte sur ${tl}, destin√© ${chans.length?'√† '+chans.join(sep):'√† vos supports de communication'}. ${prios.length?'Les priorit√©s visuelles que vous avez identifi√©es ‚Äî '+prios.join(sep)+' ‚Äî seront au c≈ìur de mon approche.':'L\'authenticit√© et la singularit√© guideront mon regard.'}`,
    en:`${sectorName?`I can see that ${proj||'your project'} is in the ${sectorName} sector ‚Äî `:proj?`${proj} ‚Äî `:''}${S.name?`${S.name}, your project `:'This project '}is about ${tl}, for ${chans.length?chans.join(sep):'your communication channels'}. ${prios.length?'The visual priorities you\'ve identified ‚Äî '+prios.join(sep)+' ‚Äî will be at the heart of my approach.':'Authenticity and singularity will guide my eye.'}`,
    es:`${sectorName?`Veo que ${proj||'tu proyecto'} est√° en el sector ${sectorName} ‚Äî `:proj?`${proj} ‚Äî `:''}${S.name?`${S.name}, tu proyecto `:'Este proyecto '}es sobre ${tl}, destinado ${chans.length?'a '+chans.join(sep):'a tus soportes de comunicaci√≥n'}. ${prios.length?'Las prioridades visuales que has identificado ‚Äî '+prios.join(sep)+' ‚Äî estar√°n en el centro de mi enfoque.':'La autenticidad y la singularidad guiar√°n mi mirada.'}`,
    ca:`${sectorName?`Veig que ${proj||'el teu projecte'} √©s al sector ${sectorName} ‚Äî `:proj?`${proj} ‚Äî `:''}${S.name?`${S.name}, el teu projecte `:'Aquest projecte '}√©s sobre ${tl}, destinat ${chans.length?'a '+chans.join(sep):'als teus suports de comunicaci√≥'}. ${prios.length?'Les prioritats visuals que has identificat ‚Äî '+prios.join(sep)+' ‚Äî seran al cor del meu enfocament.':'L\'autenticitat i la singularitat guiaran la meva mirada.'}`
  };

  const DIRECTION={
    fr:`Mon approche : ${vC[0]}, ${vP[0]}. ${vR[0].charAt(0).toUpperCase()+vR[0].slice(1)}, ${vR[1]}. ${vC[1].charAt(0).toUpperCase()+vC[1].slice(1)}, avec ${vP[1]}.`,
    en:`My approach: ${vC[0]}, ${vP[0]}. ${vR[0].charAt(0).toUpperCase()+vR[0].slice(1)}, ${vR[1]}. ${vC[1].charAt(0).toUpperCase()+vC[1].slice(1)}, with ${vP[1]}.`,
    es:`Mi enfoque: ${vC[0]}, ${vP[0]}. ${vR[0].charAt(0).toUpperCase()+vR[0].slice(1)}, ${vR[1]}. ${vC[1].charAt(0).toUpperCase()+vC[1].slice(1)}, con ${vP[1]}.`,
    ca:`El meu enfocament: ${vC[0]}, ${vP[0]}. ${vR[0].charAt(0).toUpperCase()+vR[0].slice(1)}, ${vR[1]}. ${vC[1].charAt(0).toUpperCase()+vC[1].slice(1)}, amb ${vP[1]}.`
  };

  const LOGISTICS={
    fr:`Lieu : ${locStr||'√† d√©finir'}. Planning : ${timStr||'√† caler ensemble'}. ${S.name?S.name+', d':'D'}iscutons pour affiner ce brief et organiser la s√©ance. ${S.email?'Je vous contacte tr√®s vite !':'√Ä tr√®s bient√¥t !'}`,
    en:`Location: ${locStr||'to be defined'}. Timeline: ${timStr||'to plan together'}. ${S.name?S.name+', let\'s':'Let\'s'} talk to refine this brief and organise the shoot. ${S.email?'I\'ll be in touch soon!':'Talk soon!'}`,
    es:`Lugar: ${locStr||'a definir'}. Planificaci√≥n: ${timStr||'a decidir juntos'}. ${S.name?S.name+', h':'H'}ablemos para afinar este brief y organizar la sesi√≥n. ${S.email?'¬°Te contacto pronto!':'¬°Hasta pronto!'}`,
    ca:`Lloc: ${locStr||'a definir'}. Planificaci√≥: ${timStr||'a decidir junts'}. ${S.name?S.name+', p':'P'}arlem per afinar aquest brief i organitzar la sessi√≥. ${S.email?'Et contacto aviat!':'Fins aviat!'}`
  };

  return (INTRO[L]||INTRO.en)+'\n\n'+(DIRECTION[L]||DIRECTION.en)+'\n\n'+(LOGISTICS[L]||LOGISTICS.en);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ACTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function doEmail(){
  const NL='\n';
  const TYPE_L={fr:{place:'Lieu',story:'Narration / Marque',moment:'Moment'},en:{place:'Place',story:'Brand story',moment:'Moment'},es:{place:'Lugar',story:'Historia / Marca',moment:'Momento'},ca:{place:'Lloc',story:'Hist√≤ria / Marca',moment:'Moment'}};
  const PRIO_L={fr:{auth:'Authenticit√©',brand:'Coh√©rence',singular:'Singularit√©',trust:'Cr√©dibilit√©'},en:{auth:'Authenticity',brand:'Coherence',singular:'Singularity',trust:'Credibility'},es:{auth:'Autenticidad',brand:'Coherencia',singular:'Singularidad',trust:'Credibilidad'},ca:{auth:'Autenticitat',brand:'Coher√®ncia',singular:'Singularitat',trust:'Credibilitat'}};
  const CHAN_L={fr:{web:'Site web',social:'R√©seaux sociaux',press:'Presse',print:'Print'},en:{web:'Website',social:'Social media',press:'Press',print:'Print'},es:{web:'Web',social:'Redes sociales',press:'Prensa',print:'Print'},ca:{web:'Web',social:'Xarxes socials',press:'Premsa',print:'Print'}};
  const LOC_L={fr:{sitges:'Sitges et environs',bcn:'Barcelone',cat:'Catalogne',other:'Hors Catalogne'},en:{sitges:'Sitges area',bcn:'Barcelona',cat:'Catalonia',other:'Outside Catalonia'},es:{sitges:'Sitges y alrededores',bcn:'Barcelona',cat:'Catalu√±a',other:'Fuera de Catalu√±a'},ca:{sitges:'Sitges i rodal',bcn:'Barcelona',cat:'Catalunya',other:'Fora de Catalunya'}};
  const TIM_L={fr:{fixed:'Date fix√©e',approx:'P√©riode approximative',flex:'Flexible'},en:{fixed:'Fixed date',approx:'Approximate period',flex:'Flexible'},es:{fixed:'Fecha fija',approx:'Per√≠odo aproximado',flex:'Flexible'},ca:{fixed:'Data fixada',approx:'Per√≠ode aproximat',flex:'Flexible'}};
  const VIBE_L={fr:['Calme','√âquilibr√©','Vivant'],en:['Calm','Balanced','Lively'],es:['Calmo','Equilibrado','Vivo'],ca:['Calmat','Equilibrat','Viu']};
  const vibeWord=(val)=>val<35?VIBE_L[L][0]:val>65?VIBE_L[L][2]:VIBE_L[L][1];
  const FIELDS={fr:{proj:'Projet',type:'Type',prio:'Priorit√©s',usage:'Usage',chan:'Diffusion',loc:'Lieu',tim:'Planning',calm:'√ânergie',pres:'Proximit√©',rich:'Esth√©tique',email:'Email'},en:{proj:'Project',type:'Type',prio:'Priorities',usage:'Use',chan:'Distribution',loc:'Location',tim:'Timeline',calm:'Energy',pres:'Proximity',rich:'Aesthetic',email:'Email'},es:{proj:'Proyecto',type:'Tipo',prio:'Prioridades',usage:'Uso',chan:'Difusi√≥n',loc:'Lugar',tim:'Planificaci√≥n',calm:'Energ√≠a',pres:'Proximidad',rich:'Est√©tica',email:'Email'},ca:{proj:'Projecte',type:'Tipus',prio:'Prioritats',usage:'√ös',chan:'Difusi√≥',loc:'Lloc',tim:'Planificaci√≥',calm:'Energia',pres:'Proximitat',rich:'Est√®tica',email:'Email'}};
  const F=FIELDS[L]||FIELDS.en;
  const subj=t('emailSubj')+': '+(S.project||'‚Äî');
  const formBlock=[
    `${F.proj}: ${S.project||'‚Äî'}`,
    `${F.type}: ${TYPE_L[L]?.[S.type]||'‚Äî'}`,
    `${F.prio}: ${S.priorities.map(x=>PRIO_L[L]?.[x]).filter(Boolean).join(', ')||'‚Äî'}`,
    `${F.usage}: ${({launch:{fr:'Lancement',en:'Launch',es:'Lanzamiento',ca:'Llan√ßament'},base:{fr:'Biblioth√®que',en:'Library',es:'Biblioteca',ca:'Biblioteca'},series:{fr:'S√©rie',en:'Series',es:'Serie',ca:'S√®rie'}}[S.usage]?.[L])||'‚Äî'}`,
    `${F.chan}: ${S.channels.map(x=>CHAN_L[L]?.[x]).filter(Boolean).join(', ')||'‚Äî'}`,
    `${F.loc}: ${LOC_L[L]?.[S.location]||'‚Äî'}`,
    `${F.tim}: ${TIM_L[L]?.[S.timing]||'‚Äî'}`,
    `${F.calm}: ${S.calm}/100 (${vibeWord(S.calm)})`,
    `${F.pres}: ${S.present}/100 (${vibeWord(S.present)})`,
    `${F.rich}: ${S.rich}/100 (${vibeWord(S.rich)})`,
    `${F.email}: ${S.email||'‚Äî'}`
  ].join(NL);

  const sourceNote = S.briefSource==='ai' ? '\n[Brief g√©n√©r√© par Cloudflare Workers AI ¬∑ Llama 3.1]' : '\n[Brief g√©n√©r√© automatiquement]';
  const emailBody=
    t('emailHi')+NL+NL+
    t('emailIntro')+NL+NL+
    '‚îÅ‚îÅ‚îÅ BRIEF ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ'+NL+NL+
    (S.briefText||fallback())+sourceNote+NL+NL+
    '‚îÅ‚îÅ‚îÅ FORMULAIRE ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ'+NL+NL+
    formBlock+NL+NL+
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ'+NL+NL+
    t('emailSign')+NL+(S.name||'');

  const sendMsg={fr:{sending:'Envoi...',success:'‚úÖ Brief envoy√©!',error:'Erreur. Redirection vers votre client mail...'},en:{sending:'Sending...',success:'‚úÖ Brief sent!',error:'Error. Redirecting to your mail client...'},es:{sending:'Enviando...',success:'‚úÖ Brief enviado!',error:'Error. Redirigiendo a tu cliente de correo...'},ca:{sending:'Enviant...',success:'‚úÖ Brief enviat!',error:'Error. Redirigint al teu client de correu...'}};
  const msg=sendMsg[L]||sendMsg.en;
  const btn=document.querySelector('.cta-btns .bp');
  if(btn){
    const origTxt=btn.textContent;
    btn.textContent=msg.sending;
    btn.disabled=true;
    try{
      const res=await fetch('https://api.web3forms.com/submit',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({access_key:'31469485-cf3b-405a-832e-c6b18c9911ea',subject:subj,from_name:S.name||'Questionnaire Marinaphoto',email:S.email,message:emailBody,to:'info@marinaphoto.es'})});
      if(!res.ok) throw new Error('Web3Forms failed');
      const data=await res.json();
      if(!data.success) throw new Error(data.message||'Send failed');
      alert(msg.success);
    }catch(err){
      console.warn('Direct send failed, using mailto fallback:',err);
      alert(msg.error);
      window.location.href=`mailto:info@marinaphoto.es?subject=${encodeURIComponent(subj)}&body=${encodeURIComponent(emailBody)}`;
    }finally{
      btn.textContent=origTxt;
      btn.disabled=false;
    }
  }else{
    window.location.href=`mailto:info@marinaphoto.es?subject=${encodeURIComponent(subj)}&body=${encodeURIComponent(emailBody)}`;
  }
}

function doRdv(){
  window.open('https://calendly.com/ericimstepf/30min','_blank','noopener');
}

function doPDF(){
  if(typeof window.jspdf==='undefined'||!window.jspdf.jsPDF){
    alert({fr:'Module PDF non charg√©. Rechargez la page.',en:'PDF module not loaded. Please reload.',es:'M√≥dulo PDF no cargado. Recarga la p√°gina.',ca:'M√≤dul PDF no carregat. Recarrega la p√†gina.'}[L]||'PDF error');
    return;
  }
  try{
    const {jsPDF}=window.jspdf;
    const doc=new jsPDF({unit:'mm',format:'a4',orientation:'portrait'});
    const gold=[200,168,130],dark=[44,44,44],white=[254,254,254],cream=[245,241,232];
    const W=210,margin=18;
    doc.setFillColor(...gold);doc.rect(0,0,W,38,'F');
    doc.setTextColor(...white);doc.setFontSize(18);doc.setFont('helvetica','bold');
    doc.text('MARINAPHOTO',margin,16);
    doc.setFontSize(9);doc.setFont('helvetica','normal');
    doc.text('Photography Brief',margin,24);
    const locale={fr:'fr-FR',en:'en-GB',es:'es-ES',ca:'ca-ES'}[L]||'en-GB';
    const dateStr=new Date().toLocaleDateString(locale,{day:'numeric',month:'long',year:'numeric'});
    doc.text(dateStr,W-margin,24,{align:'right'});
    doc.setFillColor(...cream);doc.rect(0,38,W,36,'F');
    doc.setTextColor(...dark);doc.setFontSize(26);doc.setFont('helvetica','bold');
    const proj=S.project||(L==='fr'?'Votre projet':L==='es'?'Tu proyecto':L==='ca'?'El teu projecte':'Your project');
    doc.text(proj,margin,58);
    if(S.name){doc.setFontSize(12);doc.setFont('helvetica','normal');doc.setTextColor(...gold);doc.text(S.name,margin,68);}
    // AI badge in PDF
    doc.setFontSize(8);doc.setFont('helvetica','italic');doc.setTextColor(...gold);
    const badgeTxt = S.briefSource==='ai' ? '‚ú¶ '+t('aiBadge') : '‚ú¶ '+t('fallbackBadge');
    doc.text(badgeTxt,margin,80);
    let y=92;
    doc.setFillColor(...gold);doc.rect(margin,y,2,120,'F');
    doc.setTextColor(...dark);doc.setFontSize(11);doc.setFont('helvetica','normal');
    const briefTxt=S.briefText||fallback();
    const lines=doc.splitTextToSize(briefTxt,W-margin*2-8);
    lines.forEach(ln=>{
      if(y>262){doc.addPage();y=20;doc.setFillColor(...gold);doc.rect(margin,y,2,120,'F');}
      doc.text(ln,margin+6,y);y+=6.2;
    });
    y+=12;
    if(y>250){doc.addPage();y=20;}
    doc.setFillColor(...gold);doc.roundedRect(margin,y,W-margin*2,26,4,4,'F');
    doc.setTextColor(...white);doc.setFontSize(10);doc.setFont('helvetica','italic');
    doc.text('"'+t('report.ctaQuote')+'"',W/2,y+10,{align:'center',maxWidth:W-margin*2-8});
    doc.setFont('helvetica','normal');doc.setFontSize(9);
    doc.text(t('report.ctaText'),W/2,y+18,{align:'center',maxWidth:W-margin*2-8});
    const FY=285;
    doc.setFillColor(...dark);doc.rect(0,FY-2,W,14,'F');
    doc.setTextColor(...white);doc.setFontSize(9);
    doc.setFont('helvetica','bold');doc.text('MARINAPHOTO',margin,FY+5);
    doc.setFont('helvetica','normal');doc.text('info@marinaphoto.es',W/2,FY+5,{align:'center'});
    doc.text('Sitges ‚Äî Barcelona',W-margin,FY+5,{align:'right'});
    const fn=(t('pdfFilename')+'-'+(S.project||'project').replace(/[^a-z0-9]/gi,'-').toLowerCase()+'.pdf');
    doc.save(fn);
  }catch(e){
    console.error('PDF error:',e);
    alert('PDF error: '+e.message);
  }
}

function doRestart(){
  if(!confirm(t('restartConfirm')))return;
  step=0;
  Object.assign(S,{name:'',project:'',type:null,priorities:[],usage:null,channels:[],location:null,timing:null,calm:50,present:50,rich:50,email:'',briefText:'',briefSource:'ai'});
  go();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// START
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
go();
</script>
</body>
</html>
