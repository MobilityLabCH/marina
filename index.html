<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Marinaphoto — Brief</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,400&family=Inter:wght@400;500;600;700&display=swap');
        :root{--cream:#F5F1E8;--gold:#C8A882;--gold-l:#E8D5BC;--dark:#2C2C2C;--white:#FEFEFE;}
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:'Inter',sans-serif;background:var(--cream);color:var(--dark);min-height:100vh;}
        .page{min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:32px 20px 60px;}
        .topbar{width:100%;max-width:860px;display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;}
        .brand{font-family:'Playfair Display',serif;font-size:20px;font-weight:700;color:var(--dark);}
        .brand em{font-style:normal;color:var(--gold);font-family:'Inter',sans-serif;font-size:12px;font-weight:400;margin-left:8px;}
        .prog-wrap{width:100%;max-width:860px;background:var(--white);border-radius:16px;padding:16px 22px;margin-bottom:22px;box-shadow:0 2px 16px rgba(44,44,44,.06);}
        .prog-bar{height:5px;background:var(--cream);border-radius:10px;overflow:hidden;margin-bottom:10px;}
        .prog-fill{height:100%;background:linear-gradient(90deg,var(--gold),var(--gold-l));border-radius:10px;transition:width .5s ease;}
        .card{width:100%;max-width:860px;background:var(--white);border-radius:24px;padding:clamp(28px,5vw,52px);box-shadow:0 8px 40px rgba(44,44,44,.10);text-align:center;}
        h1{font-family:'Playfair Display',serif;font-size:clamp(24px,4vw,38px);margin-bottom:12px;}
        .sub{font-size:17px;opacity:.7;margin-bottom:26px;}
        input[type=text], input[type=email]{width:100%;padding:15px 20px;border:2px solid transparent;background:var(--cream);border-radius:14px;font-size:16px;outline:none;margin-top:8px;}
        input:focus{border-color:var(--gold);background:var(--white);}
        .bp{padding:14px 32px;background:var(--gold);color:white;border:none;border-radius:50px;font-weight:700;cursor:pointer;margin-top:20px;}
        .loading{padding:40px 0;}
        .spinner{width:40px;height:40px;border:4px solid var(--cream);border-top-color:var(--gold);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 20px;}
        @keyframes spin{to{transform:rotate(360deg)}}
        .rpt-hero{background:rgba(200,168,130,.05);padding:40px;border-radius:24px;margin-bottom:30px;}
        .rpt-body{text-align:left;line-height:1.8;font-size:18px;border-left:3px solid var(--gold);padding-left:25px;}
        .ai-badge{display:inline-block;background:rgba(200,168,130,.1);padding:5px 15px;border-radius:20px;font-size:12px;color:var(--gold);margin-bottom:20px;}
    </style>
</head>
<body>
<div class="page">
    <div class="topbar">
        <div class="brand">MARINAPHOTO <em>Brief</em></div>
    </div>
    <div class="prog-wrap" id="prog-ui">
        <div class="prog-bar"><div class="prog-fill" id="pbar"></div></div>
        <div id="pstep" style="font-size:12px; opacity:0.6;">Étape 1/4</div>
    </div>
    <div class="card" id="card"></div>
</div>

<script>
let step = 0;
const S = { name:'', project:'', email:'', briefText:'', source:'' };

function render() {
    const c = document.getElementById('card');
    const pbar = document.getElementById('pbar');
    const pstep = document.getElementById('pstep');
    
    pbar.style.width = ((step + 1) / 4 * 100) + '%';
    pstep.innerText = `Étape ${step + 1}/4`;

    if(step === 0) {
        c.innerHTML = `<h1>Bonjour !</h1><p class="sub">Commençons par votre prénom.</p>
                       <input type="text" placeholder="Sophie" onchange="S.name=this.value">
                       <br><button class="bp" onclick="step++;render();">Continuer</button>`;
    } else if(step === 1) {
        c.innerHTML = `<h1>Votre projet</h1><p class="sub">Comment s'appelle-t-il ?</p>
                       <input type="text" placeholder="Hôtel Can Ros" onchange="S.project=this.value">
                       <br><button class="bp" onclick="step++;render();">Continuer</button>`;
    } else if(step === 2) {
        c.innerHTML = `<h1>Contact</h1><p class="sub">Où vous envoyer le brief ?</p>
                       <input type="email" placeholder="sophie@exemple.com" onchange="S.email=this.value">
                       <br><button class="bp" onclick="generateAI();">Générer mon brief</button>`;
    }
}

async function generateAI() {
    const c = document.getElementById('card');
    document.getElementById('prog-ui').style.display = 'none';
    c.innerHTML = `<div class="loading"><div class="spinner"></div><h2>Rédaction de votre brief...</h2><p>L'IA analyse le projet "${S.project}"</p></div>`;

    try {
        const response = await fetch('/api/generate', {
            method: 'POST',
            body: JSON.stringify({ text: `Client: ${S.name}, Projet: ${S.project}` }),
            headers: {'Content-Type': 'application/json'}
        });
        const data = await response.json();
        S.briefText = data.result;
        S.source = 'ai';
    } catch (e) {
        S.briefText = `Nous allons collaborer sur "${S.project}" pour créer des visuels uniques...`;
        S.source = 'fallback';
    }
    showFinal();
}

function showFinal() {
    const c = document.getElementById('card');
    c.innerHTML = `
        <div class="rpt-hero">
            <div style="color:var(--gold); font-weight:700;">PROJET : ${S.project.toUpperCase()}</div>
            <h1>Votre Brief Personnalisé</h1>
        </div>
        <div class="ai-badge">${S.source === 'ai' ? '✦ RÉDIGÉ PAR L\'IA' : 'BROUILLON AUTOMATIQUE'}</div>
        <div class="rpt-body">${S.briefText.split('\n').map(p => `<p>${p}</p>`).join('')}</div>
        <button class="bp" onclick="location.reload();">Nouveau brief</button>
    `;
}

render();
</script>
</body>
</html>
