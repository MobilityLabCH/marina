function pick(arr, seed){
  // deterministic pick (no randomness across refresh)
  const i = Math.abs(hash(seed)) % arr.length;
  return arr[i];
}
function hash(s){
  let h=0;
  for(let i=0;i<s.length;i++) h = (h<<5)-h + s.charCodeAt(i), h|=0;
  return h;
}

function storyLines(){
  const a = tr();
  const who = (state.name||"").trim();
  const proj = (state.project||"").trim();
  const seed = `${lang}|${who}|${proj}|${state.core}|${state.intent.join(",")}|${state.time}|${state.where.join(",")}|${state.sliders.calm}|${state.sliders.present}|${state.sliders.rich}`;

  const projLabel = proj ? `“${proj}”` : (lang==="fr"?"ce projet":lang==="es"?"este proyecto":"this project");
  const whoLabel = who ? who : (lang==="fr"?"vous":lang==="es"?"tú":"you");

  // --- Core (place/story/moment)
  const coreLines = {
    fr:{
      place:[
        "Ce projet ressemble à un lieu qu’on doit pouvoir ressentir — sa lumière, sa matière, sa présence.",
        "On est ici dans une histoire de lieu : une présence, une atmosphère, quelque chose qui se tient dans l’air.",
        "Ce projet semble demander des images qui laissent respirer le lieu — sans forcer, sans surjouer."
      ],
      story:[
        "Ce projet ressemble à une histoire : des gestes, des humains, une continuité.",
        "On sent une narration — pas forcément racontée, mais portée par le rythme et la présence.",
        "Ce projet semble demander des images qui suivent une histoire plus que des “moments parfaits”."
      ],
      moment:[
        "Ce projet ressemble à un moment à garder — quelque chose de juste, simple, vrai.",
        "On est dans l’idée de mémoire : un instant qu’on veut pouvoir retrouver plus tard.",
        "Ce projet semble demander des images qui protègent l’essentiel, sans bruit."
      ]
    },
    en:{
      place:[
        "This feels like a place that needs to be felt — its light, texture and presence.",
        "This is about place: atmosphere, materiality, and a quiet presence in the air.",
        "It seems to ask for images that let the place breathe — without forcing anything."
      ],
      story:[
        "This feels like a story: people, gestures, continuity.",
        "There’s a narrative here — not explained, but carried by rhythm and presence.",
        "It asks for images that follow a story more than “perfect moments”."
      ],
      moment:[
        "This feels like a moment to hold onto — something simple, truthful, precise.",
        "It’s about memory: an instant you want to be able to return to later.",
        "It asks for images that protect what matters, quietly."
      ]
    },
    es:{
      place:[
        "Esto se siente como un lugar que hay que sentir — su luz, su textura, su presencia.",
        "Aquí hay lugar: atmósfera, materia y una presencia silenciosa en el aire.",
        "Pide imágenes que dejen respirar el lugar — sin forzar."
      ],
      story:[
        "Esto se siente como una historia: personas, gestos, continuidad.",
        "Hay un relato — no explicado, sino sostenido por el ritmo y la presencia.",
        "Pide imágenes que sigan una historia más que “momentos perfectos”."
      ],
      moment:[
        "Esto se siente como un momento para guardar — algo simple, verdadero, preciso.",
        "Es memoria: un instante al que quieres volver más adelante.",
        "Pide imágenes que protejan lo esencial, en silencio."
      ]
    }
  };

  // --- Intent (max 2)
  const intentMap = {
    fr:{
      natural:"une sensation naturelle",
      atmosphere:"une atmosphère forte",
      truth:"un sentiment de vérité",
      elegance:"une élégance discrète"
    },
    en:{
      natural:"a natural feeling",
      atmosphere:"a strong atmosphere",
      truth:"a sense of truth",
      elegance:"a quiet elegance"
    },
    es:{
      natural:"una sensación natural",
      atmosphere:"una atmósfera fuerte",
      truth:"una sensación de verdad",
      elegance:"una elegancia silenciosa"
    }
  };

  const intentList = state.intent.map(x=>intentMap[lang][x]).filter(Boolean);
  const intentLine = (() => {
    if(intentList.length===0){
      return lang==="fr" ? "Ce qui devrait rester : une impression juste — sans forcer."
           : lang==="es" ? "Lo que debería permanecer: una impresión precisa — sin forzar."
           : "What should stay: a precise feeling — without forcing it.";
    }
    const joiner = lang==="fr" ? " et " : lang==="es" ? " y " : " and ";
    const str = intentList.join(joiner);
    const variants = {
      fr:[
        `Ce qui devrait rester : ${str} — sans forcer.`,
        `Au premier regard, l’image devrait laisser : ${str}.`,
        `L’idée n’est pas l’effet, mais que reste : ${str}.`
      ],
      en:[
        `What should stay: ${str} — without forcing it.`,
        `At first encounter, the image should leave: ${str}.`,
        `Not effect — but what remains: ${str}.`
      ],
      es:[
        `Lo que debería permanecer: ${str} — sin forzar.`,
        `Al primer encuentro, la imagen debería dejar: ${str}.`,
        `No es efecto: es lo que queda: ${str}.`
      ]
    };
    return pick(variants[lang], seed+"|intent");
  })();

  // --- Time / collaboration framing
  const timeLine = (() => {
    const v = {
      fr:{
        moment:[
          "C’est une présence pour un moment précis : on vise la clarté et l’essentiel.",
          "On est sur une fenêtre courte : l’objectif est d’être juste, simple, net.",
          "C’est un besoin ponctuel : on construit une série concise, solide."
        ],
        overtime:[
          "C’est une présence dans le temps : cohérence, série, réutilisation.",
          "L’enjeu est la durée de vie : un set réutilisable, stable, qui ne fatigue pas.",
          "On vise une base : des images qui tiennent et restent justes avec le temps."
        ],
        grow:[
          "C’est une présence qui grandit : une base vivante qui s’installe.",
          "On construit un langage visuel : quelque chose qui s’épaissit doucement.",
          "L’idée est une continuité : un regard qui accompagne l’évolution."
        ]
      },
      en:{
        moment:[
          "It’s a presence for a specific moment: clarity and essentials.",
          "A short window: the goal is to be precise, simple, true.",
          "A punctual need: a concise, solid series."
        ],
        overtime:[
          "It’s a presence over time: consistency, series, reuse.",
          "Longevity matters: a reusable set that doesn’t “wear out”.",
          "A visual base: images that stay true as time passes."
        ],
        grow:[
          "It’s a presence that grows: a living base that settles in.",
          "We build a visual language: something that deepens quietly.",
          "Continuity: a gaze that follows the project as it evolves."
        ]
      },
      es:{
        moment:[
          "Es presencia para un momento concreto: claridad y esencial.",
          "Ventana corta: el objetivo es ser preciso, simple, verdadero.",
          "Necesidad puntual: una serie concisa y sólida."
        ],
        overtime:[
          "Es presencia en el tiempo: coherencia, serie, reutilización.",
          "Importa la vida útil: un set reutilizable que no se “gasta”.",
          "Una base visual: imágenes que siguen siendo precisas con el tiempo."
        ],
        grow:[
          "Es una presencia que crece: una base viva que se asienta.",
          "Construimos un lenguaje visual: algo que se profundiza en silencio.",
          "Continuidad: una mirada que acompaña la evolución."
        ]
      }
    };
    const key = state.time || "overtime";
    return pick(v[lang][key], seed+"|time");
  })();

  // --- Closing (Marina stance)
  const closeVariants = {
    fr:[
      `Mon rôle est de traduire tout ça en images qui font sens pour ${whoLabel} — sans dénaturer mon regard.`,
      `Je photographie ce qui compte ici : présence, rythme, justesse — avec mon style, sans le “tordre”.`,
      `Mon travail : faire des images qui restent vraies pour ${whoLabel}, et qui continuent à faire sens plus tard.`
    ],
    en:[
      `My role is to translate this into images that make sense for ${whoLabel} — without bending my gaze.`,
      `I photograph what matters here: presence, rhythm, truth — with my style, not against it.`,
      `My work: images that feel true for ${whoLabel}, and keep making sense later.`
    ],
    es:[
      `Mi papel es traducir esto en imágenes que tengan sentido para ${whoLabel} — sin forzar mi mirada.`,
      `Fotografío lo que importa: presencia, ritmo, verdad — con mi estilo, sin torcerlo.`,
      `Mi trabajo: imágenes que sean verdaderas para ${whoLabel} y sigan teniendo sentido más adelante.`
    ]
  };

  const coreKey = state.core || "place";
  return {
    title: projLabel,
    lines: [
      pick(coreLines[lang][coreKey], seed+"|core"),
      intentLine,
      timeLine,
      pick(closeVariants[lang], seed+"|close")
    ]
  };
}
