<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Marina ‚Äî Project Snapshot</title>
  <meta name="description" content="A calm, one-question-at-a-time briefing experience that generates a Project Snapshot instantly." />

  <style>
    :root{
      --bg:#0b0d10;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.035);
      --line:rgba(255,255,255,.14);
      --txt:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.62);
      --muted2:rgba(255,255,255,.50);
      --accent:rgba(255,255,255,.92);
      --shadow:0 18px 60px rgba(0,0,0,.60);
      --radius:26px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--txt);
      background:var(--bg);
      overflow-x:hidden;
    }
    .bg{
      position:fixed; inset:0; z-index:-3;
      background:
        radial-gradient(980px 520px at 18% 18%, rgba(255,255,255,.11), transparent 62%),
        radial-gradient(860px 520px at 85% 28%, rgba(255,255,255,.085), transparent 65%),
        radial-gradient(980px 560px at 52% 96%, rgba(255,255,255,.065), transparent 60%),
        linear-gradient(180deg, #0b0d10 0%, #090a0d 100%);
      filter:saturate(1.0);
      transition:filter .25s ease;
    }
    .grain{
      position:fixed; inset:-40px; z-index:-2; opacity:.10; pointer-events:none;
      background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="180" height="180"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency=".8" numOctaves="3" stitchTiles="stitch"/></filter><rect width="180" height="180" filter="url(%23n)" opacity=".55"/></svg>');
      mix-blend-mode:overlay;
    }

    .wrap{min-height:100vh; display:flex; justify-content:center; align-items:center; padding:26px 14px;}
    .shell{ width:min(1060px,100%); }

    .topbar{
      display:flex; justify-content:space-between; align-items:center;
      gap:10px; flex-wrap:wrap;
      padding:10px 6px;
      color:var(--muted);
      font-size:13px;
    }
    .pill{
      display:inline-flex; align-items:center; gap:10px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      max-width:100%;
    }
    .lang{
      display:inline-flex; gap:6px; align-items:center;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.03);
      padding:4px; border-radius:999px;
    }
    .lang button{
      border:none; background:transparent; color:var(--muted);
      font-weight:850; cursor:pointer; padding:6px 10px; border-radius:999px;
      letter-spacing:.02em;
    }
    .lang button.active{ color:#0c0e11; background:var(--accent); }
    .progress{
      width:260px; height:10px; border-radius:999px; overflow:hidden;
      background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.10);
    }
    .progress > div{
      height:100%; width:0%;
      background:rgba(255,255,255,.86);
      border-radius:999px;
      transition:width .35s ease;
    }
    @media(max-width:720px){ .progress{ width:180px; } }

    .card{
      border:1px solid var(--line);
      background:linear-gradient(180deg, var(--card), var(--card2));
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .content{padding:28px}
    @media (max-width:720px){ .content{padding:20px} }

    .fade{animation:fade .32s ease both}
    @keyframes fade{from{opacity:0; transform:translateY(10px)}to{opacity:1; transform:translateY(0)}}

    .kicker{font-size:12px; letter-spacing:.11em; text-transform:uppercase; color:rgba(255,255,255,.56)}
    h1{font-size:34px; margin:8px 0 10px; letter-spacing:-.02em}
    p{margin:0 0 12px; line-height:1.55}
    .lead{color:var(--muted); font-size:16px}
    .hint{color:var(--muted2); font-size:13px; margin-top:8px; line-height:1.45}
    .micro{color:var(--muted2); font-size:12px; margin-top:10px}
    .divider{height:1px; background:rgba(255,255,255,.12); margin:18px 0}

    input[type="text"]{
      width:100%;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--txt);
      outline:none;
      margin-top:10px;
      font-size:15px;
    }

    .choices,.checks{display:grid; gap:10px; margin-top:14px}
    .choice,.check{
      border:1px solid var(--line);
      border-radius:18px;
      padding:14px;
      background:rgba(255,255,255,.04);
      cursor:pointer;
      transition:background .15s ease, border-color .15s ease, transform .08s ease;
    }
    .choice:hover,.check:hover{background:rgba(255,255,255,.06)}
    .choice:active,.check:active{transform:scale(.997)}
    .choice.sel,.check.sel{background:rgba(255,255,255,.09); border-color:rgba(255,255,255,.26);}
    .optTitle{font-weight:900}
    .optDesc{margin-top:6px; font-size:12px; color:var(--muted); line-height:1.35}

    .btnrow{display:flex; gap:10px; flex-wrap:wrap; margin-top:18px}
    button{
      border-radius:999px;
      border:1px solid var(--line);
      padding:11px 16px;
      background:rgba(255,255,255,.06);
      color:var(--txt);
      cursor:pointer;
      font-weight:900;
    }
    button.primary{ background:var(--accent); color:#0c0e11; border-color:rgba(255,255,255,.18); }
    button.ghost{ background:transparent; }
    button.small{ padding:8px 12px; font-size:13px; font-weight:850; }

    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width:900px){ .grid2{grid-template-columns:1fr} }

    .box{
      border:1px solid var(--line);
      border-radius:18px;
      padding:14px;
      background:rgba(255,255,255,.04);
    }

    .tags{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
    .tag{
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.05);
      padding:7px 10px;
      border-radius:999px;
      font-size:13px;
      color:rgba(255,255,255,.86);
      white-space:nowrap;
    }

    .bar{margin-top:12px}
    .barhead{display:flex; justify-content:space-between; font-size:13px; color:var(--muted)}
    .track{height:10px; border-radius:999px; background:rgba(255,255,255,.10); margin-top:8px; overflow:hidden}
    .fill{height:100%; border-radius:999px; background:rgba(255,255,255,.86); width:40%}

    .slider{
      border:1px solid var(--line);
      border-radius:18px;
      padding:14px;
      background:rgba(255,255,255,.04);
      margin-top:12px;
    }
    .slab{display:flex; justify-content:space-between; color:var(--muted); font-size:13px}
    input[type="range"]{width:100%; margin-top:10px}
    .sliderHelp{display:flex; justify-content:space-between; gap:10px; margin-top:8px; font-size:12px; color:var(--muted2)}

    .presetRow{display:flex; gap:8px; flex-wrap:wrap; margin-top:12px}
    .presetRow button{background:rgba(255,255,255,.05)}
    .presetRow button.active{background:rgba(255,255,255,.10); border-color:rgba(255,255,255,.24)}

    .toast{
      position:fixed; left:50%; bottom:22px; transform:translateX(-50%);
      background:rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.18);
      color:rgba(255,255,255,.9);
      padding:10px 12px;
      border-radius:999px;
      font-size:13px;
      opacity:0;
      pointer-events:none;
      transition:opacity .2s ease;
      max-width:min(92vw,700px);
      text-align:center;
    }
    .toast.show{opacity:1}

    /* Print (PDF via Print dialog) */
    @media print{
      body{background:#fff; color:#111}
      .bg,.grain,.topbar,.toast{display:none !important}
      .wrap{padding:0}
      .card{box-shadow:none; border:1px solid #ddd}
      .content{padding:22px}
      .tag{border-color:#ddd; color:#111}
      .box{border-color:#ddd}
      .track{background:#eee}
      .fill{background:#111}
      button{display:none !important}
    }
  </style>
</head>

<body>
  <div class="bg" id="bg"></div>
  <div class="grain"></div>

  <div class="wrap">
    <div class="shell">
      <div class="topbar">
        <div class="pill" id="actPill">‚Äî</div>

        <div class="pill" style="gap:12px">
          <div class="progress" aria-label="progress"><div id="progFill"></div></div>
          <span id="stepPill">‚Äî</span>

          <span class="lang" aria-label="Language">
            <button id="btnEN" type="button">EN</button>
            <button id="btnFR" type="button">FR</button>
            <button id="btnES" type="button">ES</button>
          </span>
        </div>
      </div>

      <div class="card">
        <div class="content fade" id="app"></div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
(function(){
  /* ===========================
     World-class simplification:
     - One question at a time
     - Micro-guides + examples
     - Presets for sliders
     - Report = Cover ‚Üí 3 takeaways ‚Üí Evidence ‚Üí Next step
     - No external deps. GitHub Pages safe.
  ============================ */

  // If you want a fixed recipient:
  // var MAIL_TO = "hello@marinaphoto.es";
  var MAIL_TO = "";

  var I18N = {
    fr:{
      acts:{ intro:"Intro", who:"Toi & le projet", core:"Essence", use:"Usage", vibe:"Ambiance", report:"Snapshot" },
      ui:{
        start:"C‚Äôest parti",
        continue:"Continuer",
        back:"Retour",
        optional:"(optionnel)",
        pickOne:"Choisis une option üôÇ",
        pickAtLeastOne:"Choisis au moins une option üôÇ",
        maxTwo:"Max 2 choix",
        copied:"Copi√© ‚ú®",
        talk:"Parlons de ce projet",
        copy:"Copier le snapshot",
        email:"Ouvrir un email",
        print:"Imprimer / PDF",
        ifHesitate:"Si tu h√©sites : choisis ce qui te semble le plus vrai aujourd‚Äôhui.",
        maxTwoShort:"Max 2",
        presets:"Presets (si t‚Äôas la flemme üòÑ)",
        presetSoft:"Soft",
        presetBalanced:"Balanced",
        presetBold:"Bold"
      },
      intro:{
        kicker:"Project Snapshot",
        h1:"On va parler d‚Äôimages. Pas de strat√©gie. Promis.",
        p:"8 questions rapides. Tu r√©ponds √† l‚Äôinstinct.\n√Ä la fin, tu repars avec un mini brief clair (et joli)."
      },
      who:{
        nameH1:"Comment je t‚Äôappelle ?",
        nameHelp:"Pr√©nom, pseudo‚Ä¶ comme tu veux. (Et oui, c‚Äôest optionnel.)",
        namePh:"Ex : Alex",
        projH1:"Ce projet, tu l‚Äôappelles comment ?",
        projHelp:"M√™me un nom provisoire marche tr√®s bien.",
        projPh:"Ex : Casa Sitges, Opening hotel‚Ä¶"
      },
      core:{
        h1:"En une phrase, c‚Äôest plut√¥t‚Ä¶",
        help:"Choisis ce qui d√©crit le mieux le projet.",
        opts:{
          place:{t:"üè† Un lieu", d:"On veut le faire ressentir (lumi√®re, mati√®re, atmosph√®re)."},
          story:{t:"üìñ Une histoire", d:"On suit des gens, des gestes, un fil narratif."},
          moment:{t:"‚è≥ Un moment", d:"On garde l‚Äôessentiel, sans surjouer."}
        },
        intentH1:"Quand quelqu‚Äôun tombe sur ces images, tu veux qu‚Äôil se dise‚Ä¶",
        intentHelp:"Choisis 1 ou 2. Instinctif = parfait.",
        intent:{
          natural:{t:"‚ÄúC‚Äôest naturel, √ßa sonne vrai.‚Äù", d:"Rien de forc√©. √áa respire."},
          atmosphere:{t:"‚ÄúIl y a une vraie ambiance.‚Äù", d:"On sent le lieu / le moment."},
          truth:{t:"‚ÄúC‚Äôest sinc√®re.‚Äù", d:"√áa a l‚Äôair v√©cu, pas fabriqu√©."},
          elegance:{t:"‚ÄúSimple, mais √©l√©gant.‚Äù", d:"Sobre, pr√©cis, intemporel."}
        }
      },
      use:{
        timeH1:"Ces images, tu les imagines surtout‚Ä¶",
        timeHelp:"√áa m‚Äôaide √† doser (pas √† te noter üòÑ).",
        time:{
          moment:{t:"üìÜ Pour un moment pr√©cis", d:"Un lancement, une p√©riode, un √©v√©nement."},
          overtime:{t:"üîÅ Pour les r√©utiliser souvent", d:"Une base solide, qui tient dans le temps."},
          grow:{t:"üå± Comme quelque chose qui va √©voluer", d:"Une continuit√©, une s√©rie, du suivi."}
        },
        whereH1:"Tu verras surtout ces images‚Ä¶",
        whereHelp:"Max 2. L√† o√π tu les croiseras vraiment.",
        where:{
          website:{t:"sur ton site", d:"Lecture pos√©e, temps long."},
          social:{t:"sur Instagram / r√©seaux", d:"Rythme, r√©p√©tition, s√©rie."},
          editorial:{t:"dans des articles / presse", d:"Contexte, narration, d√©tails."},
          print:{t:"imprim√©es / affich√©es", d:"Impact, mati√®re, permanence."}
        }
      },
      vibe:{
        h1:"Derni√®re chose. R√©ponds vite (sans te juger).",
        help:"√áa ne change pas mon style. √áa m‚Äôaide juste √† r√©gler le tempo.",
        s:{
          calm:{l:"üòå calme", r:"‚ö° vivant", hl:"pos√©", hr:"√©nergie"},
          present:{l:"üëÄ discret", r:"ü§ç proche", hl:"observer", hr:"√™tre dedans"},
          rich:{l:"‚úÇÔ∏è simple", r:"üß± riche", hl:"√©pur√©", hr:"mati√®re"}
        }
      },
      report:{
        kicker:"Project Snapshot",
        sub:"Une lecture simple, utile ‚Äî c√¥t√© images",
        coverTitle:"Lecture du projet",
        takeaways:"En 3 id√©es",
        evidence:"Ce que √ßa implique (usage + rythme)",
        plan:"Ce que Marina va chercher",
        next:"Prochaine √©tape",
        bullets:{
          series:"Une s√©rie coh√©rente (pas 3 images isol√©es)",
          rhythm:"Un rythme (respiration, lumi√®re, continuit√©)",
          real:"Du vrai (gestes, pr√©sence, mati√®re)",
          reuse:"Des images qui tiennent dans le temps"
        }
      }
    },

    en:{
      acts:{ intro:"Intro", who:"You & project", core:"Essence", use:"Use", vibe:"Vibe", report:"Snapshot" },
      ui:{
        start:"Let‚Äôs go",
        continue:"Continue",
        back:"Back",
        optional:"(optional)",
        pickOne:"Pick one üôÇ",
        pickAtLeastOne:"Pick at least one üôÇ",
        maxTwo:"Max 2",
        copied:"Copied ‚ú®",
        talk:"Let‚Äôs talk about this project",
        copy:"Copy snapshot",
        email:"Open email",
        print:"Print / PDF",
        ifHesitate:"If you hesitate: pick what feels most true today.",
        maxTwoShort:"Max 2",
        presets:"Presets (if you‚Äôre lazy üòÑ)",
        presetSoft:"Soft",
        presetBalanced:"Balanced",
        presetBold:"Bold"
      },
      intro:{
        kicker:"Project Snapshot",
        h1:"We‚Äôll talk images. Not strategy. Promise.",
        p:"8 quick questions. Answer by instinct.\nAt the end, you get a clear (and pretty) mini brief."
      },
      who:{
        nameH1:"How should I call you?",
        nameHelp:"First name, nickname‚Ä¶ your choice. (Optional.)",
        namePh:"e.g. Alex",
        projH1:"What do you call this project?",
        projHelp:"Even a temporary name is totally fine.",
        projPh:"e.g. Sitges house, Hotel opening‚Ä¶"
      },
      core:{
        h1:"In one sentence, it‚Äôs more like‚Ä¶",
        help:"Pick what describes it best.",
        opts:{
          place:{t:"üè† A place", d:"We want people to feel it (light, texture, atmosphere)."},
          story:{t:"üìñ A story", d:"People, gestures, a narrative thread."},
          moment:{t:"‚è≥ A moment", d:"Keep what matters, no overacting."}
        },
        intentH1:"When someone lands on these images, you want them to think‚Ä¶",
        intentHelp:"Pick 1 or 2. Instinct is perfect.",
        intent:{
          natural:{t:"‚ÄúIt feels natural and real.‚Äù", d:"Nothing forced. It breathes."},
          atmosphere:{t:"‚ÄúThere‚Äôs a real vibe.‚Äù", d:"You can feel the place / moment."},
          truth:{t:"‚ÄúIt feels sincere.‚Äù", d:"Lived-in, not manufactured."},
          elegance:{t:"‚ÄúSimple, but elegant.‚Äù", d:"Understated, precise, timeless."}
        }
      },
      use:{
        timeH1:"You mostly imagine these images‚Ä¶",
        timeHelp:"This helps me calibrate (not grade you üòÑ).",
        time:{
          moment:{t:"üìÜ For a specific moment", d:"A launch, a period, an event."},
          overtime:{t:"üîÅ To reuse often", d:"A solid base that lasts."},
          grow:{t:"üå± As something that evolves", d:"Continuity, series, follow-up."}
        },
        whereH1:"You‚Äôll mostly see these images‚Ä¶",
        whereHelp:"Max 2. Where you‚Äôll actually meet them.",
        where:{
          website:{t:"on your website", d:"Slower, calmer reading."},
          social:{t:"on Instagram / social", d:"Rhythm, repetition, series."},
          editorial:{t:"in editorial / press", d:"Context, narrative, details."},
          print:{t:"printed / displayed", d:"Impact, materiality, permanence."}
        }
      },
      vibe:{
        h1:"Last thing. Answer fast (no self-judgement).",
        help:"This doesn‚Äôt change my style. It just sets the tempo.",
        s:{
          calm:{l:"üòå calm", r:"‚ö° lively", hl:"quiet", hr:"energy"},
          present:{l:"üëÄ discreet", r:"ü§ç close", hl:"observe", hr:"inside it"},
          rich:{l:"‚úÇÔ∏è simple", r:"üß± rich", hl:"minimal", hr:"texture"}
        }
      },
      report:{
        kicker:"Project Snapshot",
        sub:"A simple, useful reading ‚Äî through images",
        coverTitle:"Project reading",
        takeaways:"3 takeaways",
        evidence:"What this implies (use + tempo)",
        plan:"What Marina will look for",
        next:"Next step",
        bullets:{
          series:"A coherent series (not 3 isolated images)",
          rhythm:"A rhythm (breathing, light, continuity)",
          real:"Real life (gestures, presence, texture)",
          reuse:"Images that keep making sense over time"
        }
      }
    },

    es:{
      acts:{ intro:"Intro", who:"T√∫ & proyecto", core:"Esencia", use:"Uso", vibe:"Vibra", report:"Snapshot" },
      ui:{
        start:"Vamos",
        continue:"Continuar",
        back:"Atr√°s",
        optional:"(opcional)",
        pickOne:"Elige una üôÇ",
        pickAtLeastOne:"Elige al menos una üôÇ",
        maxTwo:"M√°x 2",
        copied:"Copiado ‚ú®",
        talk:"Hablemos de este proyecto",
        copy:"Copiar snapshot",
        email:"Abrir email",
        print:"Imprimir / PDF",
        ifHesitate:"Si dudas: elige lo que se siente m√°s verdadero hoy.",
        maxTwoShort:"M√°x 2",
        presets:"Presets (si te da pereza üòÑ)",
        presetSoft:"Soft",
        presetBalanced:"Balanced",
        presetBold:"Bold"
      },
      intro:{
        kicker:"Project Snapshot",
        h1:"Hablamos de im√°genes. No de estrategia. Prometido.",
        p:"8 preguntas r√°pidas. Responde con instinto.\nAl final te llevas un mini brief claro (y bonito)."
      },
      who:{
        nameH1:"¬øC√≥mo te llamo?",
        nameHelp:"Nombre, apodo‚Ä¶ como quieras. (Opcional.)",
        namePh:"p.ej. Alex",
        projH1:"¬øC√≥mo llamas a este proyecto?",
        projHelp:"Incluso un nombre provisional sirve.",
        projPh:"p.ej. Casa Sitges, Opening hotel‚Ä¶"
      },
      core:{
        h1:"En una frase, es m√°s bien‚Ä¶",
        help:"Elige lo que mejor lo describe.",
        opts:{
          place:{t:"üè† Un lugar", d:"Queremos que se sienta (luz, textura, atm√≥sfera)."},
          story:{t:"üìñ Una historia", d:"Personas, gestos, un hilo narrativo."},
          moment:{t:"‚è≥ Un momento", d:"Guardar lo esencial, sin sobreactuar."}
        },
        intentH1:"Cuando alguien se topa con estas im√°genes, quieres que piense‚Ä¶",
        intentHelp:"Elige 1 o 2. Instinto = perfecto.",
        intent:{
          natural:{t:"‚ÄúSe siente natural y real.‚Äù", d:"Nada forzado. Respira."},
          atmosphere:{t:"‚ÄúHay una vibra real.‚Äù", d:"Se siente el lugar / momento."},
          truth:{t:"‚ÄúSe siente sincero.‚Äù", d:"Vivido, no fabricado."},
          elegance:{t:"‚ÄúSimple, pero elegante.‚Äù", d:"Sutil, preciso, atemporal."}
        }
      },
      use:{
        timeH1:"Sobre todo imaginas estas im√°genes‚Ä¶",
        timeHelp:"Esto me ayuda a calibrar (no a juzgar üòÑ).",
        time:{
          moment:{t:"üìÜ Para un momento concreto", d:"Un lanzamiento, una etapa, un evento."},
          overtime:{t:"üîÅ Para reutilizar a menudo", d:"Una base s√≥lida que dura."},
          grow:{t:"üå± Como algo que evoluciona", d:"Continuidad, serie, seguimiento."}
        },
        whereH1:"Vas a ver estas im√°genes sobre todo‚Ä¶",
        whereHelp:"M√°x 2. Donde realmente te las encontrar√°s.",
        where:{
          website:{t:"en tu web", d:"Lectura lenta, calmada."},
          social:{t:"en Instagram / redes", d:"Ritmo, repetici√≥n, serie."},
          editorial:{t:"en editorial / prensa", d:"Contexto, relato, detalles."},
          print:{t:"impresas / expuestas", d:"Impacto, materia, permanencia."}
        }
      },
      vibe:{
        h1:"√öltima. Responde r√°pido (sin juzgarte).",
        help:"Esto no cambia mi estilo. Solo pone el tempo.",
        s:{
          calm:{l:"üòå calmo", r:"‚ö° vivo", hl:"silencio", hr:"energ√≠a"},
          present:{l:"üëÄ discreto", r:"ü§ç cerca", hl:"observar", hr:"dentro"},
          rich:{l:"‚úÇÔ∏è simple", r:"üß± rico", hl:"minimal", hr:"textura"}
        }
      },
      report:{
        kicker:"Project Snapshot",
        sub:"Una lectura simple y √∫til ‚Äî en im√°genes",
        coverTitle:"Lectura del proyecto",
        takeaways:"3 ideas clave",
        evidence:"Lo que implica (uso + tempo)",
        plan:"Lo que Marina buscar√°",
        next:"Siguiente paso",
        bullets:{
          series:"Una serie coherente (no 3 im√°genes sueltas)",
          rhythm:"Un ritmo (respirar, luz, continuidad)",
          real:"Vida real (gestos, presencia, textura)",
          reuse:"Im√°genes que sigan teniendo sentido con el tiempo"
        }
      }
    }
  };

  var lang = "fr";
  var state = {
    name:"",
    project:"",
    core:null,
    intent:[],
    time:null,
    where:[],
    sliders:{ calm:55, present:45, rich:50 },
    preset:"balanced"
  };

  var app = document.getElementById("app");
  var actPill = document.getElementById("actPill");
  var stepPill = document.getElementById("stepPill");
  var toast = document.getElementById("toast");
  var progFill = document.getElementById("progFill");
  var bg = document.getElementById("bg");

  var btnEN = document.getElementById("btnEN");
  var btnFR = document.getElementById("btnFR");
  var btnES = document.getElementById("btnES");

  function tr(){ return I18N[lang]; }
  function esc(s){
    s = s || "";
    return s.replace(/[&<>"']/g, function(m){
      return ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]);
    });
  }
  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add("show");
    setTimeout(function(){ toast.classList.remove("show"); }, 1200);
  }
  function setLang(l){
    if(!I18N[l]) return;
    lang = l;
    btnEN.classList.remove("active");
    btnFR.classList.remove("active");
    btnES.classList.remove("active");
    (l==="en"?btnEN : l==="fr"?btnFR : btnES).classList.add("active");
    safeRender(false);
  }

  btnEN.addEventListener("click", function(){ setLang("en"); });
  btnFR.addEventListener("click", function(){ setLang("fr"); });
  btnES.addEventListener("click", function(){ setLang("es"); });

  // Steps
  var steps = [
    { act:"intro", render: renderIntro },
    { act:"who", render: renderName },
    { act:"who", render: renderProject },
    { act:"core", render: renderCore },
    { act:"core", render: renderIntent },
    { act:"use",  render: renderTime },
    { act:"use",  render: renderWhere },
    { act:"vibe", render: renderVibe },
    { act:"report", render: renderReport }
  ];
  var step = 0;

  function setHeader(){
    var a = tr();
    actPill.textContent = a.acts[steps[step].act] + " ¬∑ " + (step+1) + "/" + steps.length;
    stepPill.textContent = (step+1) + "/" + steps.length;
    progFill.style.width = Math.round(((step+1)/steps.length)*100) + "%";
  }

  function next(){ if(step < steps.length-1){ step++; safeRender(true); } }
  function prev(){ if(step > 0){ step--; safeRender(true); } }

  function btnRow(primaryLabel, onPrimary){
    var a = tr();
    var html = '<div class="btnrow">' +
      '<button class="primary" id="primaryBtn" type="button">' + esc(primaryLabel) + '</button>';
    if(step>0) html += '<button class="ghost" id="backBtn" type="button">' + esc(a.ui.back) + '</button>';
    html += '</div>';
    return { html: html, bind: function(){
      var p = document.getElementById("primaryBtn");
      if(p) p.onclick = onPrimary;
      var b = document.getElementById("backBtn");
      if(b) b.onclick = prev;
    }};
  }

  // ---------------- Report logic (simple & useful)
  function clamp(v){ return Math.max(0, Math.min(100, v)); }

  function usageScores(){
    var base = { website:28, social:28, editorial:28, print:28 };
    for(var i=0;i<state.where.length;i++) base[state.where[i]] += 34;

    var longevity = 55;
    if(state.time==="moment") longevity = 35;
    if(state.time==="overtime") longevity = 72;
    if(state.time==="grow") longevity = 86;

    // small boosts for long-term use
    var boost = (state.time==="overtime") ? 6 : (state.time==="grow") ? 10 : 0;
    base.website += boost; base.social += boost; base.editorial += boost; base.print += boost;

    base.website = clamp(base.website);
    base.social = clamp(base.social);
    base.editorial = clamp(base.editorial);
    base.print = clamp(base.print);

    return { base:base, longevity:clamp(longevity) };
  }

  function sliderSentence(){
    var c = state.sliders.calm, p = state.sliders.present, r = state.sliders.rich;
    if(lang==="fr"){
      return "Rythme " + (c>60?"pos√©":"√©nergique") + " ¬∑ distance " + (p>55?"proche":"discr√®te") + " ¬∑ visuel " + (r>55?"textur√©":"√©pureÃÅ") + ".";
    }
    if(lang==="es"){
      return "Ritmo " + (c>60?"calmo":"en√©rgico") + " ¬∑ distancia " + (p>55?"cerca":"discreta") + " ¬∑ visual " + (r>55?"con textura":"limpio") + ".";
    }
    return "Tempo " + (c>60?"calm":"energetic") + " ¬∑ distance " + (p>55?"close":"discreet") + " ¬∑ visuals " + (r>55?"textured":"minimal") + ".";
  }

  function computeTakeaways(){
    var a = tr();
    var who = (state.name||"").trim();
    var proj = (state.project||"").trim();
    var projLabel = proj ? ("‚Äú" + proj + "‚Äù") : (lang==="fr"?"ce projet":lang==="es"?"este proyecto":"this project");

    // 1) Core
    var coreLine;
    if(lang==="fr"){
      coreLine = (state.core==="place") ? ("C‚Äôest un projet de lieu : on veut faire ressentir l‚Äôatmosph√®re.") :
                 (state.core==="story") ? ("C‚Äôest un projet d‚Äôhistoire : on suit des humains, des gestes, un fil.") :
                 ("C‚Äôest un projet de moment : on garde l‚Äôessentiel, sans surjouer.");
    } else if(lang==="es"){
      coreLine = (state.core==="place") ? ("Es un proyecto de lugar: queremos sentir la atm√≥sfera.") :
                 (state.core==="story") ? ("Es un proyecto de historia: personas, gestos, un hilo.") :
                 ("Es un proyecto de momento: guardar lo esencial, sin exagerar.");
    } else {
      coreLine = (state.core==="place") ? ("It‚Äôs a place project: we want people to feel the atmosphere.") :
                 (state.core==="story") ? ("It‚Äôs a story project: people, gestures, a thread.") :
                 ("It‚Äôs a moment project: keep what matters, no overacting.");
    }

    // 2) Intent (max 2)
    var it = state.intent.slice(0);
    var intentLine;
    if(lang==="fr"){
      var m = { natural:"naturel", atmosphere:"ambiance", truth:"sinc√®re", elegance:"simple & √©l√©gant" };
      intentLine = it.length===2 ? ("On veut que √ßa reste " + m[it[0]] + " + " + m[it[1]] + ".") :
                   it.length===1 ? ("On veut que √ßa reste " + m[it[0]] + ".") :
                                   ("On veut que √ßa sonne vrai.");
    } else if(lang==="es"){
      var ms = { natural:"natural", atmosphere:"con vibra", truth:"sincero", elegance:"simple y elegante" };
      intentLine = it.length===2 ? ("Queremos que quede " + ms[it[0]] + " + " + ms[it[1]] + ".") :
                   it.length===1 ? ("Queremos que quede " + ms[it[0]] + ".") :
                                   ("Queremos que se sienta real.");
    } else {
      var me = { natural:"natural", atmosphere:"full of vibe", truth:"sincere", elegance:"simple & elegant" };
      intentLine = it.length===2 ? ("We want it to feel " + me[it[0]] + " + " + me[it[1]] + ".") :
                   it.length===1 ? ("We want it to feel " + me[it[0]] + ".") :
                                   ("We want it to feel real.");
    }

    // 3) Collaboration expectation
    var collabLine;
    if(lang==="fr"){
      collabLine = (state.time==="moment") ? "Format id√©al : une session cibl√©e, claire, efficace." :
                  (state.time==="overtime") ? "Format id√©al : construire une base r√©utilisable." :
                                             "Format id√©al : continuit√© (s√©rie + suivi).";
    } else if(lang==="es"){
      collabLine = (state.time==="moment") ? "Formato ideal: una sesi√≥n enfocada y eficaz." :
                  (state.time==="overtime") ? "Formato ideal: construir una base reutilizable." :
                                             "Formato ideal: continuidad (serie + seguimiento).";
    } else {
      collabLine = (state.time==="moment") ? "Ideal format: one focused, efficient shoot." :
                  (state.time==="overtime") ? "Ideal format: build a reusable base." :
                                             "Ideal format: continuity (series + follow-up).";
    }

    var close;
    if(lang==="fr") close = "Et oui : je le fais avec mon style. Pas de ‚Äúmode cam√©l√©on‚Äù üòÑ";
    else if(lang==="es") close = "Y s√≠: lo har√© con mi estilo. Nada de ‚Äúcamale√≥n‚Äù üòÑ";
    else close = "And yes: I‚Äôll do it with my style. No chameleon mode üòÑ";

    return {
      projLabel: projLabel,
      who: who,
      takeaways: [coreLine, intentLine, collabLine],
      close: close
    };
  }

  function tags(){
    var a = tr();
    var out = [];
    if(state.core) out.push(a.core.opts[state.core].t);
    for(var i=0;i<state.intent.length;i++) out.push(a.core.intent[state.intent[i]].t);

    // slider tag
    var c=state.sliders.calm, p=state.sliders.present, r=state.sliders.rich;
    var extra;
    if(lang==="fr"){
      extra = (c>65 && p<45) ? "Calme + discret" :
              (c<45 && p>60) ? "√ânergie + proche" :
              (r>70) ? "Mati√®re + d√©tails" :
              (r<35) ? "Tr√®s √©pur√©" : "√âquilibr√©";
    } else if(lang==="es"){
      extra = (c>65 && p<45) ? "Calma + discreto" :
              (c<45 && p>60) ? "Energ√≠a + cerca" :
              (r>70) ? "Textura + detalle" :
              (r<35) ? "Muy limpio" : "Equilibrado";
    } else {
      extra = (c>65 && p<45) ? "Calm + discreet" :
              (c<45 && p>60) ? "Energy + close" :
              (r>70) ? "Texture + detail" :
              (r<35) ? "Very minimal" : "Balanced";
    }
    out.push(extra);

    // unique + first 3
    var uniq = [];
    for(var j=0;j<out.length;j++) if(uniq.indexOf(out[j])===-1) uniq.push(out[j]);
    return uniq.slice(0,3);
  }

  function mailtoLink(subject, body){
    var to = MAIL_TO ? MAIL_TO : "";
    return "mailto:" + encodeURIComponent(to) +
      "?subject=" + encodeURIComponent(subject) +
      "&body=" + encodeURIComponent(body);
  }

  // ---------------- Renderers
  function renderIntro(){
    var a = tr();
    var row = btnRow(a.ui.start, function(){ next(); });

    app.innerHTML =
      '<div class="kicker">'+esc(a.intro.kicker)+'</div>' +
      '<h1>'+esc(a.intro.h1)+'</h1>' +
      '<p class="lead">'+esc(a.intro.p).replace(/\n/g,"<br/>")+'</p>' +
      '<div class="hint">'+esc(a.ui.ifHesitate)+'</div>' +
      row.html;

    row.bind();
  }

  function renderName(){
    var a = tr();
    var row = btnRow(a.ui.continue, function(){
      state.name = (document.getElementById("nameInput").value||"").trim();
      next();
    });

    app.innerHTML =
      '<div class="kicker">'+esc(a.acts.who)+'</div>' +
      '<h1>'+esc(a.who.nameH1)+'</h1>' +
      '<p class="lead">'+esc(a.who.nameHelp)+'</p>' +
      '<input id="nameInput" type="text" value="'+esc(state.name)+'" placeholder="'+esc(a.who.namePh)+'" />' +
      '<div class="micro">'+esc(a.ui.optional)+'</div>' +
      row.html;

    row.bind();
  }

  function renderProject(){
    var a = tr();
    var row = btnRow(a.ui.continue, function(){
      state.project = (document.getElementById("projInput").value||"").trim();
      next();
    });

    app.innerHTML =
      '<div class="kicker">'+esc(a.acts.who)+'</div>' +
      '<h1>'+esc(a.who.projH1)+'</h1>' +
      '<p class="lead">'+esc(a.who.projHelp)+'</p>' +
      '<input id="projInput" type="text" value="'+esc(state.project)+'" placeholder="'+esc(a.who.projPh)+'" />' +
      '<div class="micro">'+esc(a.ui.optional)+'</div>' +
      row.html;

    row.bind();
  }

  function renderCore(){
    var a = tr();
    var c = a.core.opts;
    var row = btnRow(a.ui.continue, function(){
      if(!state.core){ showToast(a.ui.pickOne); return; }
      next();
    });

    var items = [
      ["place", c.place.t, c.place.d],
      ["story", c.story.t, c.story.d],
      ["moment", c.moment.t, c.moment.d]
    ];

    var html = '';
    html += '<div class="kicker">'+esc(a.acts.core)+'</div>';
    html += '<h1>'+esc(a.core.h1)+'</h1>';
    html += '<p class="lead">'+esc(a.core.help)+'</p>';
    html += '<div class="choices">';
    for(var i=0;i<items.length;i++){
      var id=items[i][0], t=items[i][1], d=items[i][2];
      html += '<div class="choice '+(state.core===id?'sel':'')+'" data-id="'+id+'">' +
        '<div class="optTitle">'+esc(t)+'</div>' +
        '<div class="optDesc">'+esc(d)+'</div>' +
      '</div>';
    }
    html += '</div>';
    html += '<div class="hint">'+esc(a.ui.ifHesitate)+'</div>';
    html += row.html;

    app.innerHTML = html;

    var els = app.querySelectorAll(".choice");
    for(var j=0;j<els.length;j++){
      els[j].onclick = function(){
        state.core = this.getAttribute("data-id");
        safeRender(false);
      };
    }
    row.bind();
  }

  function renderIntent(){
    var a = tr();
    var o = a.core.intent;
    var row = btnRow(a.ui.continue, function(){
      if(state.intent.length===0){ showToast(a.ui.pickAtLeastOne); return; }
      next();
    });

    var items = [
      ["natural", o.natural.t, o.natural.d],
      ["atmosphere", o.atmosphere.t, o.atmosphere.d],
      ["truth", o.truth.t, o.truth.d],
      ["elegance", o.elegance.t, o.elegance.d]
    ];

    var html = '';
    html += '<div class="kicker">'+esc(a.acts.core)+'</div>';
    html += '<h1>'+esc(a.core.intentH1)+'</h1>';
    html += '<p class="lead">'+esc(a.core.intentHelp)+'</p>';
    html += '<div class="checks">';
    for(var i=0;i<items.length;i++){
      var id=items[i][0], t=items[i][1], d=items[i][2];
      var sel = state.intent.indexOf(id)!==-1;
      html += '<div class="check '+(sel?'sel':'')+'" data-id="'+id+'">' +
        '<div class="optTitle">'+esc(t)+'</div>' +
        '<div class="optDesc">'+esc(d)+'</div>' +
      '</div>';
    }
    html += '</div>';
    html += '<div class="micro">'+esc(a.ui.maxTwoShort)+'</div>';
    html += '<div class="hint">'+esc(a.ui.ifHesitate)+'</div>';
    html += row.html;

    app.innerHTML = html;

    var els = app.querySelectorAll(".check");
    for(var j=0;j<els.length;j++){
      els[j].onclick = function(){
        var id = this.getAttribute("data-id");
        var idx = state.intent.indexOf(id);
        if(idx!==-1){
          state.intent.splice(idx,1);
        } else {
          if(state.intent.length>=2){ showToast(a.ui.maxTwo); return; }
          state.intent.push(id);
        }
        safeRender(false);
      };
    }
    row.bind();
  }

  function renderTime(){
    var a = tr();
    var t = a.use.time;
    var row = btnRow(a.ui.continue, function(){
      if(!state.time){ showToast(a.ui.pickOne); return; }
      next();
    });

    var items = [
      ["moment", t.moment.t, t.moment.d],
      ["overtime", t.overtime.t, t.overtime.d],
      ["grow", t.grow.t, t.grow.d]
    ];

    var html = '';
    html += '<div class="kicker">'+esc(a.acts.use)+'</div>';
    html += '<h1>'+esc(a.use.timeH1)+'</h1>';
    html += '<p class="lead">'+esc(a.use.timeHelp)+'</p>';
    html += '<div class="choices">';
    for(var i=0;i<items.length;i++){
      var id=items[i][0], ti=items[i][1], de=items[i][2];
      html += '<div class="choice '+(state.time===id?'sel':'')+'" data-id="'+id+'">' +
        '<div class="optTitle">'+esc(ti)+'</div>' +
        '<div class="optDesc">'+esc(de)+'</div>' +
      '</div>';
    }
    html += '</div>';
    html += '<div class="hint">'+esc(a.ui.ifHesitate)+'</div>';
    html += row.html;

    app.innerHTML = html;

    var els = app.querySelectorAll(".choice");
    for(var j=0;j<els.length;j++){
      els[j].onclick = function(){
        state.time = this.getAttribute("data-id");
        safeRender(false);
      };
    }
    row.bind();
  }

  function renderWhere(){
    var a = tr();
    var w = a.use.where;
    var row = btnRow(a.ui.continue, function(){
      if(state.where.length===0){ showToast(a.ui.pickAtLeastOne); return; }
      next();
    });

    var items = [
      ["website", w.website.t, w.website.d],
      ["social", w.social.t, w.social.d],
      ["editorial", w.editorial.t, w.editorial.d],
      ["print", w.print.t, w.print.d]
    ];

    var html = '';
    html += '<div class="kicker">'+esc(a.acts.use)+'</div>';
    html += '<h1>'+esc(a.use.whereH1)+'</h1>';
    html += '<p class="lead">'+esc(a.use.whereHelp)+'</p>';
    html += '<div class="checks">';
    for(var i=0;i<items.length;i++){
      var id=items[i][0], ti=items[i][1], de=items[i][2];
      var sel = state.where.indexOf(id)!==-1;
      html += '<div class="check '+(sel?'sel':'')+'" data-id="'+id+'">' +
        '<div class="optTitle">'+esc(ti)+'</div>' +
        '<div class="optDesc">'+esc(de)+'</div>' +
      '</div>';
    }
    html += '</div>';
    html += '<div class="micro">'+esc(a.ui.maxTwoShort)+'</div>';
    html += '<div class="hint">'+esc(a.ui.ifHesitate)+'</div>';
    html += row.html;

    app.innerHTML = html;

    var els = app.querySelectorAll(".check");
    for(var j=0;j<els.length;j++){
      els[j].onclick = function(){
        var id = this.getAttribute("data-id");
        var idx = state.where.indexOf(id);
        if(idx!==-1){
          state.where.splice(idx,1);
        } else {
          if(state.where.length>=2){ showToast(a.ui.maxTwo); return; }
          state.where.push(id);
        }
        safeRender(false);
      };
    }
    row.bind();
  }

  function sliderBlock(key, left, right, hl, hr, value){
    return '' +
      '<div class="slider">' +
        '<div class="slab"><span>'+esc(left)+'</span><span>'+esc(right)+'</span></div>' +
        '<input type="range" min="0" max="100" value="'+value+'" data-key="'+key+'">' +
        '<div class="sliderHelp"><span>'+esc(hl)+'</span><span>'+esc(hr)+'</span></div>' +
      '</div>';
  }

  function apply
